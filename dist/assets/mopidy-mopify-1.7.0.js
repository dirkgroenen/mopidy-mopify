/**
 * mopidy-mopify - v1.7.0 - 2020-04-06
 * 
 *
 * Copyright (c) 2020 Dirk Groenen
 * Licensed Apache License <http://www.apache.org/licenses/LICENSE-2.0.txt>
 */

!function(a){if("object"==typeof exports)module.exports=a();else if("function"==typeof define&&define.amd)define(a);else{var b;"undefined"!=typeof window?b=window:"undefined"!=typeof global?b=global:"undefined"!=typeof self&&(b=self),b.Mopidy=a()}}(function(){var a;return function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);throw new Error("Cannot find module '"+g+"'")}var j=c[g]={exports:{}};b[g][0].call(j.exports,function(a){var c=b[g][1][a];return e(c||a)},j,j.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){b.exports={Client:window.WebSocket}},{}],2:[function(b,c,d){("function"==typeof a&&a.amd&&function(b){a("bane",b)}||"object"==typeof c&&function(a){c.exports=a()}||function(a){this.bane=a()})(function(){"use strict";function a(a,b,c){var d,e=c.length;if(e>0)for(d=0;d<e;++d)c[d](a,b);else setTimeout(function(){throw b.message=a+" listener threw error: "+b.message,b},0)}function b(a){if("function"!=typeof a)throw new TypeError("Listener is not function");return a}function c(a){return a.supervisors||(a.supervisors=[]),a.supervisors}function d(a,b){return a.listeners||(a.listeners={}),b&&!a.listeners[b]&&(a.listeners[b]=[]),b?a.listeners[b]:a.listeners}function e(a){return a.errbacks||(a.errbacks=[]),a.errbacks}function f(f){function h(b,c,d){try{c.listener.apply(c.thisp||f,d)}catch(c){a(b,c,e(f))}}return f=f||{},f.on=function(a,e,f){if("function"==typeof a)return c(this).push({listener:a,thisp:e});d(this,a).push({listener:b(e),thisp:f})},f.off=function(a,b){var f,g,h,i;if(!a){f=c(this),f.splice(0,f.length),g=d(this);for(h in g)g.hasOwnProperty(h)&&(f=d(this,h),f.splice(0,f.length));return f=e(this),void f.splice(0,f.length)}if("function"==typeof a?(f=c(this),b=a):f=d(this,a),!b)return void f.splice(0,f.length);for(h=0,i=f.length;h<i;++h)if(f[h].listener===b)return void f.splice(h,1)},f.once=function(a,b,c){var d=function(){f.off(a,d),b.apply(this,arguments)};f.on(a,d,c)},f.bind=function(a,b){var c,d,e;if(b)for(d=0,e=b.length;d<e;++d){if("function"!=typeof a[b[d]])throw new Error("No such method "+b[d]);this.on(b[d],a[b[d]],a)}else for(c in a)"function"==typeof a[c]&&this.on(c,a[c],a);return a},f.emit=function(a){var b,e,f=c(this),i=g.call(arguments);for(b=0,e=f.length;b<e;++b)h(a,f[b],i);for(f=d(this,a).slice(),i=g.call(arguments,1),b=0,e=f.length;b<e;++b)h(a,f[b],i)},f.errback=function(a){this.errbacks||(this.errbacks=[]),this.errbacks.push(b(a))},f}var g=Array.prototype.slice;return{createEventEmitter:f,aggregate:function(a){var b=f();return a.forEach(function(a){a.on(function(a,c){b.emit(a,c)})}),b}}})},{}],3:[function(a,b,c){function d(){}var e=b.exports={};e.nextTick=function(){var a="undefined"!=typeof window&&window.setImmediate,b="undefined"!=typeof window&&window.postMessage&&window.addEventListener;if(a)return function(a){return window.setImmediate(a)};if(b){var c=[];return window.addEventListener("message",function(a){var b=a.source;if((b===window||null===b)&&"process-tick"===a.data&&(a.stopPropagation(),c.length>0)){c.shift()()}},!0),function(a){c.push(a),window.postMessage("process-tick","*")}}return function(a){setTimeout(a,0)}}(),e.title="browser",e.browser=!0,e.env={},e.argv=[],e.on=d,e.addListener=d,e.once=d,e.off=d,e.removeListener=d,e.removeAllListeners=d,e.emit=d,e.binding=function(a){throw new Error("process.binding is not supported")},e.cwd=function(){return"/"},e.chdir=function(a){throw new Error("process.chdir is not supported")}},{}],4:[function(b,c,d){!function(a){"use strict";a(function(a){return a("./makePromise")({scheduler:new(a("./Scheduler"))(a("./env").asap)})})}("function"==typeof a&&a.amd?a:function(a){c.exports=a(b)})},{"./Scheduler":5,"./env":17,"./makePromise":19}],5:[function(b,c,d){!function(a){"use strict";a(function(){function a(a){this._async=a,this._running=!1,this._queue=this,this._queueLen=0,this._afterQueue={},this._afterQueueLen=0;var b=this;this.drain=function(){b._drain()}}return a.prototype.enqueue=function(a){this._queue[this._queueLen++]=a,this.run()},a.prototype.afterQueue=function(a){this._afterQueue[this._afterQueueLen++]=a,this.run()},a.prototype.run=function(){this._running||(this._running=!0,this._async(this.drain))},a.prototype._drain=function(){for(var a=0;a<this._queueLen;++a)this._queue[a].run(),this._queue[a]=void 0;for(this._queueLen=0,this._running=!1,a=0;a<this._afterQueueLen;++a)this._afterQueue[a].run(),this._afterQueue[a]=void 0;this._afterQueueLen=0},a})}("function"==typeof a&&a.amd?a:function(a){c.exports=a()})},{}],6:[function(b,c,d){!function(a){"use strict";a(function(){function a(b){Error.call(this),this.message=b,this.name=a.name,"function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,a)}return a.prototype=Object.create(Error.prototype),a.prototype.constructor=a,a})}("function"==typeof a&&a.amd?a:function(a){c.exports=a()})},{}],7:[function(b,c,d){!function(a){"use strict";a(function(){function a(a,c){function d(b,d,f){var g=a._defer(),h=f.length;return e({f:b,thisArg:d,args:f,params:new Array(h),i:h-1,call:c},g._handler),g}function e(b,d){if(b.i<0)return c(b.f,b.thisArg,b.params,d);a._handler(b.args[b.i]).fold(f,b,void 0,d)}function f(a,b,c){a.params[a.i]=b,a.i-=1,e(a,c)}return arguments.length<2&&(c=b),d}function b(a,b,c,d){try{d.resolve(a.apply(b,c))}catch(a){d.reject(a)}}return a.tryCatchResolve=b,a})}("function"==typeof a&&a.amd?a:function(a){c.exports=a()})},{}],8:[function(b,c,d){!function(a){"use strict";a(function(a){var b=a("../state"),c=a("../apply");return function(a){function d(b){function c(a){k=null,this.resolve(a)}function d(a){this.resolved||(k.push(a),0==--j&&this.reject(k))}for(var e,f,g=a._defer(),h=g._handler,i=b.length>>>0,j=i,k=[],l=0;l<i;++l)if(void 0!==(f=b[l])||l in b){if(e=a._handler(f),e.state()>0){h.become(e),a._visitRemaining(b,l,e);break}e.visit(h,c,d)}else--j;return 0===j&&h.reject(new RangeError("any(): array must not be empty")),g}function e(b,c){function d(a){this.resolved||(k.push(a),0==--n&&(l=null,this.resolve(k)))}function e(a){this.resolved||(l.push(a),0==--f&&(k=null,this.reject(l)))}var f,g,h,i=a._defer(),j=i._handler,k=[],l=[],m=b.length>>>0,n=0;for(h=0;h<m;++h)(void 0!==(g=b[h])||h in b)&&++n;for(c=Math.max(c,0),f=n-c+1,n=Math.min(c,n),c>n?j.reject(new RangeError("some(): array must contain at least "+c+" item(s), but had "+n)):0===n&&j.resolve(k),h=0;h<m;++h)(void 0!==(g=b[h])||h in b)&&a._handler(g).visit(j,d,e,j.notify);return i}function f(b,c){return a._traverse(c,b)}function g(b,c){var d=s.call(b);return a._traverse(c,d).then(function(a){return h(d,a)})}function h(b,c){for(var d=c.length,e=new Array(d),f=0,g=0;f<d;++f)c[f]&&(e[g++]=a._handler(b[f]).value);return e.length=g,e}function i(a){return p(a.map(j))}function j(c){var d=a._handler(c);return 0===d.state()?o(c).then(b.fulfilled,b.rejected):(d._unreport(),b.inspect(d))}function k(a,b){return arguments.length>2?q.call(a,m(b),arguments[2]):q.call(a,m(b))}function l(a,b){return arguments.length>2?r.call(a,m(b),arguments[2]):r.call(a,m(b))}function m(a){return function(b,c,d){return n(a,void 0,[b,c,d])}}var n=c(a),o=a.resolve,p=a.all,q=Array.prototype.reduce,r=Array.prototype.reduceRight,s=Array.prototype.slice;return a.any=d,a.some=e,a.settle=i,a.map=f,a.filter=g,a.reduce=k,a.reduceRight=l,a.prototype.spread=function(a){return this.then(p).then(function(b){return a.apply(this,b)})},a}})}("function"==typeof a&&a.amd?a:function(a){c.exports=a(b)})},{"../apply":7,"../state":20}],9:[function(b,c,d){!function(a){"use strict";a(function(){function a(){throw new TypeError("catch predicate must be a function")}function b(a,b){return c(b)?a instanceof b:b(a)}function c(a){return a===Error||null!=a&&a.prototype instanceof Error}function d(a){return("object"==typeof a||"function"==typeof a)&&null!==a}function e(a){return a}return function(c){function f(a,c){return function(d){return b(d,c)?a.call(this,d):j(d)}}function g(a,b,c,e){var f=a.call(b);return d(f)?h(f,c,e):c(e)}function h(a,b,c){return i(a).then(function(){return b(c)})}var i=c.resolve,j=c.reject,k=c.prototype.catch;return c.prototype.done=function(a,b){this._handler.visit(this._handler.receiver,a,b)},c.prototype.catch=c.prototype.otherwise=function(b){return arguments.length<2?k.call(this,b):"function"!=typeof b?this.ensure(a):k.call(this,f(arguments[1],b))},c.prototype.finally=c.prototype.ensure=function(a){return"function"!=typeof a?this:this.then(function(b){return g(a,this,e,b)},function(b){return g(a,this,j,b)})},c.prototype.else=c.prototype.orElse=function(a){return this.then(void 0,function(){return a})},c.prototype.yield=function(a){return this.then(function(){return a})},c.prototype.tap=function(a){return this.then(a).yield(this)},c}})}("function"==typeof a&&a.amd?a:function(a){c.exports=a()})},{}],10:[function(b,c,d){!function(a){"use strict";a(function(){return function(a){return a.prototype.fold=function(b,c){var d=this._beget();return this._handler.fold(function(c,d,e){a._handler(c).fold(function(a,c,d){d.resolve(b.call(this,c,a))},d,this,e)},c,d._handler.receiver,d._handler),d},a}})}("function"==typeof a&&a.amd?a:function(a){c.exports=a()})},{}],11:[function(b,c,d){!function(a){"use strict";a(function(a){var b=a("../state").inspect;return function(a){return a.prototype.inspect=function(){return b(a._handler(this))},a}})}("function"==typeof a&&a.amd?a:function(a){c.exports=a(b)})},{"../state":20}],12:[function(b,c,d){!function(a){"use strict";a(function(){return function(a){function b(a,b,d,e){return c(function(b){return[b,a(b)]},b,d,e)}function c(a,b,e,f){function g(f,g){return d(e(f)).then(function(){return c(a,b,e,g)})}return d(f).then(function(c){return d(b(c)).then(function(b){return b?c:d(a(c)).spread(g)})})}var d=a.resolve;return a.iterate=b,a.unfold=c,a}})}("function"==typeof a&&a.amd?a:function(a){c.exports=a()})},{}],13:[function(b,c,d){!function(a){"use strict";a(function(){return function(a){return a.prototype.progress=function(a){return this.then(void 0,void 0,a)},a}})}("function"==typeof a&&a.amd?a:function(a){c.exports=a()})},{}],14:[function(b,c,d){!function(a){"use strict";a(function(a){function b(a,b,d,e){return c.setTimer(function(){a(d,e,b)},b)}var c=a("../env"),d=a("../TimeoutError");return function(a){function e(a,c,d){b(f,a,c,d)}function f(a,b){b.resolve(a)}function g(a,b,c){var e=void 0===a?new d("timed out after "+c+"ms"):a;b.reject(e)}return a.prototype.delay=function(a){var b=this._beget();return this._handler.fold(e,a,void 0,b._handler),b},a.prototype.timeout=function(a,d){var e=this._beget(),f=e._handler,h=b(g,a,d,e._handler);return this._handler.visit(f,function(a){c.clearTimer(h),this.resolve(a)},function(a){c.clearTimer(h),this.reject(a)},f.notify),e},a}})}("function"==typeof a&&a.amd?a:function(a){c.exports=a(b)})},{"../TimeoutError":6,"../env":17}],15:[function(b,c,d){!function(a){"use strict";a(function(a){function b(a){throw a}function c(){}var d=a("../env").setTimer,e=a("../format");return function(a){function f(a){a.handled||(n.push(a),k("Potentially unhandled rejection ["+a.id+"] "+e.formatError(a.value)))}function g(a){var b=n.indexOf(a);b>=0&&(n.splice(b,1),l("Handled previous rejection ["+a.id+"] "+e.formatObject(a.value)))}function h(a,b){m.push(a,b),null===o&&(o=d(i,0))}function i(){for(o=null;m.length>0;)m.shift()(m.shift())}var j,k=c,l=c;"undefined"!=typeof console&&(j=console,k=void 0!==j.error?function(a){j.error(a)}:function(a){j.log(a)},l=void 0!==j.info?function(a){j.info(a)}:function(a){j.log(a)}),a.onPotentiallyUnhandledRejection=function(a){h(f,a)},a.onPotentiallyUnhandledRejectionHandled=function(a){h(g,a)},a.onFatalRejection=function(a){h(b,a.value)};var m=[],n=[],o=null;return a}})}("function"==typeof a&&a.amd?a:function(a){c.exports=a(b)})},{"../env":17,"../format":18}],16:[function(b,c,d){!function(a){"use strict";a(function(){return function(a){return a.prototype.with=a.prototype.withThis=function(a){var b=this._beget(),c=b._handler;return c.receiver=a,this._handler.chain(c,a),b},a}})}("function"==typeof a&&a.amd?a:function(a){c.exports=a()})},{}],17:[function(b,c,d){(function(d){!function(a){"use strict";a(function(a){function b(){return void 0!==d&&null!==d&&"function"==typeof d.nextTick}function c(){return"function"==typeof MutationObserver&&MutationObserver||"function"==typeof WebKitMutationObserver&&WebKitMutationObserver}function e(a){function b(){var a=c;c=void 0,a()}var c,d=document.createTextNode("");new a(b).observe(d,{characterData:!0});var e=0;return function(a){c=a,d.data=e^=1}}var f,g="undefined"!=typeof setTimeout&&setTimeout,h=function(a,b){return setTimeout(a,b)},i=function(a){return clearTimeout(a)},j=function(a){return g(a,0)};if(b())j=function(a){return d.nextTick(a)};else if(f=c())j=e(f);else if(!g){var k=a,l=k("vertx");h=function(a,b){return l.setTimer(b,a)},i=l.cancelTimer,j=l.runOnLoop||l.runOnContext}return{setTimer:h,clearTimer:i,asap:j}})}("function"==typeof a&&a.amd?a:function(a){c.exports=a(b)})}).call(this,b("FWaASH"))},{FWaASH:3}],18:[function(b,c,d){!function(a){"use strict";a(function(){function a(a){var c="object"==typeof a&&null!==a&&a.stack?a.stack:b(a);return a instanceof Error?c:c+" (WARNING: non-Error used)"}function b(a){var b=String(a);return"[object Object]"===b&&"undefined"!=typeof JSON&&(b=c(a,b)),b}function c(a,b){try{return JSON.stringify(a)}catch(a){return b}}return{formatError:a,formatObject:b,tryStringify:c}})}("function"==typeof a&&a.amd?a:function(a){c.exports=a()})},{}],19:[function(b,c,d){(function(b){!function(a){"use strict";a(function(){return function(a){function c(a,b){this._handler=a===u?b:d(a)}function d(a){function b(a){e.resolve(a)}function c(a){e.reject(a)}function d(a){e.notify(a)}var e=new w;try{a(b,c,d)}catch(a){c(a)}return e}function e(a){return J(a)?a:new c(u,new x(r(a)))}function f(a){return new c(u,new x(new A(a)))}function g(){return aa}function h(){return new c(u,new w)}function i(a,b){return new b(u,new w(a.receiver,a.join().context))}function j(a){return l(T,null,a)}function k(a,b){return l(O,a,b)}function l(a,b,d){function e(c,e,g){g.resolved||m(d,f,c,a(b,e,c),g)}function f(a,b,c){k[a]=b,0==--j&&c.become(new z(k))}for(var g,h="function"==typeof b?e:f,i=new w,j=d.length>>>0,k=new Array(j),l=0;l<d.length&&!i.resolved;++l)g=d[l],void 0!==g||l in d?m(d,h,l,g,i):--j;return 0===j&&i.become(new z(k)),new c(u,i)}function m(a,b,c,d,e){if(K(d)){var f=s(d),g=f.state();0===g?f.fold(b,c,void 0,e):g>0?b(c,f.value,e):(e.become(f),n(a,c+1,f))}else b(c,d,e)}function n(a,b,c){for(var d=b;d<a.length;++d)o(r(a[d]),c)}function o(a,b){if(a!==b){var c=a.state();0===c?a.visit(a,void 0,a._unreport):c<0&&a._unreport()}}function p(a){return"object"!=typeof a||null===a?f(new TypeError("non-iterable passed to race()")):0===a.length?g():1===a.length?e(a[0]):q(a)}function q(a){var b,d,e,f=new w;for(b=0;b<a.length;++b)if(void 0!==(d=a[b])||b in a){if(e=r(d),0!==e.state()){f.become(e),n(a,b+1,e);break}e.visit(f,f.resolve,f.reject)}return new c(u,f)}function r(a){return J(a)?a._handler.join():K(a)?t(a):new z(a)}function s(a){return J(a)?a._handler.join():t(a)}function t(a){try{var b=a.then;return"function"==typeof b?new y(b,a):new z(a)}catch(a){return new A(a)}}function u(){}function v(){}function w(a,b){c.createContext(this,b),this.consumers=void 0,this.receiver=a,this.handler=void 0,this.resolved=!1}function x(a){this.handler=a}function y(a,b){w.call(this),W.enqueue(new G(a,b,this))}function z(a){c.createContext(this),this.value=a}function A(a){c.createContext(this),this.id=++$,this.value=a,this.handled=!1,this.reported=!1,this._report()}function B(a,b){this.rejection=a,this.context=b}function C(a){this.rejection=a}function D(){return new A(new TypeError("Promise cycle"))}function E(a,b){this.continuation=a,this.handler=b}function F(a,b){this.handler=b,this.value=a}function G(a,b,c){this._then=a,this.thenable=b,this.resolver=c}function H(a,b,c,d,e){try{a.call(b,c,d,e)}catch(a){d(a)}}function I(a,b,c,d){this.f=a,this.z=b,this.c=c,this.to=d,this.resolver=Z,this.receiver=this}function J(a){return a instanceof c}function K(a){return("object"==typeof a||"function"==typeof a)&&null!==a}function L(a,b,d,e){if("function"!=typeof a)return e.become(b);c.enterContext(b),P(a,b.value,d,e),c.exitContext()}function M(a,b,d,e,f){if("function"!=typeof a)return f.become(d);c.enterContext(d),Q(a,b,d.value,e,f),c.exitContext()}function N(a,b,d,e,f){if("function"!=typeof a)return f.notify(b);c.enterContext(d),R(a,b,e,f),c.exitContext()}function O(a,b,c){try{return a(b,c)}catch(a){return f(a)}}function P(a,b,c,d){try{d.become(r(a.call(c,b)))}catch(a){d.become(new A(a))}}function Q(a,b,c,d,e){try{a.call(d,b,c,e)}catch(a){e.become(new A(a))}}function R(a,b,c,d){try{d.notify(a.call(c,b))}catch(a){d.notify(a)}}function S(a,b){b.prototype=Y(a.prototype),b.prototype.constructor=b}function T(a,b){return b}function U(){}function V(){return void 0!==b&&null!==b&&"function"==typeof b.emit?function(a,c){return"unhandledRejection"===a?b.emit(a,c.value,c):b.emit(a,c)}:"undefined"!=typeof self&&"function"==typeof CustomEvent?function(a,b,c){var d=!1;try{d=new c("unhandledRejection")instanceof c}catch(a){}return d?function(a,d){var e=new c(a,{detail:{reason:d.value,key:d},bubbles:!1,cancelable:!0});return!b.dispatchEvent(e)}:a}(U,self,CustomEvent):U}var W=a.scheduler,X=V(),Y=Object.create||function(a){function b(){}return b.prototype=a,new b};c.resolve=e,c.reject=f,c.never=g,c._defer=h,c._handler=r,c.prototype.then=function(a,b,c){var d=this._handler,e=d.join().state();if("function"!=typeof a&&e>0||"function"!=typeof b&&e<0)return new this.constructor(u,d);var f=this._beget(),g=f._handler;return d.chain(g,d.receiver,a,b,c),f},c.prototype.catch=function(a){return this.then(void 0,a)},c.prototype._beget=function(){return i(this._handler,this.constructor)},c.all=j,c.race=p,c._traverse=k,c._visitRemaining=n,u.prototype.when=u.prototype.become=u.prototype.notify=u.prototype.fail=u.prototype._unreport=u.prototype._report=U,u.prototype._state=0,u.prototype.state=function(){return this._state},u.prototype.join=function(){for(var a=this;void 0!==a.handler;)a=a.handler;return a},u.prototype.chain=function(a,b,c,d,e){this.when({resolver:a,receiver:b,fulfilled:c,rejected:d,progress:e})},u.prototype.visit=function(a,b,c,d){this.chain(Z,a,b,c,d)},u.prototype.fold=function(a,b,c,d){this.when(new I(a,b,c,d))},S(u,v),v.prototype.become=function(a){a.fail()};var Z=new v;S(u,w),w.prototype._state=0,w.prototype.resolve=function(a){this.become(r(a))},w.prototype.reject=function(a){this.resolved||this.become(new A(a))},w.prototype.join=function(){if(!this.resolved)return this;for(var a=this;void 0!==a.handler;)if((a=a.handler)===this)return this.handler=D();return a},w.prototype.run=function(){var a=this.consumers,b=this.handler;this.handler=this.handler.join(),this.consumers=void 0;for(var c=0;c<a.length;++c)b.when(a[c])},w.prototype.become=function(a){this.resolved||(this.resolved=!0,this.handler=a,void 0!==this.consumers&&W.enqueue(this),void 0!==this.context&&a._report(this.context))},w.prototype.when=function(a){this.resolved?W.enqueue(new E(a,this.handler)):void 0===this.consumers?this.consumers=[a]:this.consumers.push(a)},w.prototype.notify=function(a){this.resolved||W.enqueue(new F(a,this))},w.prototype.fail=function(a){var b=void 0===a?this.context:a;this.resolved&&this.handler.join().fail(b)},w.prototype._report=function(a){this.resolved&&this.handler.join()._report(a)},w.prototype._unreport=function(){this.resolved&&this.handler.join()._unreport()},S(u,x),x.prototype.when=function(a){W.enqueue(new E(a,this))},x.prototype._report=function(a){this.join()._report(a)},x.prototype._unreport=function(){this.join()._unreport()},S(w,y),S(u,z),z.prototype._state=1,z.prototype.fold=function(a,b,c,d){M(a,b,this,c,d)},z.prototype.when=function(a){L(a.fulfilled,this,a.receiver,a.resolver)};var $=0;S(u,A),A.prototype._state=-1,A.prototype.fold=function(a,b,c,d){d.become(this)},A.prototype.when=function(a){"function"==typeof a.rejected&&this._unreport(),L(a.rejected,this,a.receiver,a.resolver)},A.prototype._report=function(a){W.afterQueue(new B(this,a))},A.prototype._unreport=function(){this.handled||(this.handled=!0,W.afterQueue(new C(this)))},A.prototype.fail=function(a){this.reported=!0,X("unhandledRejection",this),c.onFatalRejection(this,void 0===a?this.context:a)},B.prototype.run=function(){this.rejection.handled||this.rejection.reported||(this.rejection.reported=!0,X("unhandledRejection",this.rejection)||c.onPotentiallyUnhandledRejection(this.rejection,this.context))},C.prototype.run=function(){this.rejection.reported&&(X("rejectionHandled",this.rejection)||c.onPotentiallyUnhandledRejectionHandled(this.rejection))},c.createContext=c.enterContext=c.exitContext=c.onPotentiallyUnhandledRejection=c.onPotentiallyUnhandledRejectionHandled=c.onFatalRejection=U;var _=new u,aa=new c(u,_);return E.prototype.run=function(){this.handler.join().when(this.continuation)},F.prototype.run=function(){var a=this.handler.consumers;if(void 0!==a)for(var b,c=0;c<a.length;++c)b=a[c],N(b.progress,this.value,this.handler,b.receiver,b.resolver)},G.prototype.run=function(){function a(a){d.resolve(a)}function b(a){d.reject(a)}function c(a){d.notify(a)}var d=this.resolver;H(this._then,this.thenable,a,b,c)},I.prototype.fulfilled=function(a){this.f.call(this.c,this.z,a,this.to)},I.prototype.rejected=function(a){this.to.reject(a)},I.prototype.progress=function(a){this.to.notify(a)},c}})}("function"==typeof a&&a.amd?a:function(a){c.exports=a()})}).call(this,b("FWaASH"))},{FWaASH:3}],20:[function(b,c,d){!function(a){"use strict";a(function(){function a(){return{state:"pending"}}function b(a){return{state:"rejected",reason:a}}function c(a){return{state:"fulfilled",value:a}}function d(d){var e=d.state();return 0===e?a():e>0?c(d.value):b(d.value)}return{pending:a,fulfilled:c,rejected:b,inspect:d}})}("function"==typeof a&&a.amd?a:function(a){c.exports=a()})},{}],21:[function(b,c,d){!function(a){"use strict";a(function(a){function b(a,b,c,d){var e=x.resolve(a);return arguments.length<2?e:e.then(b,c,d)}function c(a){return new x(a)}function d(a){return function(){for(var b=0,c=arguments.length,d=new Array(c);b<c;++b)d[b]=arguments[b];return y(a,this,d)}}function e(a){for(var b=0,c=arguments.length-1,d=new Array(c);b<c;++b)d[b]=arguments[b+1];return y(a,this,d)}function f(){return new g}function g(){function a(a){d._handler.resolve(a)}function b(a){d._handler.reject(a)}function c(a){d._handler.notify(a)}var d=x._defer();this.promise=d,this.resolve=a,this.reject=b,this.notify=c,this.resolver={resolve:a,reject:b,notify:c}}function h(a){return a&&"function"==typeof a.then}function i(){return x.all(arguments)}function j(a){return b(a,x.all)}function k(a){return b(a,x.settle)}function l(a,c){return b(a,function(a){return x.map(a,c)})}function m(a,c){return b(a,function(a){return x.filter(a,c)})}var n=a("./lib/decorators/timed"),o=a("./lib/decorators/array"),p=a("./lib/decorators/flow"),q=a("./lib/decorators/fold"),r=a("./lib/decorators/inspect"),s=a("./lib/decorators/iterate"),t=a("./lib/decorators/progress"),u=a("./lib/decorators/with"),v=a("./lib/decorators/unhandledRejection"),w=a("./lib/TimeoutError"),x=[o,p,q,s,t,r,u,n,v].reduce(function(a,b){return b(a)},a("./lib/Promise")),y=a("./lib/apply")(x);return b.promise=c,b.resolve=x.resolve,b.reject=x.reject,b.lift=d,b.try=e,b.attempt=e,b.iterate=x.iterate,b.unfold=x.unfold,b.join=i,b.all=j,b.settle=k,b.any=d(x.any),b.some=d(x.some),b.race=d(x.race),b.map=l,b.filter=m,b.reduce=d(x.reduce),b.reduceRight=d(x.reduceRight),b.isPromiseLike=h,b.Promise=x,b.defer=f,b.TimeoutError=w,b})}("function"==typeof a&&a.amd?a:function(a){c.exports=a(b)})},{"./lib/Promise":4,"./lib/TimeoutError":6,"./lib/apply":7,"./lib/decorators/array":8,"./lib/decorators/flow":9,"./lib/decorators/fold":10,"./lib/decorators/inspect":11,"./lib/decorators/iterate":12,"./lib/decorators/progress":13,"./lib/decorators/timed":14,"./lib/decorators/unhandledRejection":15,"./lib/decorators/with":16}],22:[function(a,b,c){function d(a){if(!(this instanceof d))return new d(a);this._console=this._getConsole(a||{}),this._settings=this._configure(a||{}),this._backoffDelay=this._settings.backoffDelayMin,this._pendingRequests={},this._webSocket=null,e.createEventEmitter(this),this._delegateEvents(),this._settings.autoConnect&&this.connect()}var e=a("bane"),f=a("../lib/websocket/"),g=a("when");d.ConnectionError=function(a){this.name="ConnectionError",this.message=a},d.ConnectionError.prototype=Object.create(Error.prototype),d.ConnectionError.prototype.constructor=d.ConnectionError,d.ServerError=function(a){this.name="ServerError",this.message=a},d.ServerError.prototype=Object.create(Error.prototype),d.ServerError.prototype.constructor=d.ServerError,d.WebSocket=f.Client,d.when=g,d.prototype._getConsole=function(a){if(void 0!==a.console)return a.console;var b="undefined"!=typeof console&&console||{};return b.log=b.log||function(){},b.warn=b.warn||function(){},b.error=b.error||function(){},b},d.prototype._configure=function(a){var b="undefined"!=typeof document&&"https:"===document.location.protocol?"wss://":"ws://",c="undefined"!=typeof document&&document.location.host||"localhost";return a.webSocketUrl=a.webSocketUrl||b+c+"/mopidy/ws",!1!==a.autoConnect&&(a.autoConnect=!0),a.backoffDelayMin=a.backoffDelayMin||1e3,a.backoffDelayMax=a.backoffDelayMax||64e3,void 0===a.callingConvention&&this._console.warn("Mopidy.js is using the default calling convention. The default will change in the future. You should explicitly specify which calling convention you use."),a.callingConvention=a.callingConvention||"by-position-only",a},d.prototype._delegateEvents=function(){this.off("websocket:close"),this.off("websocket:error"),this.off("websocket:incomingMessage"),this.off("websocket:open"),this.off("state:offline"),this.on("websocket:close",this._cleanup),this.on("websocket:error",this._handleWebSocketError),this.on("websocket:incomingMessage",this._handleMessage),this.on("websocket:open",this._resetBackoffDelay),this.on("websocket:open",this._getApiSpec),this.on("state:offline",this._reconnect)},d.prototype.connect=function(){if(this._webSocket){if(this._webSocket.readyState===d.WebSocket.OPEN)return;this._webSocket.close()}this._webSocket=this._settings.webSocket||new d.WebSocket(this._settings.webSocketUrl),this._webSocket.onclose=function(a){this.emit("websocket:close",a)}.bind(this),this._webSocket.onerror=function(a){this.emit("websocket:error",a)}.bind(this),this._webSocket.onopen=function(){this.emit("websocket:open")}.bind(this),this._webSocket.onmessage=function(a){this.emit("websocket:incomingMessage",a)}.bind(this)},d.prototype._cleanup=function(a){Object.keys(this._pendingRequests).forEach(function(b){var c=this._pendingRequests[b];delete this._pendingRequests[b];var e=new d.ConnectionError("WebSocket closed");e.closeEvent=a,c.reject(e)}.bind(this)),this.emit("state:offline")},d.prototype._reconnect=function(){this.emit("reconnectionPending",{timeToAttempt:this._backoffDelay}),setTimeout(function(){this.emit("reconnecting"),this.connect()}.bind(this),this._backoffDelay),this._backoffDelay=2*this._backoffDelay,this._backoffDelay>this._settings.backoffDelayMax&&(this._backoffDelay=this._settings.backoffDelayMax)},d.prototype._resetBackoffDelay=function(){this._backoffDelay=this._settings.backoffDelayMin},d.prototype.close=function(){this.off("state:offline",this._reconnect),this._webSocket.close()},d.prototype._handleWebSocketError=function(a){this._console.warn("WebSocket error:",a.stack||a)},d.prototype._send=function(a){switch(this._webSocket.readyState){case d.WebSocket.CONNECTING:return g.reject(new d.ConnectionError("WebSocket is still connecting"));case d.WebSocket.CLOSING:return g.reject(new d.ConnectionError("WebSocket is closing"));case d.WebSocket.CLOSED:return g.reject(new d.ConnectionError("WebSocket is closed"));default:var b=g.defer();return a.jsonrpc="2.0",a.id=this._nextRequestId(),this._pendingRequests[a.id]=b.resolver,this._webSocket.send(JSON.stringify(a)),this.emit("websocket:outgoingMessage",a),b.promise}},d.prototype._nextRequestId=function(){var a=-1;return function(){return a+=1}}(),d.prototype._handleMessage=function(a){try{var b=JSON.parse(a.data);b.hasOwnProperty("id")?this._handleResponse(b):b.hasOwnProperty("event")?this._handleEvent(b):this._console.warn("Unknown message type received. Message was: "+a.data)}catch(b){if(!(b instanceof SyntaxError))throw b;this._console.warn("WebSocket message parsing failed. Message was: "+a.data)}},d.prototype._handleResponse=function(a){if(!this._pendingRequests.hasOwnProperty(a.id))return void this._console.warn("Unexpected response received. Message was:",a);var b,c=this._pendingRequests[a.id];delete this._pendingRequests[a.id],a.hasOwnProperty("result")?c.resolve(a.result):a.hasOwnProperty("error")?(b=new d.ServerError(a.error.message),b.code=a.error.code,b.data=a.error.data,c.reject(b),this._console.warn("Server returned error:",a.error)):(b=new Error("Response without 'result' or 'error' received"),b.data={response:a},c.reject(b),this._console.warn("Response without 'result' or 'error' received. Message was:",a))},d.prototype._handleEvent=function(a){var b=a.event,c=a;delete c.event,this.emit("event:"+this._snakeToCamel(b),c)},d.prototype._getApiSpec=function(){return this._send({method:"core.describe"}).then(this._createApi.bind(this)).catch(this._handleWebSocketError)},d.prototype._createApi=function(a){var b="by-position-or-by-name"===this._settings.callingConvention,c=function(a){return function(){var c={method:a};return 0===arguments.length?this._send(c):b?arguments.length>1?g.reject(new Error("Expected zero arguments, a single array, or a single object.")):Array.isArray(arguments[0])||arguments[0]===Object(arguments[0])?(c.params=arguments[0],this._send(c)):g.reject(new TypeError("Expected an array or an object.")):(c.params=Array.prototype.slice.call(arguments),this._send(c))}.bind(this)}.bind(this),d=function(a){var b=a.split(".");return b.length>=1&&"core"===b[0]&&(b=b.slice(1)),b},e=function(a){var b=this;return a.forEach(function(a){a=this._snakeToCamel(a),b[a]=b[a]||{},b=b[a]}.bind(this)),b}.bind(this),f=function(b){var f=d(b),g=this._snakeToCamel(f.slice(-1)[0]),h=e(f.slice(0,-1));h[g]=c(b),h[g].description=a[b].description,h[g].params=a[b].params}.bind(this);Object.keys(a).forEach(f),this.emit("state:online")},d.prototype._snakeToCamel=function(a){return a.replace(/(_[a-z])/g,function(a){return a.toUpperCase().replace("_","")})},b.exports=d},{"../lib/websocket/":1,bane:2,when:21}]},{},[22])(22)}),function(a,b,c){"use strict";b.module("spotify",[]).provider("Spotify",function(){var c={};c.clientId=null,c.redirectUri=null,c.scope=null,c.authToken=null,this.setClientId=function(a){return c.clientId=a,c.clientId},this.getClientId=function(){return c.clientId},this.setAuthToken=function(a){return c.authToken=a,c.authToken},this.setRedirectUri=function(a){return c.redirectUri=a,c.redirectUri},this.getRedirectUri=function(){return c.redirectUri},this.setScope=function(a){return c.scope=a,c.scope};var d={};d.toQueryString=function(a){var c=[];return b.forEach(a,function(a,b){this.push(encodeURIComponent(b)+"="+encodeURIComponent(a))},c),c.join("&")},c.apiBase="https://api.spotify.com/v1",this.$get=["$q","$http","$window",function(e,f,g){function h(){this.clientId=c.clientId,this.redirectUri=c.redirectUri,this.apiBase=c.apiBase,this.scope=c.scope,this.authToken=c.authToken,this.toQueryString=d.toQueryString}function i(b,c,d,e){var f=a.open(b,c,d),g=a.setInterval(function(){try{f&&!f.closed||(a.clearInterval(g),e(f))}catch(a){}},1e3);return f}return h.prototype={api:function(a,b,c,d,g){var h=e.defer();return f({url:this.apiBase+a,method:b||"GET",params:c,data:d,headers:g,withCredentials:!1}).then(function(a){h.resolve(a)}).catch(function(a){h.reject(a)}),h.promise},
_auth:function(a){var b={Authorization:"Bearer "+this.authToken};return a&&(b["Content-Type"]="application/json"),b},getAlbum:function(a){return a=-1===a.indexOf("spotify:")?a:a.split(":")[2],this.api("/albums/"+a,"GET",null,null,this._auth())},getAlbums:function(a){return a=b.isString(a)?a.split(","):a,b.forEach(a,function(b,c){a[c]=b.indexOf("spotify:")>-1?b.split(":")[2]:b}),this.api("/albums","GET",{ids:a?a.toString():""},null,this._auth())},getAlbumTracks:function(a,b){return a=-1===a.indexOf("spotify:")?a:a.split(":")[2],this.api("/albums/"+a+"/tracks","GET",b,null,this._auth())},getArtist:function(a){return a=-1===a.indexOf("spotify:")?a:a.split(":")[2],this.api("/artists/"+a,"GET",null,null,this._auth())},getArtists:function(a){return a=b.isString(a)?a.split(","):a,b.forEach(a,function(b,c){a[c]=b.indexOf("spotify:")>-1?b.split(":")[2]:b}),this.api("/artists/","GET",{ids:a?a.toString():""},null,this._auth())},getArtistAlbums:function(a,b){return a=-1===a.indexOf("spotify:")?a:a.split(":")[2],this.api("/artists/"+a+"/albums","GET",b,null,this._auth())},getArtistTopTracks:function(a,b){return a=-1===a.indexOf("spotify:")?a:a.split(":")[2],this.api("/artists/"+a+"/top-tracks","GET",{country:b},null,this._auth())},getRelatedArtists:function(a){return a=-1===a.indexOf("spotify:")?a:a.split(":")[2],this.api("/artists/"+a+"/related-artists","GET",null,null,this._auth())},getFeaturedPlaylists:function(a){return this.api("/browse/featured-playlists","GET",a,null,this._auth())},getNewReleases:function(a){return this.api("/browse/new-releases","GET",a,null,this._auth())},getCategories:function(a){return this.api("/browse/categories","GET",a,null,this._auth())},getCategory:function(a,b){return this.api("/browse/categories/"+a,"GET",b,null,this._auth())},getCategoryPlaylists:function(a,b){return this.api("/browse/categories/"+a+"/playlists","GET",b,null,this._auth())},getRecommendations:function(a){return this.api("/recommendations","GET",a,null,this._auth())},getAvailableGenreSeeds:function(){return this.api("/recommendations/available-genre-seeds","GET",null,null,this._auth())},following:function(a,b){return b=b||{},b.type=a,this.api("/me/following","GET",b,null,this._auth())},follow:function(a,b){return this.api("/me/following","PUT",{type:a,ids:b},null,this._auth())},unfollow:function(a,b){return this.api("/me/following","DELETE",{type:a,ids:b},null,this._auth())},userFollowingContains:function(a,b){return this.api("/me/following/contains","GET",{type:a,ids:b},null,this._auth())},followPlaylist:function(a,b,c){return this.api("/users/"+a+"/playlists/"+b+"/followers","PUT",null,{public:c||null},this._auth(!0))},unfollowPlaylist:function(a,b){return this.api("/users/"+a+"/playlists/"+b+"/followers","DELETE",null,null,this._auth())},playlistFollowingContains:function(a,b,c){return this.api("/users/"+a+"/playlists/"+b+"/followers/contains","GET",{ids:c.toString()},null,this._auth())},getSavedUserTracks:function(a){return this.api("/me/tracks","GET",a,null,this._auth())},userTracksContains:function(a){return a=b.isString(a)?a.split(","):a,b.forEach(a,function(b,c){a[c]=b.indexOf("spotify:")>-1?b.split(":")[2]:b}),this.api("/me/tracks/contains","GET",{ids:a.toString()},null,this._auth())},saveUserTracks:function(a){return a=b.isString(a)?a.split(","):a,b.forEach(a,function(b,c){a[c]=b.indexOf("spotify:")>-1?b.split(":")[2]:b}),this.api("/me/tracks","PUT",{ids:a.toString()},null,this._auth())},removeUserTracks:function(a){return a=b.isString(a)?a.split(","):a,b.forEach(a,function(b,c){a[c]=b.indexOf("spotify:")>-1?b.split(":")[2]:b}),this.api("/me/tracks","DELETE",{ids:a.toString()},null,this._auth(!0))},saveUserAlbums:function(a){return a=b.isString(a)?a.split(","):a,b.forEach(a,function(b,c){a[c]=b.indexOf("spotify:")>-1?b.split(":")[2]:b}),this.api("/me/albums","PUT",{ids:a.toString()},null,this._auth())},getSavedUserAlbums:function(a){return this.api("/me/albums","GET",a,null,this._auth())},removeUserAlbums:function(a){return a=b.isString(a)?a.split(","):a,b.forEach(a,function(b,c){a[c]=b.indexOf("spotify:")>-1?b.split(":")[2]:b}),this.api("/me/albums","DELETE",{ids:a.toString()},null,this._auth(!0))},userAlbumsContains:function(a){return a=b.isString(a)?a.split(","):a,b.forEach(a,function(b,c){a[c]=b.indexOf("spotify:")>-1?b.split(":")[2]:b}),this.api("/me/albums/contains","GET",{ids:a.toString()},null,this._auth())},getUserTopArtists:function(a){return a=a||{},this.api("/me/top/artists","GET",a,null,this._auth())},getUserTopTracks:function(a){return a=a||{},this.api("/me/top/tracks","GET",a,null,this._auth())},getUserPlaylists:function(a,b){return this.api("/users/"+a+"/playlists","GET",b,null,this._auth())},getPlaylist:function(a,b,c){return this.api("/users/"+a+"/playlists/"+b,"GET",c,null,this._auth())},getPlaylistTracks:function(a,b,c){return this.api("/users/"+a+"/playlists/"+b+"/tracks","GET",c,null,this._auth())},createPlaylist:function(a,b){return this.api("/users/"+a+"/playlists","POST",null,b,this._auth(!0))},addPlaylistTracks:function(a,c,d,e){return d=b.isArray(d)?d:d.split(","),b.forEach(d,function(a,b){d[b]=-1===a.indexOf("spotify:")?"spotify:track:"+a:a}),this.api("/users/"+a+"/playlists/"+c+"/tracks","POST",{uris:d.toString(),position:e?e.position:null},null,this._auth(!0))},removePlaylistTracks:function(a,c,d){d=b.isArray(d)?d:d.split(",");var e;return b.forEach(d,function(a,b){e=d[b],d[b]={uri:-1===e.indexOf("spotify:")?"spotify:track:"+e:e}}),this.api("/users/"+a+"/playlists/"+c+"/tracks","DELETE",null,{tracks:d},this._auth(!0))},reorderPlaylistTracks:function(a,b,c){return this.api("/users/"+a+"/playlists/"+b+"/tracks","PUT",null,c,this._auth(!0))},replacePlaylistTracks:function(a,c,d){d=b.isArray(d)?d:d.split(",");var e;return b.forEach(d,function(a,b){e=d[b],d[b]=-1===e.indexOf("spotify:")?"spotify:track:"+e:e}),this.api("/users/"+a+"/playlists/"+c+"/tracks","PUT",{uris:d.toString()},null,this._auth(!0))},updatePlaylistDetails:function(a,b,c){return this.api("/users/"+a+"/playlists/"+b,"PUT",null,c,this._auth(!0))},getUser:function(a){return this.api("/users/"+a,"GET",null,null,this._auth())},getCurrentUser:function(){return this.api("/me","GET",null,null,this._auth())},search:function(a,b,c){return c=c||{},c.q=a,c.type=b,this.api("/search","GET",c,null,this._auth())},getTrack:function(a){return a=-1===a.indexOf("spotify:")?a:a.split(":")[2],this.api("/tracks/"+a,"GET",null,null,this._auth())},getTracks:function(a){return a=b.isString(a)?a.split(","):a,b.forEach(a,function(b,c){a[c]=b.indexOf("spotify:")>-1?b.split(":")[2]:b}),this.api("/tracks/","GET",{ids:a?a.toString():""},null,this._auth())},getTrackAudioFeatures:function(a){return a=-1===a.indexOf("spotify:")?a:a.split(":")[2],this.api("/audio-features/"+a,"GET",null,null,this._auth())},getTracksAudioFeatures:function(a){return a=b.isString(a)?a.split(","):a,b.forEach(a,function(b,c){a[c]=b.indexOf("spotify:")>-1?b.split(":")[2]:b}),this.api("/audio-features/","GET",{ids:a?a.toString():""},null,this._auth())},setAuthToken:function(a){return this.authToken=a,this.authToken},login:function(){function a(d){"spotify-token"===d.key&&(m&&m.close(),l=!0,c.setAuthToken(d.newValue),g.removeEventListener("storage",a,!1),b.resolve(d.newValue))}var b=e.defer(),c=this,d=400,f=500,h=screen.width/2-d/2,j=screen.height/2-f/2,k={client_id:this.clientId,redirect_uri:this.redirectUri,scope:this.scope||"",response_type:"token"},l=!1,m=i("https://accounts.spotify.com/authorize?"+this.toQueryString(k),"Spotify","menubar=no,location=no,resizable=yes,scrollbars=yes,status=no,width="+d+",height="+f+",top="+j+",left="+h,function(){l||b.reject()});return g.addEventListener("storage",a,!1),b.promise}},new h}]})}(window,angular),angular.module("cgPrompt",["ui.bootstrap"]),angular.module("cgPrompt").factory("prompt",["$modal","$q",function(a,b){return function(c){var d={title:"",message:"",input:!1,label:"",value:"",values:!1,buttons:[{label:"Cancel",cancel:!0},{label:"OK",primary:!0}]};void 0===c&&(c={});for(var e in d)void 0===c[e]&&(c[e]=d[e]);var f=b.defer();return a.open({templateUrl:"angular-prompt.html",controller:"cgPromptCtrl",resolve:{options:function(){return c}}}).result.then(function(a){c.input?f.resolve(a.input):f.resolve(a.button)},function(){f.reject()}),f.promise}}]),angular.module("cgPrompt").controller("cgPromptCtrl",["$scope","options","$timeout",function(a,b,c){a.input={name:b.value},a.options=b,a.buttonClicked=function(c){return c.cancel?void a.$dismiss():b.input&&angular.element(document.querySelector("#cgPromptForm")).scope().cgPromptForm.$invalid?void(a.changed=!0):void a.$close({button:c,input:a.input.name})},a.submit=function(){var b;angular.forEach(a.options.buttons,function(a){a.primary&&(b=a)}),b&&a.buttonClicked(b)},c(function(){var a=document.querySelector("#cgPromptInput");a&&(a.select&&a.select(),a.focus&&a.focus())},100)}]),angular.module("cgPrompt").run(["$templateCache",function(a){"use strict";a.put("angular-prompt.html",'<div>\n    <div class="modal-header">\n        <button type="button" class="close pull-right" ng-click="$dismiss()" aria-hidden="true">Ã—</button>\n        <h4 class="modal-title">{{options.title}}</h4>\n    </div>\n    <div class="modal-body">\n\n        <p ng-if="options.message">\n            {{options.message}}\n        </p>\n\n        <form id="cgPromptForm" name="cgPromptForm" ng-if="options.input" ng-submit="submit()">\n            <div class="form-group" ng-class="{\'has-error\':cgPromptForm.$invalid && changed}">\n                <label for="cgPromptInput">{{options.label}}</label>\n                <input id="cgPromptInput" type="text" class="form-control"  placeholder="{{options.label}}" ng-model="input.name" required ng-change="changed=true" ng-if="!options.values || options.values.length === 0"/ autofocus="autofocus">\n                <div class="input-group" ng-if="options.values">\n                    <input id="cgPromptInput" type="text" class="form-control" placeholder="{{options.label}}" ng-model="input.name" required ng-change="changed=true" autofocus="autofocus"/>\n\n                    <div class="input-group-btn" dropdown>\n                        <button type="button" class="btn btn-default dropdown-toggle" dropdown-toggle data-toggle="dropdown"><span class="caret"></span></button>\n                        <ul class="dropdown-menu pull-right">\n                            <li ng-repeat="value in options.values"><a href="" ng-click="input.name = value">{{value}}</a></li>\n                        </ul>\n                    </div>\n                </div>\n            </div>\n         </form>\n\n    </div>\n    <div class="modal-footer">\n        <button ng-repeat="button in options.buttons track by button.label" class="btn btn-default {{button.class}}" ng-class="{\'btn-primary\':button.primary}" ng-click="buttonClicked(button)">{{button.label}}</button>\n    </div>\n</div>')}]),angular.module("templates-app",["account/menu.tmpl.html","account/services/facebook/menu.tmpl.html","account/services/services.menu.tmpl.html","account/services/services.tmpl.html","account/services/spotify/menu.tmpl.html","account/services/spotify/spotify.tmpl.html","account/services/sync/menu.tmpl.html","account/services/sync/sync.tmpl.html","account/settings/settings.tmpl.html","dashboard/dashboard.tmpl.html","directives/album.directive.tmpl.html","directives/artist.directive.tmpl.html","directives/browse.directive.tmpl.html","directives/playlist.directive.tmpl.html","directives/service.directive.tmpl.html","directives/station.directive.tmpl.html","directives/track.directive.tmpl.html","discover/browse/browse.tmpl.html","discover/featured/featured.tmpl.html","discover/menu.tmpl.html","discover/newreleases/newreleases.tmpl.html","modals/playlistselect.tmpl.html","music/artist/artist.tmpl.html","music/library/albums/albums.tmpl.html","music/library/artists/artists.tmpl.html","music/library/playlists/playlists.tmpl.html","music/menu.tmpl.html","music/stations/stations.tmpl.html","music/tracklist/tracklist.tmpl.html","player/controls/controls.left.tmpl.html","player/controls/controls.right.tmpl.html","player/player.tmpl.html","player/seekbar/seekbar.tmpl.html","search/menu.tmpl.html","search/search.tmpl.html"]),angular.module("account/menu.tmpl.html",[]).run(["$templateCache",function(a){a.put("account/menu.tmpl.html",'<div class="block row" id="yourmusic">\n    <div class="title">Account</div>\n    <div class="content">\n        <ul>\n            <li><a href="#/account/settings">Settings</a></li>\n            <li><a href="#/account/services">Services</a></li>\n        </ul>\n    </div>\n</div>')}]),angular.module("account/services/facebook/menu.tmpl.html",[]).run(["$templateCache",function(a){a.put("account/services/facebook/menu.tmpl.html",'<section id="spotifyuser" class="account" ng-controller="FacebookMenuController">\n    <div class="profileimage">\n        <img ng-src="{{ userProfile.profile_image }}" />\n    </div>\n    <div class="content">\n        <span class="username" ng-show="authorized">\n            {{ userProfile.first_name }} {{ userProfile.last_name }}\n        </span>\n        <span class="username" ng-hide="authorized">\n        Connecting...\n        </span>\n        <span class="status">\n'+"            <div class=\"connection\" ng-class=\"authorized == true ? 'connected' : 'disconnected'\"></div> {{ authorized == true ? 'connected' : 'disconnected' }} - Facebook\n        </span>\n    </div>\n</section>")}]),angular.module("account/services/services.menu.tmpl.html",[]).run(["$templateCache",function(a){a.put("account/services/services.menu.tmpl.html",'<div id="accounts" ng-controller="AccountServicesMenuController" ng-class="(connectedCount > 2) ? \'small\' : \'\'">\n    <div class="title"><a href="#/account/services">Connected services</a></div>\n\n    <ng-include ng-if="connectedServices.spotify" src="\'account/services/spotify/menu.tmpl.html\'"></ng-include>\n    <ng-include ng-if="connectedServices.facebook" src="\'account/services/facebook/menu.tmpl.html\'"></ng-include>\n    <ng-include ng-if="connectedServices.sync" src="\'account/services/sync/menu.tmpl.html\'"></ng-include>\n\n    <div ng-if="!hasServicesConnected">\n        <div class="notify"><a href="#/account/services">You have no connected services. Click here to connect a service.</a></div>\n    </div>\n</div>')}]),angular.module("account/services/services.tmpl.html",[]).run(["$templateCache",function(a){a.put("account/services/services.tmpl.html",'<div id="header" class="small row" style="background-image: url(\'./assets/images/services-header.jpg\');">\n    <div class="col-md-10 lefttext">\n        <div class="inner"><i class="ss-icon ss-merge"></i>  Services</div>\n    </div>\n</div>\n\n<div id="overview" class="row">\n    <div class="pagetitle row">\n        <div class="col-md-3">\n            services </span>\n        </div>\n        <div class="col-md-6 col-md-offset-3 alignright">\n        </div>\n    </div>\n\n    <div class="row note">\n        <div class="col-md-10">\n            <p>Note: browsers are likely to block the login popups. Please enable popups from this domain to prevent the browser from blocking them.</p>\n        </div>\n    </div>\n\n    <div class="pagecontent row">\n        <div id="tileview">\n            <div class="row">\n                <div ng-repeat="service in availableServices"> \n                    <mopify-service service="service" class="col-lg-2 col-md-3 col-sm-4 col-xs-6 single-tile service"></mopify-service>\n                    <div ng-if="($index + 1) % 6 == 0" class="row"></div>\n                </div>\n            </div>\n        </div>\n    </div>\n</div>')}]),angular.module("account/services/spotify/menu.tmpl.html",[]).run(["$templateCache",function(a){a.put("account/services/spotify/menu.tmpl.html",'<section id="spotifyuser" class="account" ng-controller="SpotifyMenuController">\n    <div class="profileimage">\n        <img src="./assets/images/spotify-icon.png" ng-src="{{ userProfile.images[0].url }}" />\n    </div>\n    <div class="content">\n        <span class="username" ng-show="authorized">\n            {{ userProfile.display_name || userProfile.id }}\n        </span>\n        <span class="username" ng-hide="authorized">\n        Connecting...\n        </span>\n        <span class="status">\n'+"            <div class=\"connection\" ng-class=\"authorized == true ? 'connected' : 'disconnected'\"></div> {{ authorized == true ? 'connected' : 'disconnected' }} - Spotify\n        </span>\n    </div>\n</section>")}]),angular.module("account/services/spotify/spotify.tmpl.html",[]).run(["$templateCache",function(a){a.put("account/services/spotify/spotify.tmpl.html",'<div id="header" class="small row" style="background-image: url(\'./assets/images/spotify-header.jpg\');">\n    <div class="col-md-10 lefttext">\n        <div class="inner"><i class="ss-icon ss-settings"></i>  Settings</div>\n    </div>\n</div>\n\n<div id="overview" class="row">\n    <div class="pagetitle row">\n        <div class="col-md-3">\n            Service <span class="sub">Spotify</span>\n        </div>\n    </div>\n    <div class="pagecontent row">\n        <div class="settingwrap row">\n            <div class="label col-md-2">\n                <label>Description</label>\n            </div>\n            <div class="description col-md-8">\n                <p>The Spotify service adds extra features like Featured Playlists, New Releases and managing playlists.</p>\n            </div>\n        </div>\n    </div>\n\n    <div class="pagetitle row">\n        <div class="col-md-3">\n            Settings <span class="sub">Spotify</span>\n        </div>\n    </div>\n    <div class="pagecontent row">\n        <div class="settingwrap row">\n            <div class="label col-md-2">\n                <label>Use Spotify as playlist source</label>\n            </div>\n            <div class="input col-md-4">\n                <toggle-switch ng-model="settings.spotify.loadspotifyplaylists"><toggle-switch>\n            </div>\n            <div class="description col-md-4 col-md-offset-1">\n                <p>When enabled playlists will be loaded from your connected Spotify account instead of Mopidy. The playlist folder structure won\'t be visible when this option is enabled.</p>\n            </div>\n        </div>\n    </div>\n\n    <div class="pagetitle row">\n        <div class="col-md-3">\n            Account <span class="sub">Spotify</span>\n        </div>\n    </div>\n    <div class="pagecontent row">\n        <div class="settingwrap row">\n            <div class="label col-md-2">\n                <label>Profile name</label>\n            </div>\n            <div class="input col-md-4">\n                <input type="text" value="{{ profile.display_name }}" readonly="readonly">\n            </div>\n            <div class="description col-md-4 col-md-offset-1">\n                <p>The profile name of the current logged in Spotfiy user.</p>\n            </div>\n        </div>\n        <div class="settingwrap row">\n            <div class="label col-md-2">\n                <label>Reconnect</label>\n            </div>\n            <div class="input col-md-4">\n                <div class="button white fullwidth" ng-click="reconnect()">\n                    <span class="text">Reconnect with Spotify</span>\n                    <i class="ss-icon ss-refresh"></i> \n                </div>\n            </div>\n            <div class="description col-md-4 col-md-offset-1">\n                <p>Use this button to reconnect with Spotify. This can be usefull if you wan\'t to login with an other account.</p>\n            </div>\n        </div>\n    </div>\n\n</div>')}]),angular.module("account/services/sync/menu.tmpl.html",[]).run(["$templateCache",function(a){a.put("account/services/sync/menu.tmpl.html",'<section id="sync" class="account" ng-controller="SyncMenuController">\n    <div class="profileimage">\n        <img src="./assets/images/sync-icon-menu.png" />\n    </div>\n    <div class="content">\n        <span class="username">\n            {{ client.name }}\n        </span>\n        <span class="status">\n            <div class="connection connected"></div>Connected - Sync Service\n        </span>\n    </div>\n</section>')}]),angular.module("account/services/sync/sync.tmpl.html",[]).run(["$templateCache",function(a){a.put("account/services/sync/sync.tmpl.html",'<div id="header" class="small row" style="background-image: url(\'./assets/images/sync-header.jpg\');">\n    <div class="col-md-10 lefttext">\n        <div class="inner"><i class="ss-icon ss-settings"></i>  Settings</div>\n    </div>\n</div>\n\n<div id="overview" class="row">\n    <div class="pagetitle row">\n        <div class="col-md-3">\n            Service <span class="sub">Sync</span>\n        </div>\n    </div>\n    <div class="pagecontent row">\n        <div class="settingwrap row">\n            <div class="label col-md-2">\n                <label>Description</label>\n            </div>\n            <div class="description col-md-8">\n                <p>The Sync service extends Mopify with the possibility to synchronize the settings and credentials of other services (like Spotify) with other Mopify clients in your network. There is no difference between a master or slave. Which means that every \'client\' can override the synced data by clicking on \'Push\'.</p>\n            </div>\n        </div>\n    </div>\n\n    <div class="pagetitle row">\n        <div class="col-md-3">\n            Settings <span class="sub">Sync</span>\n        </div>\n    </div>\n    <div class="pagecontent row">\n        <div class="settingwrap row">\n            <div class="label col-md-2">\n                <label>Force synchronisation</label>\n            </div>\n            <div class="input col-md-4">\n                <toggle-switch ng-model="settings.sync.force" ng-click="forceToggle()"></toggle-switch>\n            </div>\n            <div class="description col-md-4 col-md-offset-1">\n                <p>When enabled every new client which connects to the provided Mopidy server and enabled the Sync service will automatically retrieve all synced credentials.</p>\n            </div>\n        </div>\n    </div>\n\n    <div class="pagetitle row">\n        <div class="col-md-3">\n            Services <span class="sub">Sync</span>\n        </div>\n    </div>\n    <div class="pagecontent row">\n        <div class="settingwrap row">\n            <div class="label col-md-2">\n                <label>Spotify credentials</label>\n            </div>\n            <div class="input col-md-1">\n                <toggle-switch ng-model="settings.sync.spotify" ng-click="spotifyToggle()"></toggle-switch>\n            </div>\n            <div class="col-md-3">\n                <div class="row">\n                    <div class="col-sm-6">\n                        <div class="button white fullwidth" ng-click="sendCurrentSpotifyTokens()" ng-show="settings.sync.spotify">\n                            <span class="text">Push</span>\n                            <i class="ss-icon ss-upload"></i>\n                        </div>\n                    </div>\n                    <div class="col-sm-6">\n                        <div class="button white fullwidth" ng-click="getSyncSpotifyTokens()" ng-show="settings.sync.spotify">\n                            <span class="text">Get</span>\n                            <i class="ss-icon ss-download"></i>\n                        </div>\n                    </div>\n                </div>\n            </div>\n\n            <div class="description col-md-4 col-md-offset-1">\n                <p>When enabled every client that has Sync enabled will use the same Spotify credentials.</p>\n                <p><b>GET:</b> Retrieve the credentials from the Sync server<br/><b>PUSH:</b> Push your current credentials to the sync server</p>\n                <p ng-show="settings.sync.spotify">Currently using credentials from device: <i>{{ spotifyclient.name }} <span ng-show="spotifyclient.id == client.id">(That\'s you)</span></i></p>\n            </div>\n        </div>\n\n    </div>\n\n    <div class="pagetitle row">\n        <div class="col-md-3">\n            Client <span class="sub">Sync</span>\n        </div>\n    </div>\n    <div class="pagecontent row">\n        <div class="settingwrap row">\n            <div class="label col-md-2">\n                <label>Client name</label>\n            </div>\n            <div class="input col-md-4">\n                <input type="text" ng-model="client.name" ng-blur="updateClient()">\n            </div>\n            <div class="description col-md-4 col-md-offset-1">\n                <p>The name of this client which will be used to identify this client against the others in your network. You can change this name to something more human.</p>\n            </div>\n        </div>\n    </div>\n\n</div>')}]),angular.module("account/settings/settings.tmpl.html",[]).run(["$templateCache",function(a){
a.put("account/settings/settings.tmpl.html",'<div id="header" class="small row" style="background-image: url(\'./assets/images/settings-header.jpg\');">\n    <div class="col-md-10 lefttext">\n        <div class="inner"><i class="ss-icon ss-settings"></i> Settings</div>\n    </div>\n</div>\n\n<div id="overview" class="row">\n    <div class="pagetitle row">\n        <div class="col-md-3">\n            Settings <span class="sub">Mopidy</span>\n        </div>\n\n        <div class="col-md-3 col-md-offset-6 alignright">\n            <div class="button white" ng-class="{ active: buttonactive }">\n                <span class="text">Saved automatically</span>\n                <i class="ss-icon ss-sync"></i>\n            </div>\n        </div>\n    </div>\n\n    <div class="pagecontent row">\n        <div class="settingwrap row">\n            <div class="label col-md-2">\n                <label for="mopidyip">Mopidy IP address</label>\n            </div>\n            <div class="input col-md-4">\n                <input name="mopidyip" placeholder="For example: 192.168.1.1 or localhost" ng-model="settings.mopidyip"\n                    ng-blur="highlightSaveButton()" class="field" />\n            </div>\n            <div class="description col-md-4 col-md-offset-1">\n                <p>Change this IP address if Mopidy is running on a different computer than Mopify. Normally you don\'t\n                    have to change this IP address</p>\n                <p><i>New Mopidy connection settings will be applied after a page refresh.</i></p>\n            </div>\n        </div>\n        <div class="settingwrap row">\n            <div class="label col-md-2">\n                <label for="mopidyport">Mopidy port</label>\n            </div>\n            <div class="input col-md-4">\n                <input name="mopidyport" placeholder="For example: 6680" ng-model="settings.mopidyport"\n                    ng-blur="highlightSaveButton()" class="field" />\n            </div>\n            <div class="description col-md-4 col-md-offset-1">\n                <p>Change this port if Mopidy is running on a port other than 6680. Normally you don\'t have to change\n                    this port.</p>\n                <p><i>New Mopidy connection settings will be applied after a page refresh.</i></p>\n            </div>\n        </div>\n    </div>\n\n    <div class="pagetitle row">\n        <div class="col-md-3">\n            Settings <span class="sub">Localization</span>\n        </div>\n    </div>\n    <div class="pagecontent row">\n        <div class="settingwrap row">\n            <div class="label col-md-2">\n                <label for="mopidyip">Language code</label>\n            </div>\n            <div class="input col-md-4">\n                <input name="locale" placeholder="For example: nl_NL" ng-model="settings.locale"\n                    ng-blur="highlightSaveButton()" class="field" />\n            </div>\n            <div class="description col-md-4 col-md-offset-1">\n                <p>The desired language, consisting of a lowercase <a href="http://en.wikipedia.org/wiki/ISO_639"\n                        target="_blank">ISO 639</a> language code and an uppercase <a\n                        href="http://en.wikipedia.org/wiki/ISO_3166-1_alpha-2" target="_blank">ISO 3166-1 alpha-2</a>\n                    country code, joined by an underscore. </p>\n                <p>This language code is used for services like Spotify to provide better content.</p>\n            </div>\n        </div>\n        <div class="settingwrap row">\n            <div class="label col-md-2">\n                <label for="mopidyip">Country code</label>\n            </div>\n            <div class="input col-md-4">\n                <input name="locale" placeholder="For example: NL" ng-model="settings.country"\n                    ng-blur="highlightSaveButton()" class="field" />\n            </div>\n            <div class="description col-md-4 col-md-offset-1">\n                <p>An <a href="http://en.wikipedia.org/wiki/ISO_3166-1_alpha-2" target="_blank">ISO 3166-1 alpha-2</a>\n                    country code which is used to localize services like Spotify.</p>\n            </div>\n        </div>\n    </div>\n\n    <div class="pagetitle row">\n        <div class="col-md-3">\n            Settings <span class="sub">Personalization</span>\n        </div>\n    </div>\n    <div class="pagecontent row">\n        <div class="settingwrap row">\n            <div class="label col-md-2">\n                <label for="startpage">Startpage</label>\n            </div>\n            <div class="input col-md-4">\n                <input name="Start page" placeholder="For example: /music/playlists" ng-model="settings.startpage"\n                    ng-blur="highlightSaveButton()" class="field" />\n            </div>\n            <div class="description col-md-4 col-md-offset-1">\n                <p>Enter the URL of the page you want to see when starting Mopify.<br /><b>Warning:</b> entering an URL\n                    that doesn\'t exist will result in a redirect loop.</p>\n            </div>\n        </div>\n    </div>\n    <div class="pagetitle row">\n        <div class="col-md-3">\n            Settings <span class="sub">Automatic updating (BETA)</span>\n        </div>\n    </div>\n    <div class="pagecontent row">\n        <div class="settingwrap row">\n            <div class="label col-md-2">\n                <label>Automatically update to new versions</label>\n            </div>\n            <div class="input col-md-4">\n                <toggle-switch ng-model="settings.autoupdate" ng-disabled="!autoupdate">\n                    <toggle-switch>\n            </div>\n            <div class="description col-md-4 col-md-offset-1">\n                <p>Automatically update to a new version when available. This feature can only be used when Mopidy is\n                    running as root.</p>\n                <p ng-if="!autoupdate"><b>Run Mopidy as root to enable automatic updating</b></p>\n            </div>\n        </div>\n    </div>\n\n    <div class="pagetitle row">\n        <div class="col-md-3">\n            Settings <span class="sub">Title</span>\n        </div>\n    </div>\n    <div class="pagecontent row">\n        <div class="settingwrap row">\n            <div class="label col-md-2">\n                <label>Show current track in page title</label>\n            </div>\n            <div class="input col-md-4">\n                <toggle-switch ng-model="settings.pagetitle">\n                    <toggle-switch>\n            </div>\n            <div class="description col-md-4 col-md-offset-1">\n                <p>Enable this function to show the currnet playing track in the page title. Some people don\'t like this\n                    bedause it will make your pinned tab \'glow\' in Chrome.</p>\n            </div>\n        </div>\n    </div>\n\n    <div class="pagetitle row">\n        <div class="col-md-3">\n            About <span class="sub">Mopify</span>\n        </div>\n    </div>\n    <div class="pagecontent row">\n        <div class="settingwrap row">\n            <div class="label col-md-2">\n                <label>Support</label>\n            </div>\n            <div class="description col-md-6">\n                <p>Mopify is just like many other Open Source projects maintained in my free time. If you like it and\n                    want to support this project you can make a <a href="https://pledgie.com/campaigns/28130"\n                        target="_blank">donation via Pledgie</a>, or directly via <a\n                        href="https://www.paypal.com/cgi-bin/webscr?cmd=_s-xclick&hosted_button_id=QUDAJBCJVP2G6"\n                        target="_blank">PayPal</a>.</p>\n                <p>Don\'t want to donate? No hard feelings! You can also help me a lot by giving me your feedback. You\n                    can do this via the <a href="https://github.com/dirkgroenen/mopidy-mopify/issues"\n                        target="_blank">Github Issues</a> page, or just send me an e-mail. </p>\n            </div>\n        </div>\n        <div class="settingwrap row">\n            <div class="label col-md-2">\n                <label>Author</label>\n            </div>\n            <div class="description col-md-6">\n                <p><a href="https://github.com/dirkgroenen/mopidy-mopify" target="_blank">Mopify</a> is a project\n                    developed by <a href="http://github.com/dirkgroenen" target="_blank">Dirk Groenen</a>.</p>\n            </div>\n        </div>\n        <div class="settingwrap row">\n            <div class="label col-md-2">\n                <label>License</label>\n            </div>\n            <div class="description col-md-6">\n                <p>Licensed under the <a href="https://github.com/dirkgroenen/mopidy-mopify/blob/master/LICENSE.md"\n                        target="_blank">Apache 2 license</a>.</p>\n            </div>\n        </div>\n\n        <div class="settingwrap row">\n            <div class="label col-md-2">\n                <label>Version</label>\n            </div>\n            <div class="description col-md-6">\n                <p>Current version: {{ mopifyversion }}</p>\n                <p ng-if="newversion" style="font-weight: bold">A new version of Mopify is available\n                    ({{ newversionnumber }}). Read the <a\n                        href="https://github.com/dirkgroenen/mopidy-mopify/blob/master/README.md" target="_blank">Github\n                        readme</a> on how to update mopify or use the button below.</p>\n                <div class="button white fullwidth" ng-click="update()"\n                    ng-if="newversion == true && autoupdate == true">\n                    <span class="text">Autoupdate Mopify to version: {{ newversionnumber }}</span>\n                    <i class="ss-icon ss-refresh"></i>\n                </div>\n                <div class="button white fullwidth" ng-if="newversion == true && autoupdate == false">\n                    <span class="text">Autoupdate isn\'t possible. Is Mopidy running as root user?</span>\n                    <i class="ss-icon ss-refresh"></i>\n                </div>\n            </div>\n        </div>\n\n        <div class="settingwrap row">\n            <div class="label col-md-2">\n                <label>Contact</label>\n            </div>\n            <div class="description col-md-6">\n                <p>Encounter problems or having questions while using Mopify? Please post them on <a\n                        href="https://github.com/dirkgroenen/mopidy-mopify/issues" target="_blank">Mopify\'s Github\n                        page</a>.</p>\n            </div>\n        </div>\n    </div>\n</div>')}]),angular.module("dashboard/dashboard.tmpl.html",[]).run(["$templateCache",function(a){a.put("dashboard/dashboard.tmpl.html","")}]),angular.module("directives/album.directive.tmpl.html",[]).run(["$templateCache",function(a){a.put("directives/album.directive.tmpl.html",'<div ng-show="visible">\n    <div class="tileart" context-menu="onContextShow()" data-target="menu-{{ album.uri }}" ng-click="openAlbumTracklist()">\n        <div class="hoverwrap">\n            <div class="iconwrap row">\n                <div class="icon small col-xs-4" title="Show album\'s tracks">\n                    <a href="#{{ tracklistUrl }}"><i class="ss-icon ss-list"></i></a>\n                </div>\n                <div class="icon col-xs-4" title="Play album">\n                    <i class="ss-icon ss-play" ng-click="play()" stop-propagation></i>\n                </div>\n                <div class="icon small col-xs-4" title="Start new station for: {{ album.name }}">\n                    <i class="ss-icon ss-wifi" ng-click="startStation()" stop-propagation></i>\n                </div>\n            </div>\n        </div>\n\n        <img ng-src="{{ album.images[1].url }}" />\n    </div>\n    <div class="tileinfo clickable" context-menu="onContextShow()"\n        data-target="menu-{{ album.uri }}">\n        <a href="#{{ tracklistUrl }}">\n            <span class="name">{{ ::album.name}}</span>\n            <span class="year">{{ ::artiststring }}</span>\n        </a>\n    </div>\n\n    <div class="contextmenu position-fixed" id="menu-{{ album.uri }}">\n        <ul class="dropdown-menu" role="menu">\n            <li ng-click="play()">\n                Play\n            </li>\n            <li ng-click="addToQueue()">\n                Add to queue\n            </li>\n            <li class="divider"></li>\n            <li ng-click="showPlaylists()">\n                Add to playlist\n            </li>\n            <li class="divider"></li>\n            <li ng-click="startStation()">\n                Start station\n            </li>\n            <li class="divider"></li>\n            <li ng-click="toggleSaveAlbum()" ng-show=\'showSaveAlbum\'>\n'+"                {{ (albumAlreadySaved) ? 'Remove album' : 'Save album' }}\n            </li>\n        </ul>\n    </div>\n</div>")}]),angular.module("directives/artist.directive.tmpl.html",[]).run(["$templateCache",function(a){a.put("directives/artist.directive.tmpl.html",'<div class="tileart" context-menu="onContextShow()" data-target="menu-{{ artist.uri }}" ng-class="{ \'highlight\': highlight, \'expanded\' : expanded }" ng-click="openArtistPage()">\n    <div class="hoverwrap">\n        <div class="iconwrap row">\n            <div class="icon small col-xs-4" title="Show artist\'s tracks">\n                <a href="#/music/artist/{{ artist.uri }}"><i class="ss-icon ss-list"></i></a>\n            </div>\n            <div class="icon col-xs-4" title="Play artist">\n                <i class="ss-icon ss-play" ng-click="play()" stop-propagation></i>\n            </div>\n            <div class="icon small col-xs-4" title="Start new station for: {{ artist.name }}">\n                <i class="ss-icon ss-wifi" ng-click="startStation()" stop-propagation></i>\n            </div>\n        </div>\n    </div>\n\n    <img ng-src="{{ artist.images[1].url }}" />\n</div>\n<div class="tileinfo clickable">\n    <a href="#/music/artist/{{ artist.uri }}">\n        <span class="name">{{ artist.name}}</span>\n    </a>\n</div>\n\n<div class="contextmenu position-fixed" id="menu-{{ artist.uri }}">\n    <ul class="dropdown-menu" role="menu">\n        <li ng-click="play()">\n            Play\n        </li>\n        <li ng-click="addToQueue()">\n            Add to queue\n        </li>\n        <li class="divider"></li>\n        <li ng-click="startStation()">\n            Start station\n        </li>\n        <li class="divider"></li>\n        <li ng-click="toggleFollowArtist()" ng-show=\'showFollowArtist\'>\n'+"            {{ (followingArtist) ? 'Unfollow artist' : 'Follow artist' }}\n        </li>\n    </ul>\n</div>")}]),angular.module("directives/browse.directive.tmpl.html",[]).run(["$templateCache",function(a){a.put("directives/browse.directive.tmpl.html",'<div class="browseitem">\n    <div class="text">\n        <span ng-bind-html="titleslogan"></span>\n    </div>\n    <div class="imagewrap">\n        <div class="hoverwrap">\n            <div class="iconwrap row">\n                <div class="icon small col-xs-4" title="Show tracks">\n                    <a href="#/music/artist/{{ spotifyuri }}" ng-if="item.type == \'artist\'"><i class="ss-icon ss-list"></i></a>\n                    <a href="#/music/tracklist/{{ spotifyuri }}" ng-if="item.type == \'spotify\'"><i class="ss-icon ss-list"></i></a>\n                </div>\n                <div class="icon col-xs-4" title="Play">\n                    <i class="ss-icon ss-play" ng-click="play()"></i>\n                </div>\n                <div class="icon small col-xs-4" title="Start new station for: {{ suggestion.name }}">\n                    <i class="ss-icon ss-wifi" ng-click="startStation()"></i>\n                </div>\n            </div>\n        </div>\n\n        <img ng-src="{{ image }}"/>\n    </div>\n    <div class="text">\n        <span class="title">{{ suggestion.name }}</span><br>\n        <span class="artist" ng-if="suggestion.artist">{{ suggestion.artist }}</span>\n    </div>\n</div>')}]),angular.module("directives/playlist.directive.tmpl.html",[]).run(["$templateCache",function(a){a.put("directives/playlist.directive.tmpl.html",'<div class="tileart" context-menu data-target="menu-{{ ::playlist.uri }}" ng-class="{ \'highlight\': highlight, \'expanded\' : expanded }">\n    <div class="hoverwrap" ng-click="openPlaylistTracklist()">\n        <div class="iconwrap row">\n            <div class="icon small col-xs-4" title="Show playlist\'s tracks">\n                <a href="#{{ tracklistUrl }}"><i class="ss-icon ss-list"></i></a>\n            </div>\n            <div class="icon col-xs-4" title="Play playlist">\n                <i class="ss-icon ss-play" ng-click="play()" stop-propagation></i>\n            </div>\n            <div class="icon small col-xs-4" title="Start new station for: {{ ::playlist.name }}">\n                <i class="ss-icon ss-wifi" ng-click="startStation()" stop-propagation></i>\n            </div>\n        </div>\n    </div>\n\n    <img ng-src="{{ coverImage }}" />\n</div>\n<div class="tileinfo clickable">\n    <a href="#{{ tracklistUrl }}">\n        <span class="name">{{ ::playlist.name}}</span>\n        <span class="year">{{ ::(playlist.tracks.length || playlist.tracks.total) }} tracks</span>\n    </a>\n</div>\n\n<div class="contextmenu position-fixed" id="menu-{{ ::playlist.uri }}">\n    <ul class="dropdown-menu" role="menu">\n        <li ng-click="play()">\n            Play\n        </li>\n        <li ng-click="addToQueue()">\n            Add to queue\n        </li>\n        <li class="divider"></li>\n        <li ng-click="startStation()">\n            Start station\n        </li>\n    </ul>\n</div>')}]),angular.module("directives/service.directive.tmpl.html",[]).run(["$templateCache",function(a){a.put("directives/service.directive.tmpl.html",'<div class="tileart">\n    <div class="hoverwrap">\n        <div class="iconwrap">\n            <div class="icon" ng-class="(service.hasSettings && service.connected) ? \'col-xs-6\' : \'col-xs-12\'" title="Connect/Disconnect service">\n                <i class="ss-icon " ng-class="!service.connected ? \'ss-contract\' : \'ss-expand\'" ng-click="!service.connected ? connectService() : disconnectService()"></i>\n            </div>\n            <div class="icon col-xs-6" ng-if="(service.hasSettings && service.connected)" title="Open service\'s settings">\n                <a href="#/account/services/{{ service.name.replace(\' \', \'\').toLowerCase() }}"><i class="ss-icon ss-settings"></i></a>\n            </div>\n        </div>\n    </div>\n    <img ng-src="{{ service.image }}"/>\n</div>\n<div class="tileinfo">\n    <span class="name">{{ service.name }} <div class="status"><div class="connection" ng-class="service.connected ? \'connected\' : \'disconnected\'"></div></div></span>\n    <span class="year">{{ service.description }}</span>\n</div>')}]),angular.module("directives/station.directive.tmpl.html",[]).run(["$templateCache",function(a){a.put("directives/station.directive.tmpl.html",'<div class="col-lg-2 col-md-3 col-sm-4 col-xs-6 single-tile" ng-show="visible">\n    <div class="tileart" context-menu\n         data-target="menu-{{ index }}"\n         ng-class="{ \'highlight\': highlight, \'expanded\' : expanded }">\n        <div class="hoverwrap">\n            <div class="iconwrap">\n                <div class="icon" title="Start station">\n                    <i class="ss-icon ss-wifi" ng-click="start()"></i>\n                </div>\n            </div>\n        </div>\n        <img ng-src="{{ station.coverImage }}"/>\n    </div>\n    <div class="tileinfo">\n        <a href="{{ getStationUrl() }}">\n            <span class="name">{{ station.name }}</span>\n            <span class="year">Radio type: {{ station.type }}</span>\n        </a>\n    </div>\n    <div class="contextmenu position-fixed" id="menu-{{ index }}">\n        <ul class="dropdown-menu" role="menu">\n            <li ng-click="start()">\n                Start\n            </li>\n            <li class="divider"></li>\n            <li ng-click="delete()">\n                Delete\n            </li>\n        </ul>\n    </div>\n</div>')}]),angular.module("directives/track.directive.tmpl.html",[]).run(["$templateCache",function(a){a.put("directives/track.directive.tmpl.html",'<div class="track" context-menu="onContextShow()" context-menu-close="onContextClose()"\n    data-target="{{ ::(track.uri || track.tlid) }}"\n    ng-class="{ \'highlight\': highlight, \'expanded\' : expanded, \'loading\': track.loading, \'selected\': selected }"\n    hm-doubletap="play()"\n    ng-click="selectTrack($event)"\n    ng-show="visible">\n\n    <div class="row" ng-class="{\'nowplaying\': ($parent.currentPlayingTrack.uri == track.uri)}">\n        <div class="col-sm-4 col-xs-12 name">\n            {{ ::track.name }}\n        </div>\n        <div class="col-sm-3 col-xs-6 artists">\n            <span ng-bind-html="::artistsString()"></span>\n        </div>\n        <div class="col-sm-4 col-xs-6 album">\n            <a href="#/music/tracklist/{{ ::track.album.uri }}/{{ ::track.album.name }}">{{ ::track.album.name }}</a>\n        </div>\n        <div class="col-sm-1 visible-lg-block visible-md-block visible-sm-blocklength">\n            {{ ::lengthHuman() }}\n        </div>\n    </div>\n</div>\n\n<div class="contextmenu position-fixed" id="{{ ::(track.uri || track.tlid) }}">\n    <ul class="dropdown-menu" role="menu">\n        <li ng-click="play()">\n            Play track<span ng-show="multipleselected">s</span>\n        </li>\n        <li ng-click="playNext()" ng-hide="multipleselected">\n            Play next\n        </li>\n        <li class="divider"></li>\n        <li ng-click="addToQueue()">\n            Add track<span ng-show="multipleselected">s</span> to queue\n        </li>\n        <li ng-show="$parent.type == \'tracklist\'" ng-click="removeFromQueue()">\n            Remove from queue\n        </li>\n        <li class="divider"></li>\n        <li ng-click="startStation()">\n            Start station\n        </li>\n        <li class="divider"></li>\n        <li ng-click="showPlaylists()">\n            Add to playlist\n        </li>\n        <li ng-if="$parent.isowner" ng-click="removeFromPlaylist()">\n            Remove from playlist\n        </li>\n        <li class="divider"></li>\n        <li ng-click="toggleSaveTrack()" ng-show=\'showSaveTrack\'>\n            {{ (trackAlreadySaved) ? \'Remove track from library\' : \'Save track in library\' }}\n        </li>\n        <li class="divider"></li>\n        <li class="clip-text" data-clipboard-text="{{ ::track.uri }}" ng-hide="multipleselected" ng-if="::track.uri">\n            Copy Spotify URI\n        </li>\n        <li class="clip-text" data-clipboard-text="{{ ::track.http_uri }}" ng-hide="multipleselected" ng-if="::track.http_uri">\n            Copy HTTP Link\n        </li>\n    </ul>\n</div>')}]),angular.module("discover/browse/browse.tmpl.html",[]).run(["$templateCache",function(a){a.put("discover/browse/browse.tmpl.html",'<div id="header" class="small row" style="background-image: url(\'./assets/images/discover-header.jpg\');">\n    <div class="col-md-4 lefttext">\n        <div class="inner"><i class="ss-icon ss-list"></i>  Browse</div>\n    </div>\n</div>\n\n<div id="overview" class="row">\n    <div class="pagetitle row">\n        <div class="col-md-3">\n            Discover <span class="sub">Browse</span>\n        </div>\n        <div class="col-md-6 col-md-offset-3 alignright">\n            <div class="button white" ng-click="startStation()">\n                <span class="text">Start station</span>\n                <i class="ss-icon ss-wifi"></i> \n            </div>\n        </div>\n    </div>\n\n    <div class="pagecontent row">\n        <div id="browsewrap">\n            <div class="row">\n                <div class="col-lg-3 col-md-4 col-sm-6 col-xs-12">\n                     <div ng-repeat="item in blocks" ng-if="$index % 4 == 0">\n                        <mopify-browse item="item"></mopify-browse>\n                    </div>\n                </div>\n                <div class="col-lg-3 col-md-4 col-sm-6 col-xs-12 visible-lg-block visible-md-block visible-sm-block">\n                    <div ng-repeat="item in blocks" ng-if="$index % 4 == 1">\n                        <mopify-browse item="item"></mopify-browse>\n                    </div>\n                </div>\n                <div class="col-lg-3 col-md-4 col-sm-6 col-xs-12 visible-lg-block visible-md-block">\n                    <div ng-repeat="item in blocks" ng-if="$index % 4 == 2">\n                        <mopify-browse item="item"></mopify-browse>\n                    </div>\n                </div>\n                <div class="col-lg-3 col-md-3 col-sm-6 col-xs-12 visible-lg-block">\n                    <div ng-repeat="item in blocks" ng-if="$index % 4 == 3">\n                        <mopify-browse item="item"></mopify-browse>\n                    </div>\n                </div>\n            </div>\n        </div>\n    </div>\n</div>')}]),angular.module("discover/featured/featured.tmpl.html",[]).run(["$templateCache",function(a){a.put("discover/featured/featured.tmpl.html",'<div id="header" class="big row" style="background-image: url(\'./assets/images/discover-header.jpg\');">\n    <div id="featured">\n        <div class="row">\n            <div class="col-lg-8 col-lg-offset-2">\n                <div class="title">\n                    {{ titletext }}\n                </div>\n            </div>\n        </div>\n        <div class="row" ng-show="headerplaylist.tracks != null">\n            <div class="playlist col-lg-4 col-md-8 col-sm-10 col-lg-offset-4 col-md-offset-2 col-sm-offset-1">\n                <div class="cover">\n                    <img ng-src="{{ headerplaylist.images[0].url }}" />\n                </div>\n                <div class="details">\n                    <div class="tracklist">\n                        <div class="row track" ng-repeat="track in headerplaylist.tracks" >\n                            <div class="col-xs-7 name">\n                                {{ track.name }}    \n                            </div>\n                            <div class="col-xs-5 artist">\n                                {{ track.artiststring }}\n                            </div>\n                        </div>\n                    </div>\n                </div>\n                <div class="hoverwrap">\n                    <div class="iconwrap row">\n                        <div class="icon small col-sm-4">\n                            <a href="#/music/tracklist/{{ headerplaylist.uri }}"><i class="ss-icon ss-list"></i></a>\n                        </div>\n                        <div class="icon col-sm-4">\n                            <i class="ss-icon ss-play" ng-click="playHeaderPlaylist()"></i>\n                        </div>\n                        <div class="icon small col-sm-4">\n                            <i class="ss-icon ss-wifi" ng-click="startHeaderPlaylistStation()"></i>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n    </div>\n</div>\n\n<div id="overview" class="row">\n    <div class="pagetitle row">\n        <div class="col-md-3">\n            Discover <span class="sub">Featured</span>\n        </div>\n        <div class="col-md-6 col-md-offset-3 alignright">\n        </div>\n    </div>\n\n    <div class="pagecontent row">\n        <div id="tileview">\n            <div class="row">\n                <div ng-repeat="playlist in featuredplaylists"> \n                    <mopify-playlist playlist="playlist" class="col-lg-2 col-md-3 col-sm-4 col-xs-6  single-tile"></mopify-playlist>\n                    <div ng-if="($index + 1) % 6 == 0" class="clearfix visible-lg-block"></div>\n                    <div ng-if="($index + 1) % 4 == 0" class="clearfix visible-md-block"></div>\n                    <div ng-if="($index + 1) % 3 == 0" class="clearfix visible-sm-block"></div>\n                    <div ng-if="($index + 1) % 2 == 0" class="clearfix visible-xs-block"></div>\n                </div>\n            </div>\n        </div>\n    </div>\n</div>')}]),angular.module("discover/menu.tmpl.html",[]).run(["$templateCache",function(a){a.put("discover/menu.tmpl.html",'<div class="block row" id="discover">\n    <div class="title">Discover</div>\n    <div class="content">\n        <ul>\n            <li><a href="#/discover/browse">Browse</a></li>\n            <li><a href="#/discover/featured">Featured playlists</a></li>\n            <li><a href="#/discover/newreleases">New releases</a></li>\n        </ul>   \n    </div>\n</div>')}]),angular.module("discover/newreleases/newreleases.tmpl.html",[]).run(["$templateCache",function(a){
a.put("discover/newreleases/newreleases.tmpl.html",'<div id="header" class="big row" style="background-image: url(\'https://d2c87l0yth4zbw.global.ssl.fastly.net/i/home/lifestyle-hero-lg.jpg\');">\n    <div id="featured">\n        <div class="row">\n            <div class="col-md-8 col-md-offset-2">\n                <div class="title">\n                    {{ titletext }}\n                </div>\n            </div>\n        </div>\n        <div class="row" ng-show="headeralbum.tracks != null">\n            <div class="playlist col-lg-4 col-md-8 col-sm-10 col-lg-offset-4 col-md-offset-2 col-sm-offset-1">\n                <div class="cover">\n                    <img ng-src="{{ headeralbum.images[0].url }}" />\n                </div>\n                <div class="details">\n                    <div class="tracklist">\n                        <div class="row track" ng-repeat="track in headeralbum.tracks" >\n                            <div class="col-xs-7 name">\n                                {{ track.name }}    \n                            </div>\n                            <div class="col-xs-5 artist">\n                                {{ track.artiststring }}\n                            </div>\n                        </div>\n                    </div>\n                </div>\n                <div class="hoverwrap">\n                    <div class="iconwrap row">\n                        <div class="icon small col-sm-4">\n                            <a href="#/music/tracklist/{{ headeralbum.uri }}"><i class="ss-icon ss-list"></i></a>\n                        </div>\n                        <div class="icon col-sm-4">\n                            <i class="ss-icon ss-play" ng-click="playHeaderAlbum()"></i>\n                        </div>\n                        <div class="icon small col-sm-4">\n                            <i class="ss-icon ss-wifi" ng-click="startHeaderAlbumStation()"></i>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n    </div>\n</div>\n\n<div id="overview" class="row">\n    <div class="pagetitle row">\n        <div class="col-md-3">\n            Discover <span class="sub">New releases</span>\n        </div>\n        <div class="col-md-6 col-md-offset-3 alignright">\n        </div>\n    </div>\n\n    <div class="pagecontent row">\n        <div id="tileview">\n            <div class="row">\n                <div ng-repeat="album in newreleases"> \n                    <mopify-album album="album" class="col-lg-2 col-md-3 col-sm-4 col-xs-6  single-tile"></mopify-album>\n                    <div ng-if="($index + 1) % 6 == 0" class="clearfix visible-lg-block"></div>\n                    <div ng-if="($index + 1) % 4 == 0" class="clearfix visible-md-block"></div>\n                    <div ng-if="($index + 1) % 3 == 0" class="clearfix visible-sm-block"></div>\n                    <div ng-if="($index + 1) % 2 == 0" class="clearfix visible-xs-block"></div>\n                </div>\n            </div>\n        </div>\n    </div>\n</div>')}]),angular.module("modals/playlistselect.tmpl.html",[]).run(["$templateCache",function(a){a.put("modals/playlistselect.tmpl.html",'<div class="modal-header">\n    <h4 class="modal-title ng-binding">Select playlist</h4>\n</div>\n\n<div class="selectplaylist row">\n    <div class="col-sm-6">\n        <ul class="playlists" role="menu">\n            <li ng-repeat="playlist in userplaylists" ng-if="$index % 2 == 0" ng-click="addToPlaylist(playlist.uri)">\n                {{ playlist.name }}\n            </li>\n        </ul>\n    </div>\n    <div class="col-sm-6">\n        <ul class="dropdown-menu" role="menu">\n            <li ng-repeat="playlist in userplaylists" ng-if="$index % 2 == 1" ng-click="addToPlaylist(playlist.uri)">\n                {{ playlist.name }}\n            </li>\n        </ul>\n    </div>\n</div>\n\n<div class="modal-footer">\n    <button class="btn btn-warning" ng-click="cancel()">Cancel</button>\n</div>')}]),angular.module("music/artist/artist.tmpl.html",[]).run(["$templateCache",function(a){a.put("music/artist/artist.tmpl.html",'<div id="header" class="small row">\n    <div class="backgroundimage" style="background-image: url(\'{{ artist.images[1].url }}\');"></div>\n    <div class="col-md-6 col-lg-4">\n        <div class="albumart hidden-xs hidden-sm hidden-md">\n            <img ng-src="{{ artist.images[0].url }}" />\n        </div>\n        <div class="lefttext">\n            <div class="inner"> \n                <i class="ss-icon ss-list"></i> {{ artist.name }}\n            </div>\n        </div>\n    </div>\n    <div class="col-md-6 col-lg-4 col-sm-9 centertext">\n        <div class="row">\n            <div class="col-xs-4 music"><a href="#/music/artist/{{ artistId }}" ng-class="{ \'active\': currentview.id == \'music\' }" ng-click="setView(\'music\')">Music</a></div>\n            <div class="col-xs-4 biography"><a href="#/music/artist/{{ artistId }}" ng-class="{ \'active\': currentview.id == \'bio\' }" ng-click="setView(\'bio\')">Biography</a></div>\n            <div class="col-xs-4 related"><a href="#/music/artist/{{ artistId }}" ng-class="{ \'active\': currentview.id == \'related\' }" ng-click="setView(\'related\')">Related Artists</a></div>\n        </div>  \n    </div>\n</div>\n\n<div id="overview" class="row">\n    <div class="pagetitle row" ng-if="currentview.id == \'music\'">\n        <div class="col-md-3">\n            {{ artist.name }} <span class="sub">Top tracks</span>\n        </div>\n        <div class="col-md-6 col-md-offset-3 alignright" >\n            <div class="button white" ng-click="startStation()">\n                <span class="text">Start station</span>\n                <i class="ss-icon ss-wifi"></i> \n            </div>\n            <div class="button white" ng-click="toggleFollowArtist()">\n                <span class="text">{{ (followingArtist) ? \'Unfollow\' : \'follow\' }} artist</span>\n                <i class="ss-icon ss-check" ng-show="!followingArtist"></i> \n                <i class="ss-icon ss-delete" ng-show="followingArtist"></i> \n            </div>\n        </div>\n    </div>\n\n    <div class="pagecontent row" ng-if="currentview.id == \'music\'">\n        <div id="tracklist">\n            <div class="row" ng-repeat="track in toptracks" >\n                <mopify-track track="track" surrounding="toptracks" currentplayingtrack="currentPlayingTrack" type="type"> </mopify-track>\n            </div>\n        </div>\n    </div>\n\n    <div class="pagetitle row">\n        <div class="col-md-3">\n            {{ artist.name }} <span class="sub">{{ currentview.name }}</span>\n        </div>\n        <div class="col-lg-2 col-md-3 col-sm-4 col-xs-6 alignright" ng-if="currentview.id != \'music\'">\n            <div class="button white" ng-click="startStation()">\n                <span class="text">Start station</span>\n                <i class="ss-icon ss-wifi"></i> \n            </div>\n        </div>\n    </div>\n    <div class="pagecontent row">\n        <div id="tileview" ng-if="currentview.id == \'music\'">\n            <div ng-repeat="album in albums"> \n                <mopify-album album="album" class="single-tile col-lg-2 col-md-3 col-sm-4 col-xs-6"></mopify-album>\n                <div ng-if="($index + 1) % 6 == 0" class="clearfix visible-lg-block"></div>\n                <div ng-if="($index + 1) % 4 == 0" class="clearfix visible-md-block"></div>\n                <div ng-if="($index + 1) % 3 == 0" class="clearfix visible-sm-block"></div>\n            </div>\n        </div>\n\n        <div class="textcontent" ng-if="currentview.id == \'bio\'">\n            {{ artist.bio.text }}\n        </div>\n\n        <div id="tileview" ng-if="currentview.id == \'related\'">\n            <div ng-repeat="relatedartist in related"> \n                <mopify-artist artist="relatedartist" class="single-tile col-lg-2 col-md-3 col-sm-4 col-xs-6"></mopify-artist>\n                <div ng-if="($index + 1) % 6 == 0" class="clearfix visible-lg-block"></div>\n                <div ng-if="($index + 1) % 4 == 0" class="clearfix visible-md-block"></div>\n                <div ng-if="($index + 1) % 3 == 0" class="clearfix visible-sm-block"></div>\n            </div>\n        </div>\n    </div>\n</div>')}]),angular.module("music/library/albums/albums.tmpl.html",[]).run(["$templateCache",function(a){a.put("music/library/albums/albums.tmpl.html",'<div id="header" class="small row">\n    <div class="backgroundimage" style="background-image: url(\'./assets/images/playlists-header.jpg\');"></div>\n    <div class="col-md-12">\n        <div class="albumart hidden-xs hidden-sm">\n            <img src="./assets/images/playlists-header.jpg" />\n        </div>\n        <div class="lefttext">\n            <div class="inner"> \n                <i class="ss-icon ss-list"></i> Your music: Albums\n            </div>\n        </div>\n    </div>\n</div>\n\n<div id="overview" class="row">\n    <div class="pagetitle row">\n        <div class="col-md-3">\n            Your Music <span class="sub">Albums</span>\n        </div>\n    </div>\n\n    <div class="pagecontent row">\n        <div id="tileview">\n            <div class="row">\n                <div ng-repeat="album in albums"> \n                    <mopify-album album="album" class="col-lg-2 col-md-3 col-sm-4 col-xs-6 single-tile"></mopify-album>\n                    <div ng-if="($index + 1) % 6 == 0" class="clearfix visible-lg-block"></div>\n                    <div ng-if="($index + 1) % 4 == 0" class="clearfix visible-md-block"></div>\n                    <div ng-if="($index + 1) % 3 == 0" class="clearfix visible-sm-block"></div>\n                    <div ng-if="($index + 1) % 2 == 0" class="clearfix visible-xs-block"></div>\n                </div>\n            </div>\n        </div>\n    </div>\n</div>')}]),angular.module("music/library/artists/artists.tmpl.html",[]).run(["$templateCache",function(a){a.put("music/library/artists/artists.tmpl.html",'<div id="header" class="small row">\n    <div class="backgroundimage" style="background-image: url(\'./assets/images/playlists-header.jpg\');"></div>\n    <div class="col-md-12">\n        <div class="albumart hidden-xs hidden-sm">\n            <img src="./assets/images/playlists-header.jpg" />\n        </div>\n        <div class="lefttext">\n            <div class="inner"> \n                <i class="ss-icon ss-list"></i> Your music: Artists\n            </div>\n        </div>\n    </div>\n</div>\n\n<div id="overview" class="row">\n    <div class="pagetitle row">\n        <div class="col-md-3">\n            Your Music <span class="sub">Artists</span>\n        </div>\n    </div>\n\n    <div class="pagecontent row">\n        <div id="tileview">\n            <div class="row">\n                <div ng-repeat="artist in artists"> \n                    <mopify-artist artist="artist" class="col-lg-2 col-md-3 col-sm-4 col-xs-6 single-tile"></mopify-artist>\n                    <div ng-if="($index + 1) % 6 == 0" class="clearfix visible-lg-block"></div>\n                    <div ng-if="($index + 1) % 4 == 0" class="clearfix visible-md-block"></div>\n                    <div ng-if="($index + 1) % 3 == 0" class="clearfix visible-sm-block"></div>\n                    <div ng-if="($index + 1) % 2 == 0" class="clearfix visible-xs-block"></div>\n                </div>\n            </div>\n        </div>\n    </div>\n</div>')}]),angular.module("music/library/playlists/playlists.tmpl.html",[]).run(["$templateCache",function(a){a.put("music/library/playlists/playlists.tmpl.html",'<div id="header" class="small row">\n    <div class="backgroundimage" style="background-image: url(\'./assets/images/playlists-header.jpg\');"></div>\n    <div class="col-md-12">\n        <div class="albumart hidden-xs hidden-sm">\n            <img src="./assets/images/playlists-header.jpg" />\n        </div>\n        <div class="lefttext">\n            <div class="inner">\n                <i class="ss-icon ss-list"></i> Your music: Playlists\n            </div>\n        </div>\n    </div>\n</div>\n\n<div id="overview" class="row">\n    <div class="pagetitle row">\n        <div class="col-md-3">\n            Your Music <span class="sub">Playlists <span ng-if="foldername">></span> {{ foldername }}</span>\n        </div>\n        <div class="col-md-6 col-md-offset-3 alignright">\n            <div class="button white" ng-click="createPlaylist()" ng-show="spotifyplaylists">\n                <span class="text">Create new playlist</span>\n                <i class="ss-icon ss-plus"></i>\n            </div>\n        </div>\n    </div>\n\n    <div class="pagecontent row">\n        <div id="tileview">\n            <div class="row">\n                <div ng-repeat="playlist in playlists">\n                    <mopify-playlist playlist="::playlist" class="col-lg-2 col-md-3 col-sm-4 col-xs-6 single-tile"></mopify-playlist>\n                    <div ng-if="($index + 1) % 6 == 0" class="clearfix visible-lg-block"></div>\n                    <div ng-if="($index + 1) % 4 == 0" class="clearfix visible-md-block"></div>\n                    <div ng-if="($index + 1) % 3 == 0" class="clearfix visible-sm-block"></div>\n                    <div ng-if="($index + 1) % 2 == 0" class="clearfix visible-xs-block"></div>\n                </div>\n            </div>\n        </div>\n    </div>\n</div>')}]),angular.module("music/menu.tmpl.html",[]).run(["$templateCache",function(a){a.put("music/menu.tmpl.html",'<div class="block row" id="yourmusic" ng-controller="PlaylistsMenuController">\n    <div class="title">Your music</div>\n    <div class="content">\n        <ul>\n            <li>\n                <a href="#/music/playlists">Playlists</a>\n                <ul class="submenu playlists" ng-if="numberoffolders > 0" ng-class="{ small: hide }" ng-mouseenter="showPlaylists()" ng-mouseleave="hidePlaylists()">\n                    <li ng-repeat="(key, value) in playlists"><a href="#/music/playlists/{{ key }}">{{ key }}</a></li>\n                    <div class="shadow"></div>\n                </ul>\n            </li>\n            <li><a href="#/music/tracklist/spotify:library:songs">Songs</a></li>\n            <li><a href="#/music/albums">Albums</a></li>\n            <li><a href="#/music/artists">Artists</a></li>\n        </ul>\n    </div>\n</div>\n\n<div class="block row" id="stations">\n    <div class="title">Stations</div>\n    <div class="content">\n        <ul>\n            <li><a href="#/music/stations">Stations</a></li>      \n        </ul>\n    </div>\n</div>')}]),angular.module("music/stations/stations.tmpl.html",[]).run(["$templateCache",function(a){a.put("music/stations/stations.tmpl.html",'<div id="header" class="row stationheader" ng-class="headerSize" style="background-image: url(\'./assets/images/stations-header.jpg\');">\n    <div class="col-md-4 lefttext" ng-hide="creatingRadio">\n        <div class="inner"><i class="ss-icon ss-wifi"></i>  Stations</div>\n    </div>\n    <div ng-show="creatingRadio" id="radiosearch" ng-class="wrapclass">\n        <div class="col-md-8 col-md-offset-2">\n            <div class="title">\n                Sit back, relax and enjoy\n            </div>\n            <div class="inputwrap">\n                <input type="text" ng-model="searchQuery" ng-keyup="search($event)" placeholder="Search for an artist, album or song"/>\n            </div>\n            <div class="resultswrap">\n                <ul>\n                    <li class="divider">Albums</li>\n                    <li class="result" ng-repeat="result in searchResults.albums.items" ng-click="startFromNew(\'album\', result)">\n                        <div class="thumb">\n                            <img ng-src="{{ result.images[0].url }}" />\n                        </div>\n                        <div class="text">\n                            {{ result.name }}\n                        </div>\n                    </li>\n                    <li class="divider">Artists</li>\n                    <li class="result" ng-repeat="result in searchResults.artists.items" ng-click="startFromNew(\'artist\', result)">\n                        <div class="thumb">\n                            <img ng-src="{{ result.images[0].url }}" />\n                        </div>\n                        <div class="text">\n                            {{ result.name }}\n                        </div>\n                    </li>\n                    <li class="divider">Tracks</li>\n                    <li class="result" ng-repeat="result in searchResults.tracks.items" ng-click="startFromNew(\'track\', result)">\n                        <div class="thumb">\n                            <img ng-src="{{ result.album.images[0].url }}" />\n                        </div>\n                        <div class="text">\n                            {{ result.name }} - {{ buildArtistString(result.artists) }}\n                        </div>\n                    </li>\n                    <li class="divider">Playlists</li>\n                    <li class="result" ng-if="spotifyConnected" ng-repeat="result in searchResults.playlists.items" ng-click="startFromNew(\'track\', result)">\n                        <div class="text">\n                            {{ result.name }} - {{ result.owner.id }}\n                        </div>\n                    </li>\n                    <li class="result" ng-if="!spotifyConnected">\n                        <div class="text">\n                            If you want to search through Spotify playlists you first have to connect with Spotify\n                        </div>\n                    </li>\n                </ul>\n            </div>\n        </div>\n    </div>\n</div>\n<div id="overview" class="row">\n    <div class="pagetitle row">\n        <div class="col-md-3">\n            Stations <span class="sub">Recently played</span>\n        </div>\n        <div class="col-md-3 col-md-offset-6 alignright">\n            <div class="button white" ng-click="create()">\n                <span class="text">Create new</span>\n                <i class="ss-icon ss-wifi"></i> \n            </div>\n        </div>\n    </div>\n    <div class="pagecontent row">\n        <div id="tileview">\n            <div class="row">\n                <div ng-repeat="station in stations | reverse">\n                    <mopify-station station="station" index="$index"></mopify-station>\n                    <div ng-if="($index + 1) % 6 == 0" class="clearfix visible-lg-block"></div>\n                    <div ng-if="($index + 1) % 4 == 0" class="clearfix visible-md-block"></div>\n                    <div ng-if="($index + 1) % 3 == 0" class="clearfix visible-sm-block"></div>\n                </div>\n            </div>\n        </div>\n    </div>\n</div>')}]),angular.module("music/tracklist/tracklist.tmpl.html",[]).run(["$templateCache",function(a){a.put("music/tracklist/tracklist.tmpl.html",'<div id="header" class="small row">\n    <div class="backgroundimage" style="background-image: url(\'{{ coverImage }}\');"></div>\n    <div class="col-md-12">\n        <div class="albumart hidden-xs hidden-sm">\n            <img ng-src="{{ coverImage }}" />\n        </div>\n        <div class="lefttext">\n            <div class="inner">\n                <i class="ss-icon ss-list"></i>  {{ name }}\n            </div>\n        </div>\n    </div>\n</div>\n\n<div id="overview" class="row">\n    <div class="pagetitle row">\n        <div class="col-md-3" ng-hide="type == \'tracklist\'">\n            tracks <span class="sub">{{ type }}</span>\n        </div>\n        <div class="col-md-3" ng-show="type == \'tracklist\'">\n            tracks <span class="sub">Now playing</span>\n        </div>\n        <div class="col-md-6 col-md-offset-3 alignright">\n            <div class="button white" ng-click="toggleSaveAlbum()" ng-show="type == \'Album\'">\n                <span class="text">{{ (albumAlreadySaved) ? \'Remove\' : \'Save\' }} album</span>\n                <i class="ss-icon ss-check" ng-show="!albumAlreadySaved"></i>\n                <i class="ss-icon ss-delete" ng-show="albumAlreadySaved"></i>\n            </div>\n            <div class="button white" ng-click="toggleFollowPlaylist()" ng-show="type == \'Playlist\' &&!isowner">\n                <span class="text">{{ (followingPlaylist) ? \'Unfollow\' : \'Follow\' }} playlist</span>\n                <i class="ss-icon ss-check" ng-show="!followingPlaylist"></i>\n                <i class="ss-icon ss-delete" ng-show="followingPlaylist"></i>\n            </div>\n            <div class="button white" ng-click="startStation()">\n                <span class="text">Start station</span>\n                <i class="ss-icon ss-wifi"></i>\n            </div>\n            <div class="button white" ng-click="shuffle()" ng-if="type != \'tracklist\'">\n                <span class="text">Shuffle {{ type }}</span>\n                <i class="ss-icon ss-shuffle"></i>\n            </div>\n        </div>\n    </div>\n\n    <div class="pagecontent row loading" ng-if="loading">\n        <svg version="1.1" class="svg-loader" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 80 80" xml:space="preserve">\n            <path id="spinner" fill="#444444" d="M40,72C22.4,72,8,57.6,8,40C8,22.4,\n                22.4,8,40,8c17.6,0,32,14.4,32,32c0,1.1-0.9,2-2,2\n                s-2-0.9-2-2c0-15.4-12.6-28-28-28S12,24.6,12,40s12.6,\n                28,28,28c1.1,0,2,0.9,2,2S41.1,72,40,72z" transform="rotate(42.6866 40 40)">\n                <animateTransform attributeType="xml" attributeName="transform" type="rotate" from="0 40 40" to="360 40 40" dur="0.75s" repeatCount="indefinite"></animateTransform>\n            </path>\n        </svg>\n    </div>\n\n    <div class="row note" ng-if="type == \'My Music - Songs\'">\n        <div class="col-md-10">\n            <p><b>Note:</b> loading the Library songs tracks into Mopidy <a href="https://github.com/dirkgroenen/mopidy-mopify/issues/62" target="_blank">can be slow</a> since Mopidy has no official support for directly playing this list. Use CTRL to select multiple tracks and add them through the context menu to prevent Mopidy from hanging.</p>\n        </div>\n    </div>\n\n    <div class="pagecontent row" style="padding-bottom: 30px;" ng-if="type == \'tracklist\'">\n        <div id="tracklist">\n            <div class="row">\n                <mopify-track track="currentPlayingTrack" currentplayingtrack="currentPlayingTrack" type="type"></mopify-track>\n            </div>\n        </div>\n    </div>\n\n    <div class="pagetitle row" ng-show="type == \'tracklist\' && queue.length > 0">\n        <div class="col-md-3">\n            tracks <span class="sub">Queue</span>\n        </div>\n    </div>\n\n    <div class="pagecontent row" style="padding-bottom: 30px;" ng-if="type == \'tracklist\' && queue.length > 0">\n        <div id="tracklist">\n            <div class="row" ng-repeat="track in queue track by $index">\n                <mopify-track track="track" surrounding="queue" type="type"> </mopify-track>\n            </div>\n        </div>\n    </div>\n\n    <div class="pagetitle row" ng-show="type == \'tracklist\'">\n        <div class="col-md-3">\n            tracks <span class="sub">Playlist</span>\n        </div>\n    </div>\n\n    <div class="pagecontent row">\n        <div id="tracklist" infinite-scroll="getMoreTracks()" infinite-scroll-distance="1">\n            <div class="row" ng-repeat="track in tracks track by $index">\n                <mopify-track track="track" currentplayingtrack="currentPlayingTrack" surrounding="loadedTracks" type="type"></mopify-track>\n            </div>\n        </div>\n    </div>\n</div>')}]),angular.module("player/controls/controls.left.tmpl.html",[]).run(["$templateCache",function(a){a.put("player/controls/controls.left.tmpl.html",'<div class="row">\n    <div class="iconwrap">\n        <div class="col-xs-3">\n            <a href="#/music/tracklist/mopidy:current"><i class="ss-icon ss-list"></i></a>\n        </div>\n        <div class="col-xs-3">\n            <i class="ss-icon ss-navigateleft" ng-click="prev();"></i>\n        </div>\n        <div class="col-xs-3">\n            <i class="ss-icon {{ stateIcon }}" ng-click="playpause();"></i>\n        </div>\n        <div class="col-xs-3">\n            <i class="ss-icon ss-navigateright" ng-click="next();"></i>\n        </div>\n    </div>\n</div>')}]),angular.module("player/controls/controls.right.tmpl.html",[]).run(["$templateCache",function(a){a.put("player/controls/controls.right.tmpl.html",'<div class="row">\n    <div class="iconwrap">\n        <div class="col-sm-2 col-xs-4">\n            <i class="ss-icon ss-shuffle" ng-class="{ \'active\': isRandom }" ng-click="toggleShuffle();"></i>\n        </div>\n        <div class="col-sm-2 col-xs-4">\n            <i class="ss-icon ss-repeat" ng-class="{ \'active\': isRepeat }" ng-click="toggleRepeat();"></i>\n        </div>\n        <div class="col-sm-8 col-xs-4">\n            <i class="ss-icon {{ volumeIcon }}" ng-click="openVolumeOverlay()"></i>\n            <div class="volumebar hidden-xs" ng-click="volumebarMouseClick($event)" ng-mousedown="volumebarMouseDown($event)" ng-mouseup="volumebarMouseUp($event)" ng-mousemove="volumebarMouseMove($event)">\n                <div class="outer">\n                    <div class="inner" style="width: {{ volume }}%;"></div>\n                </div>\n            </div>\n        </div>\n    </div>\n</div>\n\n<div class="volumeoverlay" ng-show="volumeopened">\n    <div class="close" ng-click="closeVolumeOverlay()"><i class="ss-icon ss-delete"></i></div>\n    <div class="text">Click on the bar below to change the volume.</div>\n    <div class="volumebar" ng-click="volumebarMouseClick($event, true)" ng-mousedown="volumebarMouseDown($event, true)">\n        <div class="outer">\n            <div class="inner" style="width: {{ volume }}%;"></div>\n        </div>\n    </div>\n</div>')}]),angular.module("player/player.tmpl.html",[]).run(["$templateCache",function(a){a.put("player/player.tmpl.html",'<div class="bgimage">\n    <img ng-src="{{ playerBackground }}">\n</div>\n\n<div class="row" ng-controller="PlayerControlsController">\n    <div class="controlwrap column left"  ng-if="!mobiledisplay">\n        <ng-include src="\'player/controls/controls.left.tmpl.html\'"></ng-include>\n    </div>\n    <div class="seekwrap column" id="seekbar">\n        <a class="trackname" href="#/music/tracklist/{{ albumUri }}/{{ albumName }}" ng-hide="showLoading">\n            <span class="title">{{ trackTitle }}</span> <span class="delimiter">-</span> <span class="artist">{{ trackArtist }}</span>\n        </a>\n        <a href="#" class="trackname" ng-show="showLoading">\n            <span class="title">Loading tracks</span> <span class="delimiter">-</span> <span class="artist">Please wait...</span>\n        </a>\n        <div ng-controller="PlayerSeekbarController">\n            <ng-include src="\'player/seekbar/seekbar.tmpl.html\'"></ng-include>\n        </div>\n    </div>\n    <div class="controlwrap column left" ng-if="mobiledisplay">\n        <ng-include src="\'player/controls/controls.left.tmpl.html\'"></ng-include>\n    </div>\n    <div class="controlwrap column right">\n        <ng-include src="\'player/controls/controls.right.tmpl.html\'"></ng-include>\n    </div>\n    <div class="clearfix"></div>\n</div>')}]),angular.module("player/seekbar/seekbar.tmpl.html",[]).run(["$templateCache",function(a){a.put("player/seekbar/seekbar.tmpl.html",'<div class="barwrap">\n    <div class="time" id="passed">{{ timeCurrent }}</div>\n    <div class="bar" ng-mouseup="seekbarMouseUp()" ng-mousedown="seekbarMouseDown($event)" ng-mousemove="seekbarMouseMove($event)" ng-click="seekbarMouseClick($event)" >\n        <div class="outer">\n            <div class="inner" style="width: {{ seekbarWidth }}%;"></div>\n        </div>\n    </div>\n    <div class="time" id="total">{{ timeTotal }}</div>\n</div>')}]),angular.module("search/menu.tmpl.html",[]).run(["$templateCache",function(a){a.put("search/menu.tmpl.html",'<div class="block row" ng-controller="SearchMenuController">\n    <div class="content" id="search">\n        <i class="ss-icon ss-search"></i>\n        <span class="inputwrap" ng-class="{ \'focus\': focused }"><input type="text" name="query" ng-model="query" ng-focus="focused = true;" ng-blur="focused = false" placeholder="Search" ng-keyup="typing($event)" focus-me="$root.focussearch"/></span>\n    </div>\n</div>')}]),angular.module("search/search.tmpl.html",[]).run(["$templateCache",function(a){
a.put("search/search.tmpl.html",'<div class="search-overlay" id="overview" >\n    <div class="close" ng-click="closeSearch();"><i class="ss-icon ss-delete"></i></div>\n    <div class="inner">\n        <div class="inputwrap">\n            <span class="instructions">Start typing to search</span>\n            <input type="text" class="fluent" ng-model="query" novalidate focus-me="$root.focussearch" ng-keyup="typing($event)"/>\n        </div>\n\n        <div class="resultwrap pagecontent loading" ng-show="loading">\n            <svg version="1.1" class="svg-loader" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 80 80" xml:space="preserve">\n                <path id="spinner" fill="#444444" d="M40,72C22.4,72,8,57.6,8,40C8,22.4,\n                    22.4,8,40,8c17.6,0,32,14.4,32,32c0,1.1-0.9,2-2,2\n                    s-2-0.9-2-2c0-15.4-12.6-28-28-28S12,24.6,12,40s12.6,\n                    28,28,28c1.1,0,2,0.9,2,2S41.1,72,40,72z" transform="rotate(42.6866 40 40)">\n                    <animateTransform attributeType="xml" attributeName="transform" type="rotate" from="0 40 40" to="360 40 40" dur="0.75s" repeatCount="indefinite"></animateTransform>\n                </path>\n            </svg>\n        </div>\n\n        <div class="resultwrap pagecontent" ng-hide="loading">\n            <div class="row">\n                <div class="col-lg-2 col-sm-6 column hidden-md hidden-sm">\n                    <div class="title">\n                        <h2>Best match: {{ topresult.item.name }}</h2>\n                    </div>\n                    <div id="featured">\n                        <div id="searchview" class="topresult">\n                            <div class="cover">\n                                <a href="{{ topresult.link }}"><img ng-src="{{ topresult.item.images[0].url }}" /></a>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n                <div class="col-lg-2 col-md-3 col-sm-4 column ">\n                    <div class="title">\n                        <h2>Artists</h2>\n                        <div ng-click="searchLimitsToggle(\'artists\')">\n                            <span class="more" ng-show="searchLimits.artists != 50">More</span>\n                            <span class="more" ng-show="searchLimits.artists == 50">Less</span>\n                        </div>\n                    </div>\n                    <div id="searchview">\n                        <div class="noresults" ng-show="results.artists.items.length == 0">No results</div>\n                        <mopify-artist artist="artist" class="single-tile" ng-repeat="artist in results.artists.items | limitTo:searchLimits.artists"></mopify-artist>\n                    </div>\n                </div>\n                <div class="col-lg-2 col-md-3 col-sm-4 column">\n                    <div class="title">\n                        <h2>Albums</h2>\n                        <div ng-click="searchLimitsToggle(\'albums\')">\n                            <span class="more" ng-show="searchLimits.albums != 50">More</span>\n                            <span class="more" ng-show="searchLimits.albums == 50">Less</span>\n                        </div>\n                    </div>\n                    <div id="searchview">\n                        <div class="noresults" ng-show="results.albums.items.length == 0">No results</div>\n                        <mopify-album album="album" class="single-tile" ng-repeat="album in results.albums.items | limitTo:searchLimits.albums"></mopify-album>\n                    </div>\n                </div>\n                <div class="col-lg-2 col-md-3 col-sm-4 column">\n                    <div class="title">\n                        <h2>Playlists</h2>\n                        <div ng-click="searchLimitsToggle(\'playlists\')">\n                            <span class="more" ng-show="searchLimits.playlists != 50">More</span>\n                            <span class="more" ng-show="searchLimits.playlists == 50">Less</span>\n                        </div>\n                    </div>\n                    <div id="searchview">\n                        <div class="noresults" ng-show="results.playlists.items.length == 0">No results</div>\n                        <mopify-playlist playlist="playlist" play="play(playlist)" class="single-tile col-sm-4" ng-repeat="playlist in results.playlists.items | limitTo:searchLimits.playlists"></mopify-playlist>\n                    </div>\n                </div>\n                <div class="col-lg-4 col-md-3 col-sm-12 column">\n                    <div class="title">\n                        <h2>Tracks</h2>\n                        <div ng-click="searchLimitsToggle(\'tracks\')">\n                            <span class="more" ng-show="searchLimits.tracks != 50">More</span>\n                            <span class="more" ng-show="searchLimits.tracks == 50">Less</span>\n                        </div>\n                    </div>\n                    <div id="searchview">\n                        <div id="tracklist" class="row">\n                            <div class="noresults" ng-show="results.tracks.length == 0">No results</div>\n                            <mopify-track track="track" surrounding="results.tracks" <div ng-repeat="track in results.tracks | limitTo:searchLimits.tracks">> </mopify-track>\n                        </div>\n                    </div>\n                </div>\n\n            </div>\n        </div>\n    </div>\n</div>')}]),angular.module("mopify.account.services.facebook",["mopify.services.facebook"]).controller("FacebookMenuController",["$q","$scope","Facebook",function(a,b,c){function d(){b.authorized=!0,c.api("/me",{}).then(function(a){b.userProfile=a,c.api("/me/picture",{}).then(function(a){b.userProfile.profile_image=a.data.url})})}b.userProfile={},b.authorized=!1,c.getLoginStatus().then(function(a){"connected"==a.status?d():c.login().then(function(){d()})})}]),angular.module("mopify.account.services",["mopify.widgets.directive.service","mopify.services.servicemanager"]).config(["$routeProvider",function(a){a.when("/account/services",{templateUrl:"account/services/services.tmpl.html",controller:"AccountServicesController"})}]).controller("AccountServicesController",["$rootScope","$scope","ServiceManager",function(a,b,c){b.availableServices=c.getAvailableServices(),b.connectedServices=c.getEnabledServices()}]),angular.module("mopify.account.services.menu",["mopify.services.servicemanager"]).controller("AccountServicesMenuController",["$scope","ServiceManager",function(a,b){function c(c,d){a.connectedServices=b.getEnabledServices();var e=_.filter(a.connectedServices,function(a){return a});a.totalServices=b.getAvailableServices().length,a.connectedCount=e.length,0===a.connectedCount?a.hasServicesConnected=!1:a.hasServicesConnected=!0}c(),a.$on("mopify:services:enabled",c),a.$on("mopify:services:disabled",c)}]),angular.module("mopify.account.services.spotify",["spotify","mopify.services.servicemanager","mopify.services.spotifylogin","mopify.services.settings","toggle-switch"]).config(["$routeProvider",function(a){a.when("/account/services/spotify",{templateUrl:"account/services/spotify/spotify.tmpl.html",controller:"SpotifyServiceController"})}]).controller("SpotifyServiceController",["$scope","$location","ServiceManager","Settings","Spotify","SpotifyLogin",function(a,b,c,d,e,f){if(!c.isEnabled("spotify"))return void b.path("/account/services");d.bind(a),e.getCurrentUser().then(function(b){a.profile=b.data}),a.reconnect=function(){f.disconnect(),f.login()}}]).controller("SpotifyMenuController",["$q","$scope","Spotify","SpotifyLogin",function(a,b,c,d){function e(){c.getCurrentUser().then(function(a){b.authorized=!0,b.userProfile=a.data})}b.userProfile={},b.authorized=!1,d.getLoginStatus().then(function(a){"connected"==a.status?e():d.login().then(function(){e()})}),b.$on("mopify:services:disconnected",function(a,b){"Spotify"==b.name&&d.disconnect()}),b.$on("mopify:spotify:connected",function(){e()})}]),angular.module("mopify.account.services.sync",["spotify","mopify.services.servicemanager","mopify.services.sync","mopify.services.spotifylogin","toggle-switch","llNotifier"]).config(["$routeProvider",function(a){a.when("/account/services/sync",{templateUrl:"account/services/sync/sync.tmpl.html",controller:"SyncServiceController"})}]).controller("SyncServiceController",["$scope","$location","$q","ServiceManager","Settings","Sync","SpotifyLogin","notifier",function(a,b,c,d,e,f,g,h){if(!d.isEnabled("sync"))return void b.path("/account/services");e.bind(a),a.client=f.client,a.spotifyclient=null,null!=a.settings.sync&&!0===a.settings.sync.spotify&&f.getSpotify().then(function(b){null!=b&&(a.spotifyclient=b.client)}),a.updateClient=function(){f.updateClient(a.client)},a.getSyncSpotifyTokens=function(){var b=c.defer();return a.settings.sync.spotify_type="get",f.getSpotify().then(function(c){void 0===c||void 0===c.access_token||void 0===c.refresh_token||""===c.access_token||""===c.refresh_token?(h.notify({type:"custom",template:"No synchronized data available. Press PUSH to push your current credentails.",delay:5e3}),b.reject()):(g.access_token=c.access_token,g.refresh_token=c.refresh_token,a.spotifyclient=c.client,g.login(),b.resolve(c))}),b.promise},a.sendCurrentSpotifyTokens=function(){var b=c.defer();return a.settings.sync.spotify_type="post",null!==g.access_token&&null!==g.refresh_token&&g.connected?f.setSpotify({access_token:g.access_token,refresh_token:g.refresh_token}).then(function(c){h.notify({type:"custom",template:"Credentials succesfully pushed.",delay:5e3}),a.spotifyclient=a.client,b.resolve()}):(h.notify({type:"custom",template:"Please login to Spotify first.",delay:5e3}),b.reject()),b.promise},a.spotifyToggle=function(){!0===a.settings.sync.spotify&&!1===d.isEnabled("spotify")&&a.getSyncSpotifyTokens().then(function(){d.enableService("Spotify")})},a.forceToggle=function(){f.setSettings({forcesync:a.settings.sync.force}).then(function(a){h.notify({type:"custom",template:"Settings succesfully saved.",delay:5e3})})}}]).controller("SyncMenuController",["$q","$scope","Sync",function(a,b,c){b.client=c.client}]),angular.module("mopify.account.settings",["ngRoute","LocalStorageModule","mopify.services.settings","mopify.services.autoupdate","mopify.services.versionmanager","llNotifier"]).config(["$routeProvider",function(a){a.when("/account/settings",{templateUrl:"account/settings/settings.tmpl.html",controller:"SettingsController"})}]).controller("SettingsController",["$scope","$rootScope","$timeout","$http","localStorageService","Settings","VersionManager","AutoUpdate","notifier",function(a,b,c,d,e,f,g,h,i){function j(){g.checkVersion().then(function(b){a.newversion=g.newVersion,a.newversionnumber=g.lastversion})}f.bind(a),void 0===a.settings.pagetitle&&(a.settings.pagetitle=!0),a.buttonactive=!1,a.autoupdate=!1,a.highlightSaveButton=function(){a.buttonactive=!0,c(function(){a.buttonactive=!1},500)},j(),h.check().then(function(b){a.autoupdate=!0===b}),a.update=function(){i.notify({type:"custom",template:"Started updating...",delay:3e3}),h.runUpdate().then(function(a){i.notify({type:"custom",template:"Update succesfull. You might need to restart Mopidy before changes are visible. ",delay:3e3}),j()},function(a){i.notify({type:"custom",template:"Update failed. Mopify returned: "+a.response,delay:3e3})})}}]),angular.module("mopify",["LocalStorageModule","angular-loading-bar","mopify.services.mopidy","mopify.services.versionmanager","mopify.services.autoupdate","mopify.services.settings","spotify","mopify.dashboard","mopify.search","mopify.music.artist","mopify.music.playlists","mopify.music.stations","mopify.music.library.albums","mopify.music.library.artists","mopify.player","mopify.player.controls","mopify.player.seekbar","mopify.account.settings","mopify.account.services","mopify.account.services.menu","mopify.account.services.spotify","mopify.account.services.facebook","mopify.account.services.sync","mopify.music.tracklist","ng-context-menu","mopify.discover.browse","mopify.discover.featured","mopify.discover.newreleases","templates-app","llNotifier","ErrorCatcher","cgPrompt"]).config(["$routeProvider","$httpProvider","localStorageServiceProvider","SpotifyProvider","$injector",function(a,b,c,d,e){c.setPrefix("mopify"),d.setClientId("b6b699a5595b406d9bfba11bee303aa4"),d.setRedirectUri("https://bitlabs.nl/mopify/auth/spotify/callback/"),d.setScope("playlist-read-collaborative playlist-read-private playlist-modify-private playlist-modify-public user-library-read user-library-modify user-follow-modify user-follow-read user-top-read"),a.otherwise({redirectTo:"/"}),b.interceptors.push("SpotifyAuthenticationIntercepter")}]).controller("AppController",["$scope","$rootScope","$http","$location","$window","mopidyservice","notifier","VersionManager","localStorageService","AutoUpdate","prompt","Settings",function(a,b,c,d,e,f,g,h,i,j,k,l){function m(b){if(!l.get("pagetitle",!0))return!1;null!=b&&(b.name.indexOf("[loading]")>-1?f.lookup(b.uri).then(function(b){a.pageTitle=b[0].name+" - "+b[0].artists[0].name+" | "+o}):a.pageTitle=b.name+" - "+b.artists[0].name+" | "+o)}var n={online:"Online",offline:"Offline"},o="Mopify";a.showmobilemenu=!1,b.selectedtracks=[],b.$on("$routeChangeStart",function(c,d,e){a.showmobilemenu=!1,b.selectedtracks=[]}),b.mopifyversion=h.version,a.$on("mopidy:event:trackPlaybackStarted",function(a,b){null!=b.tl_track&&m(b.tl_track.track)}),a.connectionState=n.offline,a.pageTitle=o,a.$on("mopidy:state:online",function(){a.connectionState=n.online,a.$apply(),f.getCurrentTrack().then(function(a){m(a)})}),a.$on("mopidy:state:offline",function(){a.connectionState=n.offline,a.pageTitle="No connection",a.$apply()}),f.start(),a.$on("mopify:version:new",function(a,b){!0===j.autoupdate?j.check().then(function(a){a?(g.notify({type:"custom",template:"Updating to version "+b+"...",delay:2500}),j.runUpdate().then(function(){g.notify({type:"custom",template:"Update succesfull. You might need to restart Mopidy before changes are visible. ",delay:3e3})},function(a){g.notify({type:"custom",template:"Update failed. Mopify returned: "+a.response,delay:5e3})})):g.notify({type:"custom",template:"Mopify version "+b+" is available. Use the <a href='https://github.com/dirkgroenen/mopidy-mopify/blob/master/README.md#updating' target='_blank'>README</a> on how to update.",delay:5e3})}):g.notify({type:"custom",template:"Mopify version "+b+" is available. Use the <a href='https://github.com/dirkgroenen/mopidy-mopify/blob/master/README.md#updating' target='_blank'>README</a> on how to update, or use the <a href='/#/account/settings'>auto-update</a> feature.",delay:7500})}),a.$on("mopify:update:succesfull",function(a,b){var c=h.getChangelog();k({title:"New version: "+h.lastversion,message:"<p>Mopify just updated to version "+h.lastversion+'. The following changes have been made:</p><pre style="font-size: 10px;">'+c+"</pre>",input:!1,buttons:[{label:"Ok",primary:!0}]})})}]),angular.module("mopify.dashboard",["ngRoute","mopify.services.settings"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"dashboard/dashboard.tmpl.html",controller:"DashboardController"})}]).controller("DashboardController",["$scope","$location","Settings",function(a,b,c){var d=c.get("startpage","/discover/featured");b.path(d.replace("#",""))}]),angular.module("mopify.widgets.directive.album",["mopify.services.mopidy","mopify.services.station","mopify.services.util","mopify.modal.playlistselect","ui.bootstrap","spotify","mopify.services.spotifylogin","mopify.services.servicemanager","llNotifier","mopify.widgets.directive.stoppropagation"]).directive("mopifyAlbum",["$modal","$location","mopidyservice","stationservice","prompt","util","PlaylistManager","notifier","Spotify","SpotifyLogin","ServiceManager",function(a,b,c,d,e,f,g,h,i,j,k){return{restrict:"E",scope:{album:"="},replace:!0,templateUrl:"directives/album.directive.tmpl.html",link:function(e,l,m){var n=encodeURIComponent(e.album.name.replace(/\//g,"-"));e.tracklistUrl="/music/tracklist/"+e.album.uri+"/"+n,e.showSaveAlbum=!1,e.albumAlreadySaved=!1,e.visible=!0,null!=e.album.artists&&(e.album.artists.length<4?e.artiststring=f.artistsToString(e.album.artists):e.artiststring="Various Artists");var o=[];e.play=function(){c.playTrack(e.album)},e.startStation=function(){d.startFromSpotifyUri(e.album.uri)},e.addToQueue=function(){c.addToTracklist({uri:e.album.uri})},e.showPlaylists=function(){a.open({templateUrl:"modals/playlistselect.tmpl.html",controller:"PlaylistSelectModalController",size:"lg"}).result.then(function(a){var b=a.split(":")[4];g.addAlbum(b,e.album.uri).then(function(){h.notify({type:"custom",template:"Album succesfully added to playlist.",delay:3e3})},function(){h.notify({type:"custom",template:"Can't add album. Are you connected with Spotify and the owner if this playlist?",delay:5e3})})})},e.toggleSaveAlbum=function(){k.isEnabled("spotify")&&j.connected?e.albumAlreadySaved?i.removeUserTracks(o).then(function(a){h.notify({type:"custom",template:"Album succesfully removed.",delay:5e3}),e.visible=!1},function(a){h.notify({type:"custom",template:"Something wen't wrong, please try again.",delay:5e3})}):i.saveUserTracks(o).then(function(a){h.notify({type:"custom",template:"Album succesfully saved.",delay:5e3})},function(a){h.notify({type:"custom",template:"Something wen't wrong, please try again.",delay:5e3})}):h.notify({type:"custom",template:"Can't add album. Are you connected with Spotify?",delay:5e3})},e.onContextShow=function(){k.isEnabled("spotify")&&j.connected?(i.getAlbumTracks(e.album.uri,{limit:50}).then(function(a){var b=a.data;o=_.map(b.items,function(a){return a.id}),i.userTracksContains(o).then(function(a){e.albumAlreadySaved=a.data[0]})}),e.showSaveAlbum=!0):e.showSaveAlbum=!1},e.openAlbumTracklist=function(){b.path(e.tracklistUrl)}}}}]),angular.module("mopify.widgets.directive.artist",["mopify.services.mopidy","mopify.services.station","mopify.services.spotifylogin","mopify.services.servicemanager","llNotifier","spotify","mopify.widgets.directive.stoppropagation"]).directive("mopifyArtist",["$location","mopidyservice","stationservice","notifier","Spotify","SpotifyLogin","ServiceManager",function(a,b,c,d,e,f,g){return{restrict:"E",scope:{artist:"="},templateUrl:"directives/artist.directive.tmpl.html",link:function(h,i,j){h.showFollowArtist=!1,h.followingArtist=!1,h.play=function(){b.playTrack(h.artist)},h.startStation=function(){c.startFromSpotifyUri(h.artist.uri)},void 0===h.artist.images&&e.getArtist(h.artist.uri).then(function(a){angular.extend(h.artist,a.data)}),h.toggleFollowArtist=function(){g.isEnabled("spotify")&&f.connected?h.followingArtist?e.unfollow("artist",h.artist.id).then(function(a){d.notify({type:"custom",template:"Artist succesfully unfollowed.",delay:5e3})},function(a){d.notify({type:"custom",template:"Something wen't wrong, please try again.",delay:5e3})}):e.follow("artist",h.artist.id).then(function(a){d.notify({type:"custom",template:"Artist succesfully followed.",delay:5e3})},function(a){d.notify({type:"custom",template:"Something wen't wrong, please try again.",delay:5e3})}):d.notify({type:"custom",template:"Can't follow/unfollow artist. Are you connected with Spotify?",delay:5e3})},h.onContextShow=function(){g.isEnabled("spotify")&&f.connected?e.userFollowingContains("artist",h.artist.id).then(function(a){h.followingArtist=a[0],h.showFollowArtist=!0}):h.showFollowArtist=!1},h.openArtistPage=function(){a.path("/music/artist/"+h.artist.uri)}}}}]),angular.module("mopify.widgets.directive.browse",["mopify.services.mopidy","mopify.services.station","mopify.services.util","spotify"]).directive("mopifyBrowse",["$sce","mopidyservice","stationservice","util","Spotify",function(a,b,c,d,e){return{restrict:"E",scope:{item:"="},templateUrl:"directives/browse.directive.tmpl.html",link:function(a,f,g){a.spotifyuri=null,"spotify"==a.item.type&&(a.titleslogan=1==Math.floor(2*Math.random())?"Here's something you might like:":"Recommended for you:",a.spotifyuri=a.item.spotify.uri,a.image=a.item.spotify.album.images[0].url,a.spotifyuri=a.item.spotify.album.uri,a.suggestion={name:a.item.spotify.name,artist:d.artistsToString(a.item.spotify.artists)}),"artist"==a.item.type&&(a.titleslogan="You listened to "+a.item.artist.name+". You might like this artist to:",a.spotifyuri=a.item.artist.uri,e.getRelatedArtists(a.spotifyuri).then(function(b){var c=b.data,d=c.artists[Math.floor(Math.random()*c.artists.length)];d.images[1]&&(a.image=d.images[1].url),a.spotifyuri=d.uri,a.suggestion={name:d.name}})),a.play=function(){b.lookup(a.spotifyuri).then(function(c){var d=c[a.spotifyuri],e=d.splice(0,20),f=e[0];"echonest"==a.item.type&&_.each(e,function(b,c){b.name==a.item.echonest.title&&(f=e[c])}),b.playTrack(f,e)})},a.startStation=function(){c.startFromSpotifyUri(a.spotifyuri)}}}}]),angular.module("mopify.widgets.directive.focusme",[]).directive("focusMe",["$timeout","$parse",function(a,b){return{link:function(c,d,e){var f=b(e.focusMe);c.$watch(f,function(b){!0===b&&a(function(){d[0].focus();var a=d[0].value;a.length>0&&(d[0].value="",d[0].value=a)})}),d.bind("blur",function(){c.$apply(f.assign(c,!1))})}}}]);var widgetModule=angular.module("mopify.widgets",["spotify","mopify.services.mopidy"]);angular.module("mopify.widgets.directive.playlist",["mopify.widgets.directive.stoppropagation"]).directive("mopifyPlaylist",["$location","Spotify","mopidyservice","stationservice",function(a,b,c,d){return{restrict:"E",scope:{playlist:"="},templateUrl:"directives/playlist.directive.tmpl.html",link:function(e,f,g){e.coverImage="",null!=e.playlist.images&&e.playlist.images.length>0?e.coverImage=e.playlist.images[0].url:"Playlist"==e.playlist.__model__?b.getTrack(e.playlist.tracks[0].uri).then(function(a){e.coverImage=a.data.album.images[1].url}):void 0===e.playlist.__model__&&b.getPlaylist(e.playlist.owner.id,e.playlist.id).then(function(a){var b=a.data;null!=b.images[0]&&(e.coverImage=b.images[0].url),b.tracks.items.length>0&&null!=b.tracks.items[0].track.album.images[0]&&(e.coverImage=b.tracks.items[0].track.album.images[0].url)}),e.play=function(){c.playTrack(e.playlist)};var h=encodeURIComponent(e.playlist.name.replace(/\//g,"-"));e.tracklistUrl="/music/tracklist/"+e.playlist.uri+"/"+h,e.startStation=function(){d.startFromSpotifyUri(e.playlist.uri)},e.addToQueue=function(){c.addToTracklist({uris:[e.playlist.uri]})},e.openPlaylistTracklist=function(){a.path(e.tracklistUrl)}}}}]),angular.module("mopify.widgets.directive.service",["mopify.services.servicemanager"]).directive("mopifyService",["$rootScope","ServiceManager",function(a,b){return{restrict:"E",scope:{service:"="},templateUrl:"directives/service.directive.tmpl.html",link:function(a,c,d){a.service.connected=b.isEnabled(a.service),a.connectService=function(){b.enableService(a.service),a.service.connected=!a.service.connected},a.disconnectService=function(){b.disableService(a.service),a.service.connected=!a.service.connected}}}}]),angular.module("mopify.widgets.directive.station",["mopify.services.station","LocalStorageModule"]).directive("mopifyStation",["stationservice","localStorageService",function(a,b){return{restrict:"E",scope:{station:"=",index:"="},templateUrl:"directives/station.directive.tmpl.html",link:function(c,d,e){c.visible=!0,c.start=function(){a.start(c.station)},c.delete=function(){var a=b.get("stations");null!=a&&(a.splice(a.length-1-c.index,1),b.set("stations",a),c.visible=!1)},c.getStationUrl=function(){switch(c.station.type.toLowerCase()){case"album":case"playlist":return"#/music/tracklist/"+c.station.spotify.uri+"/"+c.station.name;case"artist":return"#/music/artist/"+c.station.spotify.uri;case"track":return"#/music/tracklist/"+c.station.spotify.album.uri+"/"+c.station.spotify.album.name}}}}}]),angular.module("mopify.widgets.directive.stoppropagation",[]).directive("stopPropagation",function(){return{link:function(a,b,c){b.bind("click",function(a){a.stopPropagation()})}}}),angular.module("mopify.widgets.directive.track",["mopify.services.mopidy","mopify.services.station","mopify.services.util","mopify.services.playlistmanager","ui.bootstrap","spotify","mopify.services.spotifylogin","mopify.services.servicemanager","llNotifier","hmTouchEvents"]).directive("mopifyTrack",["$routeParams","$rootScope","$modal","$location","mopidyservice","stationservice","util","notifier","PlaylistManager","Spotify","SpotifyLogin","ServiceManager",function(a,b,c,d,e,f,g,h,i,j,k,l){return{restrict:"E",scope:{track:"=",type:"=",surrounding:"=?",currentPlayingTrack:"=currentplayingtrack"},transclude:!0,templateUrl:"directives/track.directive.tmpl.html",link:function(m,n,o){var p=a.uri;m.$evalAsync(function(){m.track.id=m.$id,m.track.uri?m.track.http_uri="https://open.spotify.com/track/"+m.track.uri.split(":")[2]:m.track.http_uri=!1,m.selected=!1,m.multipleselected=!0,m.visible=!0,m.showSaveTrack=!1,m.trackAlreadySaved=!1,void 0===m.surrounding&&(m.surrounding=m.$parent.loadedTracks)}),m.$watch(function(){return m.track.id},function(a,b){void 0===a&&null!=b&&(m.track.id=b)}),m.artistsString=function(){return g.artistsToString(m.track.artists,!0)},m.lengthHuman=function(){return g.timeFromMilliSeconds(m.track.length||m.track.duration_ms)},m.selectTrack=function(a){if(!0===a.ctrlKey)m.selected?b.selectedtracks=_.without(b.selectedtracks,_.findWhere(b.selectedtracks,{id:m.track.id})):b.selectedtracks.push(m.track);else if(!0===a.shiftKey){if(0===b.selectedtracks.length||m.surrounding.length<2)return;var c=b.selectedtracks[0].id,d=m.track.id;b.selectedtracks=[],_.each(m.surrounding,function(a){a.id>=c&&a.id<=d&&b.selectedtracks.push(a)})}else b.selectedtracks=[m.track]},m.$watch(function(){return b.selectedtracks},function(){var a=_.findWhere(b.selectedtracks,{id:m.track.id});m.selected=null!=a},!0),m.play=function(){var a=0,c=angular.copy(m.track);if(1===b.selectedtracks.length){_.each(m.surrounding,function(b,d){if(c.uri==b.uri)return void(a=d)});var f="/music/tracklist/mopidy:current"==d.path();"Track"==c.__model__?e.playTrack(c,m.surrounding,f):e.playTrack(m.surrounding[a],m.surrounding)}else{0===_.reject(b.selectedtracks,function(a){return"Track"==a.__model__}).length?e.playTrack(c,b.selectedtracks):(_.each(b.selectedtracks,function(b,d){if(c.uri==b.uri)return void(a=d)}),e.playTrack(b.selectedtracks[a],b.selectedtracks))}},m.playNext=function(){e.playNext(m.track.uri)},m.startStation=function(){f.startFromSpotifyUri(m.track.uri)},m.addToQueue=function(){var a=_.sortBy(b.selectedtracks,function(a){return a.id}),c=_.pluck(a,"uri");e.addToTracklist({uris:c}).then(function(a){b.$broadcast("mopidy:event:tracklistChanged",{})})},m.removeFromQueue=function(){var a=_.pluck(b.selectedtracks,"tlid");e.removeFromTracklist({tlid:a}).then(function(){b.$broadcast("mopidy:event:tracklistChanged",{}),b.selectedtracks=[]})},m.removeFromPlaylist=function(){var a=p.split(":")[4],c=_.map(b.selectedtracks,function(a){return a.uri});i.removeTrack(a,c).then(function(a){m.visible=!1,h.notify({type:"custom",template:"Track removed from playlist.",delay:3e3})},function(){h.notify({type:"custom",template:"Can't remove track. Are you connected with Spotify and the owner if this playlist?",delay:5e3})})},m.showPlaylists=function(){c.open({templateUrl:"modals/playlistselect.tmpl.html",controller:"PlaylistSelectModalController",size:"lg"}).result.then(function(a){var c=a.split(":")[4],d=_.map(b.selectedtracks,function(a){return a.uri});i.addTrack(c,d).then(function(a){h.notify({type:"custom",template:"Track(s) succesfully added to playlist.",delay:3e3})},function(){h.notify({type:"custom",template:"Can't add track(s). Are you connected with Spotify and the owner if this playlist?",delay:5e3})})})},m.toggleSaveTrack=function(){l.isEnabled("spotify")&&k.connected?m.trackAlreadySaved?j.removeUserTracks(m.track.uri).then(function(a){h.notify({type:"custom",template:"Track succesfully removed.",delay:5e3}),m.visible=!1},function(a){h.notify({type:"custom",template:"Something wen't wrong, please try again.",delay:5e3})}):j.saveUserTracks(m.track.uri).then(function(a){h.notify({type:"custom",template:"Track succesfully saved.",delay:5e3})},function(a){h.notify({type:"custom",template:"Something wen't wrong, please try again.",delay:5e3})}):h.notify({type:"custom",template:"Can't add track. Are you connected with Spotify?",delay:5e3})},m.onContextShow=function(){if(b.selectedtracks.length>1)return void(b.showSaveTrack=!1);l.isEnabled("spotify")&&k.connected?(j.userTracksContains(m.track.uri).then(function(a){m.trackAlreadySaved=a[0]}),m.showSaveTrack=!0):m.showSaveTrack=!1,m.selected||(b.selectedtracks=[m.track]),b.selectedtracks.length>1?m.multipleselected=!0:m.multipleselected=!1},m.onContextClose=function(){1===b.selectedtracks.length&&(m.selected=!1)}}}}]),angular.module("mopify.discover.browse",["mopify.services.mopidy","mopify.widgets.directive.browse","mopify.services.discover","mopify.services.station","mopify.services.servicemanager","infinite-scroll","llNotifier"]).config(["$routeProvider",function(a){a.when("/discover/browse",{templateUrl:"discover/browse/browse.tmpl.html",controller:"DiscoverBrowseController"})}]).controller("DiscoverBrowseController",["$scope","Discover","stationservice","ServiceManager","notifier",function(a,b,c,d,e){a.blocks=[],a.startStation=function(){c.startFromSpotify()},d.isEnabled("spotify")?b.getBrowseBlocks().then(function(b){a.blocks=b}):e.notify({type:"custom",template:"Enable the Spotify service if you want to use this feature.",delay:7500})}]),angular.module("mopify.discover.featured",["mopify.services.mopidy","mopify.services.spotifylogin","mopify.services.settings","spotify","mopify.services.util","mopify.services.station","mopify.widgets.directive.album","LocalStorageModule","llNotifier","mopify.services.servicemanager"]).config(["$routeProvider",function(a){a.when("/discover/featured",{templateUrl:"discover/featured/featured.tmpl.html",controller:"DiscoverFeaturedController"})}]).controller("DiscoverFeaturedController",["$rootScope","$scope","$timeout","mopidyservice","Spotify","Settings","SpotifyLogin","util","stationservice","localStorageService","notifier","ServiceManager",function(a,b,c,d,e,f,g,h,i,j,k,l){function m(){var a=f.get("locale","en_US"),c=f.get("country","US"),d=new Date,g=d.toISOString();e.getFeaturedPlaylists({locale:a,country:c,limit:12,timestamp:g}).then(function(a){var c=a.data;b.titletext=c.message,b.featuredplaylists=c.playlists.items,b.headerplaylist=c.playlists.items[Math.floor(Math.random()*c.playlists.items.length)],n()})}function n(){d.lookup(b.headerplaylist.uri).then(function(a){var d=a[b.headerplaylist.uri],e=angular.copy(d.splice(0,7)),f=!0;_.each(e,function(a){a.artiststring=h.artistsToString(a.artists),a.name.indexOf("loading")>-1&&(f=!1)}),f?b.headerplaylist.tracks=e:c(n,1e3)})}b.featuredplaylists=[],b.titletext="Loading...",b.headerplaylist={},b.$on("mopify:spotify:connected",m),l.isEnabled("spotify")?g.connected&&m():k.notify({type:"custom",template:"Please connect with the Spotify service first.",delay:3e3}),b.playHeaderPlaylist=function(){d.lookup(b.headerplaylist.uri).then(function(a){d.playTrack(a[0],a)})},b.startHeaderPlaylistStation=function(){i.startFromSpotifyUri(b.headerplaylist.uri)}}]),angular.module("mopify.discover.newreleases",["mopify.services.mopidy","mopify.services.spotifylogin","spotify","mopify.services.util","mopify.services.station","mopify.widgets.directive.playlist","mopify.services.settings","llNotifier"]).config(["$routeProvider",function(a){a.when("/discover/newreleases",{templateUrl:"discover/newreleases/newreleases.tmpl.html",controller:"DiscoverNewReleasesController"})}]).controller("DiscoverNewReleasesController",["$rootScope","$scope","$timeout","mopidyservice","SpotifyLogin","Spotify","util","stationservice","Settings","notifier",function(a,b,c,d,e,f,g,h,i,j){function k(){
if(e.connected){var a=i.get("country","GB");f.getNewReleases({country:a,limit:18}).then(function(a){var c=a.data;b.newreleases=c.albums.items,b.headeralbum=c.albums.items[Math.floor(Math.random()*(c.albums.items.length-1))],b.titletext=b.headeralbum.name,d.isConnected&&l()})}else b.titletext="Please connect to Spotify"}function l(){d.lookup(b.headeralbum.uri).then(function(a){var d=a[b.headeralbum.uri],e=angular.copy(d.splice(0,7)),f=!0;_.each(e,function(a){a.artiststring=g.artistsToString(a.artists),a.name.indexOf("loading")>-1&&(f=!1)}),f?b.headeralbum.tracks=e:c(l,1e3)})}b.newreleases=[],b.titletext="Get to know the latest releases",b.headeralbum={},b.$on("mopify:spotify:connected",k),e.connected?k():j.notify({type:"custom",template:"Please connect with the Spotify service first.",delay:3e3}),b.playHeaderAlbum=function(){d.lookup(b.headeralbum.uri).then(function(a){d.playTrack(a[0],a)})},b.startHeaderAlbumStation=function(){h.startFromSpotifyUri(b.headeralbum.uri)}}]),angular.module("mopify.modal.playlistselect",["mopify.services.playlistmanager"]).controller("PlaylistSelectModalController",["$scope","$modalInstance","PlaylistManager",function(a,b,c){a.userplaylists=[],c.getPlaylists({useronly:!0}).then(function(b){a.userplaylists=b}),a.cancel=function(){b.dismiss("cancel")},a.addToPlaylist=function(a){b.close(a)}}]),angular.module("mopify.music.artist",["ngRoute","mopify.services.spotifylogin","mopify.services.servicemanager","llNotifier","spotify","mopify.services.mopidy","mopify.services.station","mopify.widgets.directive.artist"]).config(["$routeProvider",function(a){a.when("/music/artist/:artistId",{templateUrl:"music/artist/artist.tmpl.html",controller:"ArtistController"})}]).controller("ArtistController",["$scope","$routeParams","mopidyservice","stationservice","notifier","Spotify","SpotifyLogin","ServiceManager",function(a,b,c,d,e,f,g,h){a.artistId=b.artistId,a.currentview={id:"music",name:"Music"},a.followingArtist=!1,a.setView=function(b){switch(b){case"music":a.currentview={id:"music",name:"Music"};break;case"related":a.currentview={id:"related",name:"Related Artists"};break;case"bio":a.currentview={id:"bio",name:"Biography"}}},h.isEnabled("spotify")&&g.connected&&f.userFollowingContains("artist",a.artistId.replace("spotify:artist:","")).then(function(b){a.followingArtist=b.data[0]}),a.artist={},f.getArtist(a.artistId).then(function(b){a.artist=b.data}),f.getRelatedArtists(a.artistId).then(function(b){a.related=b.data.artists.splice(0,18)}),a.toptracks=[],f.getArtistTopTracks(a.artistId,"NL").then(function(b){a.toptracks=b.data.tracks});var i={album_type:"album,single",country:"NL",limit:50};f.getArtistAlbums(a.artistId,i).then(function(b){a.albums=b.data.items}),a.startStation=function(){d.startFromSpotifyUri(a.artistId)},a.toggleFollowArtist=function(){h.isEnabled("spotify")&&g.connected?a.followingArtist?f.unfollow("artist",a.artistId.replace("spotify:artist:","")).then(function(b){e.notify({type:"custom",template:"Artist succesfully unfollowed.",delay:5e3}),a.followingArtist=!1},function(a){e.notify({type:"custom",template:"Something wen't wrong, please try again.",delay:5e3})}):f.follow("artist",a.artistId.replace("spotify:artist:","")).then(function(b){e.notify({type:"custom",template:"Artist succesfully followed.",delay:5e3}),a.followingArtist=!0},function(a){e.notify({type:"custom",template:"Something wen't wrong, please try again.",delay:5e3})}):e.notify({type:"custom",template:"Can't follow/unfollow artist. Are you connected with Spotify?",delay:5e3})}}]),angular.module("mopify.music.library.albums",["ngRoute","mopify.services.servicemanager","mopify.services.mopidy","mopify.widgets.directive.album","mopify.services.spotifylogin","spotify","llNotifier"]).config(["$routeProvider",function(a){a.when("/music/albums",{templateUrl:"music/library/albums/albums.tmpl.html",controller:"AlbumsLibraryController"})}]).controller("AlbumsLibraryController",["$scope","$rootScope","$q","$routeParams","ServiceManager","PlaylistManager","mopidyservice","notifier","Spotify","SpotifyLogin",function(a,b,c,d,e,f,g,h,i,j){function k(b){e.isEnabled("spotify")&&j.connected&&(void 0===b&&(b=0),i.getSavedUserAlbums({limit:50,offset:b}).then(function(c){var d=c.data,e=_.map(d.items,function(a){return a.album});a.albums.length>0&&a.albums[a.albums.length-1].id==e[0].id&&e.shift(),a.albums=a.albums.concat(e),null!=d.next&&k(b+50)}))}a.albums=[],e.isEnabled("spotify")?(b.$on("mopify:spotify:connected",function(){k()}),j.connected&&k()):h.notify({type:"custom",template:"Please connect with the Spotify service first.",delay:3e3})}]),angular.module("mopify.music.library.artists",["ngRoute","mopify.services.servicemanager","mopify.services.mopidy","mopify.widgets.directive.playlist","mopify.services.spotifylogin","spotify","llNotifier"]).config(["$routeProvider",function(a){a.when("/music/artists",{templateUrl:"music/library/artists/artists.tmpl.html",controller:"ArtistsLibraryController"})}]).controller("ArtistsLibraryController",["$scope","$rootScope","$q","$routeParams","ServiceManager","PlaylistManager","mopidyservice","notifier","Spotify","SpotifyLogin",function(a,b,c,d,e,f,g,h,i,j){function k(b){e.isEnabled("spotify")&&j.connected&&i.following("artist",{limit:50,after:b}).then(function(b){var c=b.data;if(l=l.concat(c.artists.items),null!=c.artists.next)k(c.artists.cursors.after);else{l.sort(function(a,b){return a.name==b.name?0:+(a.name>b.name)||-1});for(var d=1;d<l.length;)l[d-1].id==l[d].id?l.splice(d,1):d++;a.artists=l}})}var l=[];a.artists=[],e.isEnabled("spotify")?(b.$on("mopify:spotify:connected",function(){k()}),j.connected&&k()):h.notify({type:"custom",template:"Please connect with the Spotify service first.",delay:3e3})}]),angular.module("mopify.music.playlists",["ngRoute","mopify.services.servicemanager","mopify.services.mopidy","mopify.services.playlistmanager","mopify.widgets.directive.playlist","cgPrompt","llNotifier"]).config(["$routeProvider",function(a){a.when("/music/playlists/:folder?",{templateUrl:"music/library/playlists/playlists.tmpl.html",controller:"PlaylistsController"})}]).controller("PlaylistsController",["$scope","$routeParams","ServiceManager","PlaylistManager","mopidyservice","prompt","notifier",function(a,b,c,d,e,f,g){function h(){d.getPlaylists({ordered:!0}).then(function(c){null!=b.folder?a.playlists=c[b.folder]:a.playlists=d.playlists})}a.playlists=[],a.foldername=b.folder,c.isEnabled("spotify")?(a.spotifyplaylists=!0,h()):(e.isConnected&&h(),a.$on("mopidy:event:playlistsLoaded",h),a.$on("mopidy:state:online",h),a.spotifyplaylists=!1),a.createPlaylist=function(){f({title:"New Spotify playlist",message:"Please enter the name for the new playlist. This playlist will be added to your Spotify account.",input:!0,label:"Playlist name"}).then(function(a){d.createPlaylist(a).then(function(a){g.notify({type:"custom",template:"Playlist created.",delay:3e3})},function(){g.notify({type:"custom",template:"Can't create playlist. Are you connected with Spotify?",delay:5e3})})})}}]).controller("PlaylistsMenuController",["$scope","PlaylistManager",function(a,b){a.playlists={},a.hide=!0,b.getPlaylists({ordered:!0}).then(function(b){a.playlists=b,a.numberoffolders=Object.keys(a.playlists).length}),a.showPlaylists=function(){a.hide=!1},a.hidePlaylists=function(){a.hide=!0}}]),angular.module("mopify.music.stations",["ngRoute","spotify","llNotifier","LocalStorageModule","mopify.services.station","mopify.services.util","mopify.services.servicemanager","mopify.widgets.directive.station","mopify.services.settings"]).config(["$routeProvider",function(a){a.when("/music/stations",{templateUrl:"music/stations/stations.tmpl.html",controller:"StationsController"})}]).controller("StationsController",["$scope","$timeout","localStorageService","Spotify","stationservice","util","ServiceManager","notifier","Settings",function(a,b,c,d,e,f,g,h,i){function j(){a.wrapclass="",a.searchQuery="",a.creatingRadio=!1,a.headerSize="small"}a.stations=c.get("stations"),null===a.stations&&(a.stations=[],h.notify({type:"custom",template:"It looks like you haven't started any Stations yet. Click the 'Create new' button to start a new station.",delay:7500})),a.creatingRadio=!1,a.searchQuery="",a.headerSize="small",a.wrapclass="",a.searchResults={},a.spotifyConnected=g.isEnabled("spotify"),a.buildArtistString=function(a){return f.artistsToString(a)};var k=null;a.create=function(){a.creatingRadio=!0,a.headerSize="big"},a.search=function(c){if(b.cancel(k),27==c.keyCode)return void j();a.searchQuery.length>1?k=b(function(){a.wrapclass="dropdownvisible";var b=g.isEnabled("spotify")?"album,artist,track,playlist":"album,artist,track",c=i.get("country","US");d.search(a.searchQuery,b,{market:c,limit:"3"}).then(function(b){a.searchResults=b.data})},300):a.wrapclass=""},a.startFromNew=function(b,d){e.startFromSpotifyUri(d.uri).then(function(){a.stations=c.get("stations")}),j()}}]),angular.module("mopify.music.tracklist",["ngRoute","mopify.services.mopidy","mopify.services.util","mopify.services.station","mopify.services.spotifylogin","mopify.services.servicemanager","mopify.services.queuemanager","spotify","ngSanitize","llNotifier","mopify.widgets.directive.track","infinite-scroll"]).config(["$routeProvider",function(a){a.when("/music/tracklist/:uri/:name?",{templateUrl:"music/tracklist/tracklist.tmpl.html",controller:"TracklistController"})}]).controller("TracklistController",["$scope","$rootScope","$timeout","$routeParams","mopidyservice","stationservice","util","Spotify","SpotifyLogin","ServiceManager","notifier","QueueManager",function(a,b,c,d,e,f,g,h,i,j,k,l){function m(){s.indexOf("mopidy:")>-1&&l.all().then(function(b){var c=b.playlist.map(function(a){return a.track.tlid=a.tlid,a.track}),d=b.queue.map(function(a){return a.track.tlid=a.tlid,a.track});r(),a.loadedTracks=angular.copy(c),a.queue=angular.copy(d),a.loading=!1,a.getMoreTracks()}),s.indexOf("spotify:")>-1&&e.lookup(s).then(function(b){var d=b[s],e=!1;if(_.each(d,function(a){a.name.indexOf("[loading]")>-1&&(e=!0)}),e)c(m,1e3);else{a.loadedTracks=angular.copy(d);var f=Math.floor(Math.random()*d.length+0);"Album"==a.type&&q(d[f]),a.getMoreTracks(),a.loading=!1}})}function n(){j.isEnabled("spotify")&&i.connected?(a.isowner=v==i.user.id,h.getPlaylist(v,w).then(function(b){var c=b.data;a.coverImage=c.images[0].url,a.name=c.name+" from "+c.owner.id}),a.followingPlaylist=!1,h.playlistFollowingContains(v,w,i.user.id).then(function(b){a.followingPlaylist=b.data[0]})):b.$on("mopify:spotify:connected",function(){n()})}function o(){e.getCurrentTrack().then(function(b){a.currentPlayingTrack=b}),a.$on("mopidy:event:trackPlaybackEnded",function(b,c){null!=c.tl_track&&(a.currentPlayingTrack=c.tl_track.track)}),a.$on("mopidy:event:trackPlaybackStarted",function(b,c){null!=c.tl_track&&(a.currentPlayingTrack=c.tl_track.track)})}function p(b){j.isEnabled("spotify")&&i.connected?(void 0===b&&(b=0),h.getSavedUserTracks({limit:50,offset:b}).then(function(c){var d=c.data,e=_.map(d.items,function(a){return a.track});a.loadedTracks=a.loadedTracks.concat(e),null!=d.next?p(b+50):a.getMoreTracks()})):j.isEnabled("spotify")||k.notify({type:"custom",template:"Please connect with the Spotify service first.",delay:3e3})}function q(b){h.getTrack(b.uri).then(function(b){a.coverImage=b.data.album.images[0].url})}function r(){a.tracks=[],y=0}var s=d.uri;a.coverImage="./assets/images/playlists-header.jpg",a.$on("mopidy:state:online",m),a.$on("mopidy:state:online",o),e.isConnected&&(m(),o());var t=[],u=s.split(":"),v=u[2],w=u[4];s.indexOf(":playlist:")>-1&&(a.type="Playlist"),s.indexOf(":album:")>-1&&(a.type="Album",a.albumAlreadySaved=!1,j.isEnabled("spotify")&&i.connected&&(h.getAlbumTracks(s,{limit:50}).then(function(b){var c=b.data;t=_.map(c.items,function(a){return a.id}),h.userTracksContains(t).then(function(b){a.albumAlreadySaved=b[0]})}),a.showSaveAlbum=!0)),s.indexOf("mopidy:current")>-1&&(a.type="tracklist",a.coverImage="./assets/images/tracklist-header.jpg",a.$watch(function(){return l.version},function(){m()})),s.indexOf("spotify:library:songs")>-1&&(a.type="My Music - Songs",a.coverImage="./assets/images/tracklist-header.jpg"),null!=d.name?a.name=d.name:s.indexOf("mopidy:")>-1?a.name="Current tracklist":s.indexOf("spotify:library:songs")>-1?a.name="Your music: Songs":a.name="",a.tracks=[],a.queue=[],a.currentPlayingTrack={},a.loadedTracks=[],a.loading=!0,"Playlist"==a.type&&n(),"My Music - Songs"==a.type&&(b.$on("mopify:spotify:connected",function(){p()}),p()),a.toggleSaveAlbum=function(){"Album"==a.type&&(j.isEnabled("spotify")&&i.connected?a.albumAlreadySaved?h.removeUserTracks(t).then(function(b){k.notify({type:"custom",template:"Album successfully removed.",delay:5e3}),a.albumAlreadySaved=!1},function(a){k.notify({type:"custom",template:"Something went wrong, please try again.",delay:5e3})}):h.saveUserTracks(t).then(function(b){k.notify({type:"custom",template:"Album successfully saved.",delay:5e3}),a.albumAlreadySaved=!0},function(a){k.notify({type:"custom",template:"Something went wrong, please try again.",delay:5e3})}):k.notify({type:"custom",template:"Can't add album. Are you connected with Spotify?",delay:5e3}))},a.toggleFollowPlaylist=function(){"Playlist"==a.type&&(j.isEnabled("spotify")&&i.connected?a.followingPlaylist?h.unfollowPlaylist(v,w).then(function(b){k.notify({type:"custom",template:"Playlist successfully unfollowed.",delay:5e3}),a.followingPlaylist=!1},function(a){k.notify({type:"custom",template:"Something went wrong, please try again.",delay:5e3})}):h.followPlaylist(v,w,!0).then(function(b){k.notify({type:"custom",template:"Playlist successfully followed.",delay:5e3}),a.followingPlaylist=!0},function(a){k.notify({type:"custom",template:"Something went wrong, please try again.",delay:5e3})}):k.notify({type:"custom",template:"Can't follow playlist. Are you connected with Spotify?",delay:5e3}))},a.shuffle=function(){e.isConnected&&e.clearTracklist().then(function(){e.playTrack(a.loadedTracks[0],a.loadedTracks).then(function(){e.setRandom(!0).then(function(){b.$broadcast("mopify:playercontrols:changed")})})})},a.startStation=function(){s.indexOf("spotify:")>-1&&f.startFromSpotifyUri(s),s.indexOf("mopidy:")>-1&&f.startFromTracks(a.tracks)};var x=40,y=0;a.getMoreTracks=function(){if(a.loadedTracks.length>x*y){var b=a.tracks,c=a.loadedTracks.slice(y*x,y*x+x);a.tracks=b.concat(c),y++}}}]),angular.module("mopify.player.controls",["mopify.services.mopidy","mopify.services.station","cfp.hotkeys","mopify.services.queuemanager"]).controller("PlayerControlsController",["$scope","$window","$rootScope","mopidyservice","stationservice","hotkeys","QueueManager",function(a,b,c,d,e,f,g){a.volume=0,a.isRandom=!1,a.isPlaying=!1,a.stateIcon="ss-play",a.volumeIcon="ss-volume",a.$on("mopidy:event:playbackStateChanged",function(b,c){a.stateIcon="playing"===c.new_state?"ss-pause":"ss-play",a.isPlaying="playing"===c.new_state}),a.$on("mopidy:event:volumeChanged",function(b,c){a.volume=c.volume}),a.$on("mopidy:state:online",function(){d.getVolume().then(function(b){a.volume=b,a.volumeIcon=b>50?"ss-highvolume":b>0?"ss-lowvolume":"ss-volume"}),d.getState().then(function(b){a.isPlaying="playing"===b,a.stateIcon="playing"===b?"ss-pause":"ss-play"}),a.$watch(function(){return g.shuffle},function(b){a.isRandom=b}),d.getRepeat().then(function(b){a.isRepeat=!0===b})}),a.$on("mopify:playercontrols:changed",function(){d.getRandom().then(function(b){a.isRandom=!0===b}),d.getRepeat().then(function(b){a.isRepeat=!0===b})}),a.next=function(){d.next().then(function(a){c.$broadcast("mopify:player:updatePlayerInformation")})},a.prev=function(){d.previous().then(function(a){c.$broadcast("mopify:player:updatePlayerInformation")})},a.playpause=function(){d.getState().then(function(b){"playing"===b?(d.pause(),a.stateIcon="ss-play"):(d.play(),a.stateIcon="ss-pause")})},a.stop=function(){d.stop(),a.stateIcon="ss-pause"},a.volumebarMouseClick=function(b,c){var e=b.layerX,f=b.currentTarget||b.srcElement,g=f.clientWidth,h=e/g*100;a.volume=h,d.setVolume(h)};var h=!1;a.volumebarMouseDown=function(a){h=!0},a.volumebarMouseUp=function(a){h=!1},a.volumebarMouseMove=function(b,c){var e=b.currentTarget||b.srcElement;if(h&&b.layerY>=0&&b.layerY<=e.clientHeight){var f=b.layerX,g=e.clientWidth,i=f/g*100;a.volume=i,d.setVolume(i)}},a.raiseVolume=function(){a.volume=a.volume+5<=95?a.volume+5:100,d.setVolume(a.volume)},a.lowerVolume=function(){a.volume=a.volume-5>=5?a.volume-5:0,d.setVolume(a.volume)},a.toggleShuffle=function(){a.isRandom=!a.isRandom,d.setRandom(a.isRandom)},a.toggleRepeat=function(){a.isRepeat=!a.isRepeat,d.setRepeat(a.isRepeat)},a.openVolumeOverlay=function(){b.innerWidth<=768&&(a.volumeopened=!0)},a.closeVolumeOverlay=function(){a.volumeopened=!1},f.add({combo:"ctrl+left",description:"Play previous track",callback:function(b,c){b.preventDefault(),a.prev()}}),f.add({combo:"ctrl+right",description:"Play the next track",callback:function(b,c){b.preventDefault(),a.next()}}),f.add({combo:"space",description:"Play/Pause",callback:function(b,c){b.preventDefault(),a.playpause()}}),f.add({combo:"ctrl+s",description:"Stop playback",callback:function(b,c){b.preventDefault(),a.stop()}}),f.add({combo:"ctrl+up",description:"Raise volume",callback:function(b,c){b.preventDefault(),a.raiseVolume()}}),f.add({combo:"ctrl+down",description:"Lower volume",callback:function(b,c){b.preventDefault(),a.lowerVolume()}}),f.add({combo:"s",description:"Toggle shuffle mode",callback:function(b,c){b.preventDefault(),a.toggleShuffle()}}),f.add({combo:"r",description:"Toggle repeat mode",callback:function(b,c){b.preventDefault(),a.toggleRepeat()}})}]),angular.module("mopify.player",["spotify","mopify.services.mopidy","mopify.services.history","mopify.services.util"]).controller("PlayerController",["$scope","$rootScope","$timeout","$interval","$window","Spotify","mopidyservice","History","util",function(a,b,c,d,e,f,g,h,i){function j(b){null!=b&&b.uri!==m&&(a.trackArtist=i.artistsToString(b.artists,!1),a.trackTitle=b.name,a.albumUri=b.album.uri,a.albumName=b.album.name,f.getTrack(b.uri).then(function(d){var e=d.data;a.playerBackground=e.album.images[0].url,c.cancel(l),l=c(function(){k(b,e.album.images)},1e4)}),m=b.uri)}function k(a,b){null!=a&&h.addTrack(a,{images:b})}a.trackTitle="",a.trackArtist="",a.albumUri="",a.albumName="",a.playerBackground="",a.mobiledisplay=e.innerWidth<1024;var l=null,m=null;a.$on("mopidy:state:online",function(){g.getCurrentTrack().then(function(a){null!=a&&(a.name.indexOf("[loading]")>-1?g.lookup(a.uri).then(function(a){j(a[0])}):j(a))}),g.getState().then(function(b){a.isPlaying="playing"===b}),g.getRandom().then(function(b){a.isRandom=!0===b}),d(function(){b.$broadcast("mopify:player:updatePlayerInformation")},15e3),a.$watch(function(){return g.handlingRequest},function(b){a.showLoading=!0===b})}),a.$on("mopidy:event:trackPlaybackStarted",function(a,b){null!=b.tl_track&&(b.tl_track.track.name.indexOf("[loading]")>-1?g.lookup(b.tl_track.track.uri).then(function(a){j(a[0])}):j(b.tl_track.track))}),a.$on("mopify:player:updatePlayerInformation",function(){g.getCurrentTrack().then(function(a){null!=a&&(a.name.indexOf("[loading]")>-1?g.lookup(a.uri).then(function(a){j(a[0])}):j(a))})}),a.$on("mopidy:state:offline",function(){a.trackArtist="Mopidy",a.trackTitle="No connection"}),a.$on("mopidy:state:online",function(){a.trackArtist="Mopidy",a.trackTitle="Connected"})}]),angular.module("mopify.player.seekbar",["mopify.services.mopidy","mopify.services.util"]).controller("PlayerSeekbarController",["$scope","$interval","$q","mopidyservice","util",function(a,b,c,d,e){function f(){l||d.getTimePosition().then(function(b){n=b,a.seekbarWidth=b/m*100,a.timeCurrent=e.timeFromMilliSeconds(b)})}function g(){b.cancel(k),k=b(function(){n+=1e3,a.seekbarWidth=n/m*100,a.timeCurrent=e.timeFromMilliSeconds(n)},1e3)}function h(){i().then(function(c){m=c.length,a.timeTotal=e.timeFromMilliSeconds(m),f(),b.cancel(j),j=b(function(){f()},1e4)})}function i(){var a=c.defer();return d.getCurrentTrack().then(function(b){if(null!=b){if(!(b.name.indexOf("[loading]")>-1))return a.resolve(b);d.lookup(b.uri).then(function(b){return a.resolve(b[0])})}}),a.promise}var j,k,l=!1,m=0,n=0;a.seekbarWidth=0,a.timeCurrent="0:00",a.timeTotal="0:00",a.$on("mopidy:state:online",function(){h(),d.getState().then(function(a){"playing"===a&&g()})}),a.$on("mopidy:event:trackPlaybackStarted",function(a,b){h(),g()}),a.$on("mopidy:event:trackPlaybackEnded",function(a,c){b.cancel(k),n=0}),a.$on("mopify:player:updatePlayerInformation",function(a,b){h(),g()}),a.$on("mopidy:event:playbackStateChanged",function(a,c){f(),"playing"==c.new_state?g():b.cancel(k)}),a.$on("mopidy:state:offline",function(){b.cancel(j)}),a.seekbarMouseClick=function(b){var c=b.layerX,e=b.currentTarget||b.srcElement,f=e.clientWidth,g=c/f*100;a.seekbarWidth=g;var h=Math.round(m*(g/100));l=!0,d.seek(h).then(function(){l=!1,n=h})},a.seekbarMouseDown=function(a){1!==a.button&&1!==a.which||(l=!0)},a.seekbarMouseUp=function(){l=!1},a.seekbarMouseMove=function(b){if(l){var c=b.layerX,e=b.currentTarget||b.srcElement,f=e.clientWidth,g=c/f*100;a.seekbarWidth=g;var h=Math.round(m*(g/100));l=!0,d.seek(h).then(function(){l=!1})}}}]),angular.module("mopify.search",["spotify","ngRoute","cfp.hotkeys","mopify.services.spotifylogin","mopify.services.mopidy","mopify.services.station","mopify.services.util","mopify.widgets.directive.playlist","mopify.widgets.directive.album","mopify.widgets.directive.artist","mopify.widgets.directive.track","mopify.widgets.directive.focusme"]).config(["$routeProvider",function(a){a.when("/search",{templateUrl:"search/search.tmpl.html",controller:"SearchController",reloadOnSearch:!1})}]).controller("SearchController",["$rootScope","$scope","$routeParams","$route","$timeout","$location","Spotify","SpotifyLogin","mopidyservice","stationservice","util","Settings","PlaylistManager",function(a,b,c,d,e,f,g,h,i,j,k,l,m){function n(a,c){var d=null,e={},f=[];c=angular.copy(c),_.each(c,function(a,b){null!=a&&(a.items?f.push({type:b,items:a.items}):f.push({type:b,items:a}))}),_.each(f,function(b){_.each(b.items,function(c){var f=c.name.toLowerCase(),g=o(a,f);(null===d||d>g)&&(d=g,e={item:c,type:b.type})})}),null!=e.item&&("artists"===e.type?e.link="#/music/artist/"+e.item.uri:e.link="#/music/tracklist/"+e.item.uri),b.loading=!1,b.topresult=e}function o(a,b){if(0===a.length)return b.length;if(0===b.length)return a.length;var c,d=[];for(c=0;c<=b.length;c++)d[c]=[c];var e;for(e=0;e<=a.length;e++)d[0][e]=e;for(c=1;c<=b.length;c++)for(e=1;e<=a.length;e++)b.charAt(c-1)==a.charAt(e-1)?d[c][e]=d[c-1][e-1]:d[c][e]=Math.min(d[c-1][e-1]+1,Math.min(d[c][e-1]+1,d[c-1][e]+1));return d[b.length][a.length]}b.$watch(function(){return c.query},function(a){b.query=a,b.typing()});var p=null;b.results={artists:[],tracks:[],albums:[],playlists:[]},b.searchLimits={artists:8,albums:8,tracks:15,playlists:8},b.topresult={},b.loading=!0;var q=c.query||"";b.typing=function(a){null!=a&&27===a.keyCode&&b.closeSearch(),0!==b.query.trim().length&&b.query!==q&&(q=b.query,b.loading=!0,e.cancel(p),p=e(function(){f.search("query",b.query),b.query.trim().length>1&&b.performSearch()},1e3))},b.closeSearch=function(){f.url(c.refer||"/")},b.performSearch=function(){var a=h.connected?"album,artist,playlist":"album,artist",c=0;g.search(b.query,a,{market:l.get("country","US"),limit:"50"}).then(function(a){var d=a.data,e=m.search(b.query);void 0===d.playlists&&(d.playlists={items:[]}),d.playlists.items=e.concat(d.playlists.items),b.results.artists=d.artists,b.results.albums=d.albums,b.results.playlists=d.playlists,g.getAlbums(_.map(d.albums.items.slice(0,20),function(a){return a.id})).then(function(a){angular.extend(b.results.albums.items,a.data.albums)}),2==++c&&n(b.query,b.results)}),i.search(b.query).then(function(a){a.length>0&&null!=a[0].tracks&&(b.results.tracks=a[0].tracks.splice(0,100)),2==++c&&n(b.query,b.results)})},b.$on("mopidy:state:online",function(){p=e(function(){b.query.trim().length>1&&b.performSearch()},250)}),i.isConnected&&(p=e(function(){b.query.trim().length>1&&b.performSearch()},250)),b.playTopItem=function(){i.lookup(b.topresult.item.uri).then(function(a){var c=a[b.topresult.item.uri];i.playTrack(c[0],c.splice(0,10))})},b.startTopItemStation=function(){j.startFromSpotifyUri(b.topresult.item.uri)},b.searchLimitsToggle=function(a){50==b.searchLimits[a]?b.searchLimits[a]="tracks"!=a?8:15:b.searchLimits[a]=50}}]).controller("SearchMenuController",["$scope","$rootScope","$routeParams","$route","$location","hotkeys",function(a,b,c,d,e,f){var g="";a.typing=function(){if(void 0!==a.query){if(a.query.trim().length>0&&a.query!==g){var b;b=e.url().indexOf("/search")>-1?c.refer:e.url(),e.url("/search?query="+a.query+"&refer="+b)}g=a.query}},a.query=c.query,f.add({combo:"ctrl+f",description:"Search",callback:function(a,c){a.preventDefault(),b.focussearch=!0}}),a.$watch(function(){return c.query},function(b){a.query=b})}]),angular.module("mopify.services.autoupdate",["mopify.services.settings"]).factory("AutoUpdate",["$q","$http","$location","$rootScope","Settings",function(a,b,c,d,e){function f(){this.autoupdate=e.get("autoupdate",!1)}var g=!1,h=e.get("mopidyip",c.host()),i=e.get("mopidyport",c.port());return f.prototype.check=function(){var d=a.defer();return b.get(c.protocol()+"://"+h+":"+i+"/mopify/update").success(function(a){g=a.response,d.resolve(g)}).error(function(a){g=!1,d.reject(g)}),d.promise},f.prototype.runUpdate=function(){var e=a.defer();return g?b.post(c.protocol()+"://"+h+":"+i+"/mopify/update").success(function(a){e.resolve(a),d.$broadcast("mopify:update:succesfull",a)}).error(function(a){e.reject(a)}):e.reject({response:"Can't update since Mopidy isn't running as root."}),e.promise},new f}]),angular.module("mopify.services.discover",["mopify.services.history"]).factory("Discover",["$q","History","Spotify",function(a,b,c){function d(){this.data={blocks:[]}}return d.prototype.getBrowseBlocks=function(){var b=this,c=a.defer();return 0===b.data.blocks.length?b.generateBrowseContent().then(function(a){c.resolve(a),b.data.blocks=a}):c.resolve(b.data.blocks),c.promise},d.prototype.generateBrowseContent=function(){var a=b.getTracks().reverse().splice(0,50);return c.getUserTopTracks({limit:5}).then(function(a){return _.map(a.data.items,function(a){return a.id})}).then(function(a){return c.getRecommendations({limit:100,seed_tracks:a})}).then(function(b){var c=b.data.tracks,d=[];return _.forEach(c,function(a){d.push({type:"spotify",spotify:a})}),_.forEach(a,function(a){d.push({type:"artist",artist:a.track.artists[0]})}),_.shuffle(d)})},new d}]),angular.module("ErrorCatcher",[]).factory("$exceptionHandler",["$window",function(a){return function(a,b){console.error(a.stack)}}]),angular.module("mopify.services.facebook",[]).factory("Facebook",["$q","$timeout","$document",function(a,b,c){function d(a){var b=document.createElement("iframe");return b.setAttribute("src","https://bitlabs.nl/mopify/auth/"+a+"/frame/#"+window.location.host),b.style.width="1px",b.style.height="1px",f.append(b),b}function e(){this.accessToken=null,this.frame=d("facebook"),this.ready=!1,this.waitingline=[],this.connected=!1,this.callbackqueue={}}var f=c.find("body").eq(0);e.prototype.request=function(a){if(this.ready){a.id=Date.now()+Math.floor(Date.now()*Math.random()),a.finished=!1,this.callbackqueue[a.id]=a;var b=JSON.stringify(a);this.frame.contentWindow.postMessage(b,"*")}else this.waitingline.push(a),this.tryToProcess()},e.prototype.received=function(a){"ready"==a.method&&(this.ready=!0),"connected"==a.method&&(this.connected=!0),null!=this.callbackqueue[a.id]&&null!=this.callbackqueue[a.id].callback&&(this.callbackqueue[a.id].callback(a.callbackdata),this.callbackqueue[a.id].finished=!1)},e.prototype.tryToProcess=function(){var a=this;if(this.ready)for(var c=0;c<this.waitingline.length;c++)a.request(a.waitingline[c]);else b(function(){a.tryToProcess()},500)},e.prototype.login=function(){var b=a.defer();return this.request({method:"login",callback:function(a){"connected"==a.status?b.resolve(a):b.reject(a)}}),b.promise},e.prototype.getLoginStatus=function(){var b=a.defer();return this.request({method:"loginStatus",callback:function(a){b.resolve(a)}}),b.promise},e.prototype.api=function(b,c){var d=a.defer();return this.request({method:"api",path:b,data:c,callback:function(a){d.resolve(a)}}),d.promise};var g=new e;return window.addEventListener("message",function(a){if("https://bitlabs.nl"==a.origin){var b=a.data;switch(b.service){case"facebook":g.received(b)}}}),g}]),angular.module("mopify.services.history",["LocalStorageModule"]).factory("History",["localStorageService",function(a){function b(){this.historystorage=a.get(c),null===this.historystorage&&(this.historystorage=a.set(c,{tracks:[]}))}var c="history";return b.prototype.addTrack=function(b,d){var e={track:b,meta:d,created:Date.now()};this.historystorage.tracks.push(e);var f=_.uniq(this.historystorage.tracks,function(a){return a.track.uri});this.historystorage.tracks=f,a.set(c,this.historystorage);b.uri},b.prototype.getTracks=function(){return a.get(c).tracks},new b}]),angular.module("mopify.services.mopidy",["mopify.services.settings","mopify.services.queuemanager","llNotifier"]).factory("mopidyservice",["$q","$rootScope","$cacheFactory","$location","Settings","notifier","QueueManager",function(a,b,c,d,e,f,g){function h(c,d){return function(){var e=a.defer(),f=Array.prototype.slice.call(arguments),g=d||this;return b.$broadcast("mopify:callingmopidy",{name:c,args:f}),g.isConnected,i(c,g,f).then(function(a){e.resolve(a),b.$broadcast("mopify:calledmopidy",{name:c,args:f})},function(a){e.reject(a),b.$broadcast("mopify:errormopidy",{name:c,args:f,err:a})}),e.promise}}function i(a,b,c){for(var d=a.split("."),e=d.pop(),f=0;f<d.length;f++)b=b[d[f]];return b[e].apply(b,c)}var j=console.error.bind(console);return{mopidy:{},isConnected:!1,currentTlTracks:[],handlingRequest:!1,start:function(){var a=this;b.$broadcast("mopify:startingmopidy");var c=e.get("mopidyip",d.host()),g=e.get("mopidyport",d.port());try{var h="undefined"!=typeof document&&"https:"===document.location.protocol?"wss://":"ws://";this.mopidy=new Mopidy({webSocketUrl:h+c+":"+g+"/mopidy/ws",callingConvention:"by-position-or-by-name"})}catch(a){f.notify({type:"custom",template:"Connecting with Mopidy failed with the following error message: <br>"+a,delay:15e3}),this.mopidy=new Mopidy({callingConvention:"by-position-or-by-name"})}this.mopidy.on(function(c,d){b.$broadcast("mopidy:"+c,d),"state:online"===c&&(a.isConnected=!0),"state:offline"===c&&(a.isConnected=!1)}),b.$broadcast("mopify:mopidystarted")},shutdown:function(){b.$broadcast("mopify:stoppingmopidy"),this.mopidy.close(),this.mopidy.off(),this.mopidy=null,b.$broadcast("mopify:stoppedmopidy")},restart:function(){this.shutdown(),this.start()},getPlaylists:function(){return h("mopidy.playlists.getPlaylists",this)()},getPlaylist:function(a){return h("mopidy.playlists.lookup",this)({uri:a})},getTrack:function(a){return h("mopidy.library.lookup",this)({uri:a})},getAlbum:function(a){return h("mopidy.library.lookup",this)({uri:a})},getArtist:function(a){return h("mopidy.library.lookup",this)({uri:a})},search:function(a){return h("mopidy.library.search",this)({any:[a]})},getCurrentTrack:function(){return h("mopidy.playback.getCurrentTrack",this)()},getTimePosition:function(){return h("mopidy.playback.getTimePosition",this)()},seek:function(a){return h("mopidy.playback.seek",this)({time_position:a})},getVolume:function(){return h("mopidy.mixer.getVolume",this)()},setVolume:function(a){return a=Math.round(a),h("mopidy.mixer.setVolume",this)({volume:a})},getState:function(){return h("mopidy.playback.getState",this)()},lookup:function(a){return"string"==typeof a&&(a=[a]),h("mopidy.library.lookup",this)({uris:a})},playTrack:function(c,d,e){var f=this,h=a.defer();return void 0===d&&(d=[]),b.$broadcast("mopify:player:loadingtracks"),f.handlingRequest=!0,g.all().then(function(a){
f.mopidy.tracklist.clear().then(function(){var b=[c.uri];if(_.forEach(a.queue,function(a){b.push(a.track.uri)}),d.length>0){var i=0;_.find(d,function(a,b){c.uri===a.uri&&(i=b+1)});var j=d.slice(i,d.length),k=d.slice(0,i);_.forEach(j,function(a){b.push(a.uri)}),k.length>1&&g.remove(_.pluck(k,"tlid"))}f.mopidy.tracklist.add({uris:b}).then(function(b){var c=a.queue.length+1,d=b.length,i=b.slice(0,c),j=b.slice(c,d);g.replace({playlist:j,queue:i}).then(function(){f.mopidy.playback.play({tl_track:b[0]}).then(function(a){f.handlingRequest=!1,g.getShuffle().then(function(b){b&&!0!==e?f.setRandom(!0).then(function(){h.resolve(a)}):h.resolve(a)})})})})})}),h.promise},playTrackAtIndex:function(a){var c=this;c.mopidy.tracklist.getTlTracks().then(function(d){a=a<d.length?a:d.length-1;var e=d[a];c.mopidy.playback.play({tl_track:e}).then(function(){b.$broadcast("mopidy:event:trackPlaybackStarted",e)})},j)},clearTracklist:function(){var b=a.defer();return this.mopidy.tracklist.clear().then(function(){g.replace({queue:[],playlist:[]}).then(function(){b.resolve()})}),b.promise},addToPlaylist:function(b){var c=a.defer();return this.mopidy.tracklist.add(b).then(function(a){g.addToPlaylist(a),c.resolve()}),c.promise},addToTracklist:function(b){var c=this,d=a.defer();return this.getNextTrackPosition().then(function(a){g.all().then(function(e){b.at_position=e.queue.length+a,c.mopidy.tracklist.add(b).then(function(a){g.add(a),d.resolve()})})}),d.promise},getTracklist:function(){return h("mopidy.tracklist.getTlTracks",this)()},getNextTracklistId:function(){return h("mopidy.tracklist.getNextTlid")},playNext:function(c){var d=a.defer(),e=this;return"string"==typeof c&&(c=[c]),e.getNextTrackPosition().then(function(a){e.mopidy.tracklist.add({uris:c,at_position:a}).then(function(a){g.next(a).then(function(){d.resolve(a),b.$broadcast("mopidy:event:tracklistChanged")})})}),d.promise},getNextTrackPosition:function(){var b=a.defer(),c=this;return c.mopidy.tracklist.getNextTlid().then(function(a){c.mopidy.tracklist.getTlTracks().then(function(c){var d=_.findIndex(c,function(b){return b.tlid==a});b.resolve(d)})}),b.promise},play:function(a){return null!=a?h("mopidy.playback.play",this)({tl_track:a}):h("mopidy.playback.play",this)()},pause:function(){return h("mopidy.playback.pause",this)()},stop:function(){return h("mopidy.playback.stop",this)()},previous:function(){return h("mopidy.playback.previous",this)()},next:function(){var b=this,c=a.defer();return b.mopidy.playback.getState().then(function(a){"playing"===a?b.mopidy.playback.next().then(function(a){c.resolve(a)}):b.mopidy.playback.play().then(function(){b.mopidy.playback.next().then(function(a){c.resolve(a)})})}),c.promise},setConsume:function(){return h("mopidy.tracklist.setConsume",this)([!0])},getRandom:function(){return g.getShuffle()},setRandom:function(b){var c=this,d=a.defer();return c.mopidy.tracklist.setRandom([!1]),!1===b?g.setShuffle(!1).then(function(a){c.mopidy.tracklist.getTlTracks().then(function(b){var e=_.pluck(b.slice(1),"tlid");c.mopidy.tracklist.remove({criteria:{tlid:e}}).then(function(){var b=a.queue.concat(a.playlist),e=_.map(b,function(a){return a.track.uri});c.mopidy.tracklist.add({uris:e}).then(function(a){var b=a.slice(0,g.queue.length),c=a.slice(g.queue.length);g.replace({queue:b,playlist:c}),d.resolve(a)})})})}):g.all().then(function(a){var b=a.queue.length+1,e=a.playlist.length+1;e>=b?c.mopidy.tracklist.shuffle({start:b,end:e}).then(function(a){c.mopidy.tracklist.getTlTracks().then(function(a){var c=a.slice(b);g.setShuffle(!0,c),d.resolve(c)})}):d.reject()}),d.promise},getRepeat:function(){return h("mopidy.tracklist.getRepeat",this)()},setRepeat:function(b){var c=a.defer(),d=this;return h("mopidy.tracklist.setRepeat",d)([b]).then(function(){h("mopidy.tracklist.setSingle",d)([b]).then(function(){c.resolve()})}),c.promise},removeFromTracklist:function(a){return h("mopidy.tracklist.remove",this)(a).then(function(a){var b=_.pluck(a,"tlid");g.remove(b)})}}}]),angular.module("mopify.services.playlistmanager",["mopify.services.mopidy","mopify.services.servicemanager","mopify.services.settings","spotify"]).factory("PlaylistManager",["$rootScope","$q","$interval","ServiceManager","Spotify","mopidyservice","Settings",function(a,b,c,d,e,f,g){function h(){var b=this;this.source="",this.playlists=[],this.orderedPlaylists={},this.loading=!0,b.spotifyuserid=null;var c=!1;null!=g.get("spotify")&&(c=g.get("spotify").loadspotifyplaylists),d.isEnabled("spotify")&&!0===c?a.$on("mopify:spotify:connected",function(){e.getCurrentUser().then(function(a){b.spotifyuserid=a.data.id,b.loadPlaylists()})}):(a.$on("mopidy:state:online",function(){b.loadPlaylists()}),f.isConnected&&b.loadPlaylists()),a.$on("mopidy:event:playlistsLoaded",function(){b.loadPlaylists()})}function i(a){var b={rest:[]};return _.each(a,function(a){var c=a.name.split("/",2),d=c[0];c.length>1?(a.name=c[1],void 0===b[d]?b[d]=[a]:b[d].push(a)):b.rest.push(a)}),b}function j(a){return a.sort(function(a,b){return a.name.toLowerCase()<b.name.toLowerCase()?-1:a.name.toLowerCase()>b.name.toLowerCase()?1:0})}return h.prototype.loadPlaylists=function(){var a=this;this.loading=!0,this.playlists=[],this.orderedPlaylists={};var b=!1;null!=g.get("spotify")&&(b=g.get("spotify").loadspotifyplaylists),d.isEnabled("spotify")&&!0===b?(this.source="spotify",e.getUserPlaylists(a.spotifyuserid,{limit:50}).then(function(b){var c=b.data;a.playlists=c.items,null!=c.next?a.loadMorePlaylists(c.next):(a.playlists=j(a.playlists),a.loading=!1)})):(this.source="mopidy",f.getPlaylists().then(function(b){a.playlists=j(b),a.orderedPlaylists=i(b),a.loading=!1}))},h.prototype.search=function(a){var b=this.playlists;return _.filter(b,function(b){return b&&b.name.toLowerCase().indexOf(a.toLowerCase())>-1})},h.prototype.getPlaylists=function(a){var d=b.defer(),e=this;if(a=a||{},e.loading)var f=c(function(){if(!e.loading){c.cancel(f);var b=e.playlists;!0===a.ordered&&(b=e.orderedPlaylists),!0===a.useronly&&!0!==a.ordered&&(b=_.filter(e.playlists,function(a){return a.uri.indexOf(e.spotifyuserid)>0})),d.resolve(b)}},300);else{var g=e.playlists;!0===a.ordered&&(g=e.orderedPlaylists),!0===a.useronly&&!0!==a.ordered&&(g=_.filter(e.playlists,function(a){return a.uri.indexOf(e.spotifyuserid)>0})),d.resolve(g)}return d.promise},h.prototype.loadMorePlaylists=function(a){var b=this;e.api(a.replace("https://api.spotify.com/v1",""),"GET",null,{},{Authorization:"Bearer "+e.authToken,"Content-Type":"application/json"}).then(function(a){b.playlists=j(b.playlists.concat(a.items)),null!=a.next?b.loadMorePlaylists(a.next):b.loading=!1})},h.prototype.removeTrack=function(a,c){var f=b.defer();return d.isEnabled("spotify")?e.removePlaylistTracks(this.spotifyuserid,a,c).then(function(a){f.resolve(a)}):f.reject(),f.promise},h.prototype.addTrack=function(a,c){var f=b.defer();return d.isEnabled("spotify")?e.addPlaylistTracks(this.spotifyuserid,a,c).then(function(a){f.resolve(a)}):f.reject(),f.promise},h.prototype.addAlbum=function(a,c){var f=b.defer(),g=this;return d.isEnabled("spotify")?e.getAlbumTracks(c,{limit:50}).then(function(b){var c=b.data,d=_.map(c.items,function(a){return a.uri});e.addPlaylistTracks(g.spotifyuserid,a,d).then(function(a){f.resolve(a)})}):f.reject(),f.promise},h.prototype.createPlaylist=function(a){var c=b.defer(),f=this;return d.isEnabled("spotify")?e.createPlaylist(f.spotifyuserid,{name:a}).then(function(a){c.resolve(a),f.playlists.push(a),f.playlists=j(f.playlists)}):c.reject(),c.promise},new h}]),angular.module("mopify.services.queuemanager",["mopify.services.settings"]).factory("QueueManager",["$q","$http","$location","$rootScope","$timeout","Settings",function(a,b,c,d,e,f){function g(){for(var a=0;a<l.length;a++){var b=l[a];q(b.method,b.data,b.id),l.splice(a,1)}}function h(){var a=this;this.version=0,this.shuffle=!1,this.playlist=[],this.queue=[],this.setupWebsocket(),a.loadData(),d.$on("mopidy:event:trackPlaybackStarted",function(){a.loadData()}),d.$on("mopidy:event:tracklistChanged",function(){a.all().then(function(b){a.version=b.version})}),d.$on("queuemanager:event:changed",function(){a.loadData()})}var i,j=[],k=!1,l=[],m=f.get("mopidyip",c.host()),n=f.get("mopidyport",c.port()),o="undefined"!=typeof document&&"https:"===document.location.protocol?"wss://":"ws://",p=1e3,q=function(b,c,d){var e,f=void 0===d?j.length:d;e=null!=j[f]?j[f]:a.defer(),c=void 0===c?{}:c;var g={method:b,data:c,id:f};return!1===k?l.push(g):i.send(angular.toJson(g)),j[f]=e,e.promise};return h.prototype.checkConnectionReady=function(){var a=this;e(function(){1===i.readyState?(console.info("Websocket: connection ready"),k=!0,g()):a.checkConnectionReady()},200)},h.prototype.startRecovering=function(){var a=this;null!=i&&this.closeWebsocketConnection(),e(function(){a.setupWebsocket()},p),p+=1e3},h.prototype.closeWebsocketConnection=function(){i.onopen=function(){},i.onclose=function(){},i.onerror=function(){},i.onmessage=function(){}},h.prototype.setupWebsocket=function(){var a=this;i=new WebSocket(o+m+":"+n+"/mopify/queuemanager/"),i.onopen=function(){a.checkConnectionReady()},i.onclose=function(){k=!1,i.close(),a.startRecovering()},i.onmessage=function(b){var c=angular.fromJson(b.data);null!=c.id&&(j[c.id].resolve(c.call),null!=c.call.version&&(a.version=c.call.version))}},h.prototype.loadData=function(){var a=this;this.all().then(function(b){a.shuffle=b.shuffle,a.queue=b.queue,a.playlist=b.playlist,a.version=b.version})},h.prototype.all=function(){return q("get_all")},h.prototype.queue=function(){return q("get_queue")},h.prototype.playlist=function(){return q("get_playlist")},h.prototype.getShuffle=function(){var b=a.defer(),c=this;return q("get_shuffle").then(function(a){c.shuffle=a,b.resolve(a)}),b.promise},h.prototype.next=function(b){a.defer();return b=_.filter(b,function(a){return a.track.name.indexOf("[unplayable]")<0}),q("add_play_next",{tracks:b})},h.prototype.add=function(b){var c=this,d=a.defer();return b=_.filter(b,function(a){return a.track.name.indexOf("[unplayable]")<0}),q("add_to_queue",{tracks:b}).then(function(a){c.version=a.version,d.resolve(a)}),d.promise},h.prototype.addToPlaylist=function(b){var c=this,d=a.defer();return b=_.filter(b,function(a){return a.track.name.indexOf("[unplayable]")<0}),q("add_to_playlist",{tracks:b}).then(function(a){c.version=a.version,d.resolve(a)}),d.promise},h.prototype.remove=function(b){var c=this,d=a.defer();return q("remove_from_tracklist",{tlids:b}).then(function(a){c.version=a.version,d.resolve(a)}),d.promise},h.prototype.replace=function(b){var c=this,d=a.defer();return b=angular.extend({queue:[],playlist:[]},b),b.playlist=_.filter(b.playlist,function(a){return a.track.name.indexOf("[unplayable]")<0}),b.queue=_.filter(b.queue,function(a){return a.track.name.indexOf("[unplayable]")<0}),q("replace_all",b).then(function(a){c.version=a.version,d.resolve(a)}),d.promise},h.prototype.setPlaylist=function(b){a.defer();return b=_.filter(b,function(a){return a.track.name.indexOf("[unplayable]")<0}),q("set_playlist",{tracks:b})},h.prototype.setShuffle=function(b,c){var d,e=this,f=(a.defer(),b?"shuffle_playlist":"shuffle_reset");return d=void 0===c?{}:{tracks:c},e.shuffle=b,q(f,d)},new h}]),angular.module("mopify.services.servicemanager",["LocalStorageModule","mopify.services.settings"]).factory("ServiceManager",["$rootScope","$window","localStorageService","Settings",function(a,b,c,d){function e(){this.availableServices=[{name:"Spotify",description:"Search and manage playlists and get the latests charts",image:"./assets/images/spotify-icon.png",hasSettings:!0,defaultSettings:{loadspotifyplaylists:!0}},{name:"Sync",description:"Sync the settings and authorization tokens with every Mopify client within your network.",image:"./assets/images/sync-icon.png",hasSettings:!0}],this.initializeSavedObject()}return e.prototype.initializeSavedObject=function(){var a=this,b=c.get("services");null===b&&(b={});for(var d=0;d<a.availableServices.length;d++){var e=a.availableServices[d],f=e.name.replace(" ","").toLowerCase();void 0===b[f]&&(b[f]=!1)}c.set("services",b)},e.prototype.getAvailableServices=function(){return this.availableServices},e.prototype.getEnabledServices=function(){return c.get("services")},e.prototype.enableService=function(b){"string"==typeof b&&(b=_.findWhere(this.availableServices,{name:b}));var e=b.name.replace(" ","").toLowerCase(),f=c.get("services");f[e]=!0,c.set("services",f),a.$broadcast("mopify:services:enabled",b),null!=b.defaultSettings&&d.set(e,b.defaultSettings)},e.prototype.disableService=function(b){var d=b.name.replace(" ","").toLowerCase(),e=c.get("services");e[d]=!1,c.set("services",e),a.$broadcast("mopify:services:disabled",b)},e.prototype.isEnabled=function(a){var b="string"==typeof a?a.replace(" ","").toLowerCase():a.name.replace(" ","").toLowerCase();return c.get("services")[b]},new e}]),angular.module("mopify.services.settings",["LocalStorageModule"]).factory("Settings",["localStorageService",function(a){function b(){null===a.get(c)&&a.set(c,{})}var c="settings";return b.prototype.bind=function(b){a.bind(b,c)},b.prototype.get=function(b,d){return null!=a.get(c)&&null!=a.get(c)[b]&&""!==a.get(c)[b]?a.get(c)[b]:d},b.prototype.set=function(b,d,e){e=void 0===e;var f=a.get(c);null!=f[b]&&!0===e&&(d=angular.extend(f[b],d)),f[b]=d,a.set(c,f)},new b}]),angular.module("mopify.services.spotifylogin",["spotify","mopify.services.servicemanager","mopify.services.versionmanager","LocalStorageModule","mopify.services.util"]).factory("SpotifyLogin",["$q","$rootScope","$timeout","$document","$http","Spotify","$interval","ServiceManager","localStorageService","VersionManager","util",function(a,b,c,d,e,f,g,h,i,j,k){function l(a){n=document.createElement("iframe"),n.setAttribute("src","https://bitlabs.nl/mopify/auth/"+a+"/frame/#"+window.location.host),n.style.width="1px",n.style.height="1px",o.append(n)}function m(){this.frame=n,this.connected=!1,this.lastPositiveLoginCheck=0,null!=i.get(p)?(this.refresh_token=i.get(p).refresh_token,this.expires=i.get(p).expires_in,this.access_token=i.get(p).access_token,this.user=i.get(p).user,this.mopifyversion=i.get(p).mopifyversion):(this.refresh_token=null,this.expires=null,this.access_token=null,this.user=null,this.mopifyversion=j.version),this.getLoginStatus().then(function(a){b.$broadcast("mopify:spotify:"+a.status.replace(" ",""))}),this.checkTokens(),this.checkOldToken()}var n,o=d.find("body").eq(0);l("spotify");var p="spotify-auth";f.login=function(){var a=400,b=500,c=window.innerWidth/2-a/2,d=window.innerHeight/2-b/2,e={client_id:this.clientId,redirect_uri:this.redirectUri,scope:this.scope||"",response_type:"code"};window.open("https://accounts.spotify.com/authorize?"+this.toQueryString(e),"Spotify","menubar=no,location=no,resizable=yes,scrollbars=yes,status=no,width="+a+",height="+b+",top="+d+",left="+c)},m.prototype.checkTokens=function(){var a=this;(null===this.expires||void 0===this.expires||Date.now()>=this.expires)&&h.isEnabled("spotify")&&(null!=this.refresh_token?this.refresh():this.login(!0)),c(function(){a.checkTokens()},3e4)},m.prototype.getLoginStatus=function(){var b=this,c=a.defer();if(!0!==h.isEnabled("spotify"))c.reject();else if(null===i.get(p))c.resolve({status:"not connected"});else if(Date.now()-b.lastPositiveLoginCheck>6e5){var d=i.get(p).access_token;f.setAuthToken(d),f.getCurrentUser().then(function(a){var d=a.data;c.resolve({status:"connected"}),b.connected=!0,b.user=d,b.lastPositiveLoginCheck=Date.now()},function(a){401==a.error.status&&(b.connected=!1,c.resolve({status:"not connected"}))})}else c.resolve({status:"connected"});return c.promise},m.prototype.refresh=function(){var b=a.defer(),c=this;if(void 0===this.refresh_token)b.reject();else{var d={refresh_token:this.refresh_token,callback:"JSON_CALLBACK"};e({method:"JSONP",url:"https://bitlabs.nl/mopify/auth/spotify/refresh/",params:d}).success(function(a){c.access_token=a.access_token,c.expires=Date.now()+1e3*a.expires_in,f.setAuthToken(a.access_token),i.set(p,{access_token:c.access_token,refresh_token:c.refresh_token,expires_in:c.expires,mopifyversion:j.version}),b.resolve(a.response)})}return b.promise},m.prototype.checkOldToken=function(){var a="1.6.0",b=k.versionCompare(a,this.mopifyversion);1!==b&&!1!==b||!h.isEnabled("spotify")||(this.disconnect(),this.login(!0))},m.prototype.login=function(c){var d=this,e=a.defer();return!0!==h.isEnabled("spotify")&&e.reject(),!0!==c&&null!=this.refresh_token?this.refresh().then(function(){f.getCurrentUser().then(function(a){d.connected=!0,b.$broadcast("mopify:spotify:connected"),d.user=a.data},function(){d.login(!0)})}):(f.login(),d.requestKey().then(function(){null!=d.access_token?(f.setAuthToken(d.access_token),f.getCurrentUser().then(function(a){var b=a.data;d.connected=!0,d.user=b;var c={access_token:d.access_token,refresh_token:d.refresh_token,expires:d.expires,user:d.user,mopifyversion:j.version};i.set(p,c),e.resolve(d.access_token)},function(a){401==a.error.status&&(d.connected=!1,e.reject())})):e.reject()})),e.promise},m.prototype.disconnect=function(){i.remove(p),f.setAuthToken(""),this.access_token=null,this.refresh_token=null,n.contentWindow.postMessage(JSON.stringify({method:"remove"}),"*"),this.connected=!1},m.prototype.requestKey=function(b){var d=this;b=b||a.defer();var e={method:"get"};return n.contentWindow.postMessage(JSON.stringify(e),"*"),null!=d.access_token?b.resolve():c(function(){d.requestKey(b)},1e3),b.promise};var q=new m;return window.addEventListener("message",function(a){if("https://bitlabs.nl"==a.origin){var b=a.data;if("spotify"==b.service&&null!=b.key){var c=JSON.parse(b.key);q.refresh_token=c.refresh_token,q.access_token=c.access_token,q.expires=Date.now()+36e5,n.contentWindow.postMessage(JSON.stringify({method:"remove"}),"*")}}}),q}]).factory("SpotifyAuthenticationIntercepter",["$q","$rootScope","$injector",function(a,b,c){var d=0,e=!1;return{responseError:function(f){return 401===f.status&&"https://api.spotify.com/v1/me"==f.config.url?(d++,d>=3&&!e&&(e=!0,c.get("SpotifyLogin").login().then(function(){c.get("SpotifyLogin").getLoginStatus().then(function(a){return b.$broadcast("mopify:spotify:connected"),f})})),a.reject(f)):f}}}]),angular.module("mopify.services.station",["llNotifier","mopify.services.mopidy","mopify.services.util","mopify.services.spotifylogin","mopify.services.servicemanager","spotify"]).factory("stationservice",["$rootScope","$q","$timeout","mopidyservice","Spotify","localStorageService","util","SpotifyLogin","notifier","ServiceManager",function(a,b,c,d,e,f,g,h,i,j){function k(a,e){var f=b.defer(),g=25;e||(e=0);var h=a.slice(e,g);if(h.length>0){var i=_.map(h,function(a){return a.uri});d.addToPlaylist({uris:i}).then(function(b){c(function(){k(a,e+g)},2e3),f.resolve(b)})}return f.promise}function l(a){var b={limit:100};return"artist"==a.type&&(b.seed_artists=[a.spotify.id]),"track"==a.type&&(b.seed_tracks=[a.spotify.id]),"tracks"==a.type&&(b.seed_tracks=m(a.tracks)),"album"!=a.type&&"user"!=a.type||(b.seed_tracks=m(a.spotify.tracks)),b}function m(a){var b=a.items||a;b=g.shuffleArray(b),a=b.splice(0,4);for(var c=[],d=0;d<a.length;d++){var e=a[d].uri||a[d].track.uri;c.push(e.replace("spotify:track:",""))}return c}function n(a){if(!j.isEnabled("spotify"))return void i.notify({type:"custom",template:"Please enable the Spotify service first.",delay:7500});var b=l(a);e.getRecommendations(b).then(function(a){d.clearTracklist().then(function(){k(a.data.tracks).then(function(){d.playTrackAtIndex(0)})})})}function o(a){var c=a.split(":"),d=b.defer();switch(c[1]){case"artist":e.getArtist(c[2]).then(function(a){d.resolve(a.data)});break;case"track":e.getTrack(c[2]).then(function(a){d.resolve(a.data)});break;case"album":e.getAlbum(c[2]).then(function(a){d.resolve(a.data)});break;case"user":j.isEnabled("spotify")?e.getPlaylist(c[2],c[4]).then(function(a){var b=a.data,c="";void 0===b.images?c=b.album.images[1].url:null!=b.images[1]?c=b.images[1].url:null!=b.images[0]&&(c=b.images[0].url),b.images=[c,c],d.resolve(b)}):i.notify({type:"custom",template:"Please connect your Spotify account to start a station from a Spotify user's playlist",delay:7500})}return d.promise}return{init:function(){},start:function(a){n(a)},startFromSpotifyUri:function(a){var c=a.split(":"),d=b.defer();return o(a).then(function(a){var b="";void 0===a.images?b=a.album.images[1].url:null!=a.images[1]?b=a.images[1].url:null!=a.images[0]&&(b=a.images[0].url);var e={type:c[1],spotify:a,name:a.name,coverImage:b,started_at:Date.now()},g=f.get("stations")||[];g.push(e),f.set("stations",g),n(e),d.resolve(e)}),d.promise},startFromSpotify:function(){return e.getUserTopTracks({limit:5}).then(function(a){var b={type:"tracks",spotify:null,tracks:a.data.items,name:"Personal",coverImage:"./assets/images/tracklist-header.jpg",started_at:Date.now()},c=f.get("stations")||[];c.push(b),f.set("stations",c),n(b)})},startFromTracks:function(a){var b={type:"tracks",spotify:null,tracks:a,name:"Tracklist",coverImage:"./assets/images/tracklist-header.jpg",started_at:Date.now()},c=f.get("stations")||[];c.push(b),f.set("stations",c),n(b)}}}]),angular.module("mopify.services.sync",["LocalStorageModule","mopify.services.settings","mopify.services.servicemanager","mopify.services.spotifylogin"]).factory("Sync",["$http","$q","$location","localStorageService","Settings","ServiceManager","SpotifyLogin",function(a,b,c,d,e,f,g){function h(){n("spotify").then(function(a){"object"==typeof a&&(g.access_token=a.access_token,g.refresh_token=a.refresh_token,e.set("sync",{spotify:!0}),f.enableService("Spotify"))})}function i(){var a=d.get("syncclient");if(null===a){var b=Date.now()*Math.floor(50*Math.random())+1;this.client={id:b,name:b},d.set("syncclient",this.client),this.registerClient()}else this.client=a;this.checkForceSynchronisation()}var j=e.get("mopidyip",c.host()),k=e.get("mopidyport",c.port()),l=c.protocol()+"://"+j+":"+k+"/mopify/sync/",m=function(c,d){var e=b.defer();return a({method:"POST",url:l+c,params:null!=d?d:{}}).success(function(a){e.resolve(a.response)}),e.promise},n=function(c,d){var e=b.defer();return a({method:"GET",url:l+c,params:null!=d?d:{}}).success(function(a){e.resolve(a.response)}),e.promise};return i.prototype.checkForceSynchronisation=function(){n("settings").then(function(a){"true"===a.forcesync&&(e.set("sync",{force:!0}),f.enableService("Sync"),h())})},i.prototype.updateClient=function(a){this.client=angular.extend(a,this.client),m("clients",{client_id:this.client.id,name:this.client.name}),d.set("syncclient",this.client)},i.prototype.registerClient=function(){return m("clients",{client_id:this.client.id,name:this.client.name})},i.prototype.listClients=function(){return n("clients")},i.prototype.getSpotify=function(){return n("spotify")},i.prototype.setSpotify=function(a){return a.client_id=this.client.id,m("spotify",a)},i.prototype.getSettings=function(){return n("settings")},i.prototype.setSettings=function(a){return m("settings",a)},new i}]),angular.module(["mopify.services.util"],[]).factory("util",["$window",function(a){return{timeFromMilliSeconds:function(a){if(void 0===a)return"";var b=Number(a/1e3),c=Math.floor(b/3600),d=Math.floor(b%3600/60),e=Math.floor(b%3600%60);return(c>0?c+":":"")+(d>0?(c>0&&d<10?"0":"")+d+":":"0:")+(e<10?"0":"")+e},artistsToString:function(a,b){if(null!=a){return a.map(function(a){return b?"<a href='#/music/artist/"+a.uri+"'>"+a.name+"</a>":a.name}).join(", ")}return""},shuffleArray:function(a){for(var b,c,d=a.length;d;b=Math.floor(Math.random()*d),c=a[--d],a[d]=a[b],a[b]=c);return a},versionCompare:function(a,b){if(typeof a+typeof b!="stringstring")return!1;for(var c=a.split("."),d=b.split("."),e=0,f=Math.max(c.length,d.length);e<f;e++){if(c[e]&&!d[e]&&parseInt(c[e])>0||parseInt(c[e])>parseInt(d[e]))return 1;if(d[e]&&!c[e]&&parseInt(d[e])>0||parseInt(c[e])<parseInt(d[e]))return-1}return 0}}}]),angular.module("mopify").filter("reverse",function(){return function(a){if(null!=a)return a.slice().reverse()}}),angular.module("mopify.services.versionmanager",["LocalStorageModule","mopify.services.util"]).factory("VersionManager",["$window","$q","$rootScope","$http","util","localStorageService",function(a,b,c,d,e,f){function g(){var a=this,b=h("version");this.version=b,this.newVersion=!1,null===f.get("versionmanager")&&f.set("versionmanager",{lastversion:0,lastcheck:0}),this.checkVersion().then(function(b){e.versionCompare(b,a.version)>0&&(a.newVersion=!0,c.$broadcast("mopify:version:new",b)),a.lastversion=b})}function h(b){for(var c=a.document.getElementsByTagName("meta"),d=0;d<c.length;d++)if(c[d].getAttribute("name")==b)return c[d].getAttribute("content");return""}return g.prototype.checkVersion=function(){var a=b.defer(),c=this,g=f.get("versionmanager");return Date.now()-g.lastcheck>36e5?d.get("https://api.github.com/repos/dirkgroenen/mopidy-mopify/releases").success(function(b){if(null!=b[0]){var d=b[0].tag_name,h=b[0].body;g.lastversion=d,g.lastcheck=Date.now(),g.changelog=h,f.set("versionmanager",g),e.versionCompare(d,c.version)>0&&(c.newVersion=!0),a.resolve(d)}}):a.resolve(g.lastversion),a.promise},g.prototype.getChangelog=function(){return f.get("versionmanager").changelog},new g}]),angular.module("cgPrompt",["ui.bootstrap"]),angular.module("cgPrompt").factory("prompt",["$modal","$q",function(a,b){return function(c){var d={title:"",message:"",input:!1,label:"",value:"",values:!1,buttons:[{label:"Cancel",cancel:!0},{label:"OK",primary:!0}]};void 0===c&&(c={});for(var e in d)void 0===c[e]&&(c[e]=d[e]);var f=b.defer();return a.open({templateUrl:"angular-prompt.html",controller:"cgPromptCtrl",resolve:{options:function(){return c}}}).result.then(function(a){c.input?f.resolve(a.input):f.resolve(a.button)},function(){f.reject()}),f.promise}}]),angular.module("cgPrompt").controller("cgPromptCtrl",["$scope","options","$timeout",function(a,b,c){a.input={name:b.value},a.options=b,a.buttonClicked=function(c){return c.cancel?void a.$dismiss():b.input&&angular.element(document.querySelector("#cgPromptForm")).scope().cgPromptForm.$invalid?void(a.changed=!0):void a.$close({button:c,input:a.input.name})},a.submit=function(){var b;angular.forEach(a.options.buttons,function(a){a.primary&&(b=a)}),b&&a.buttonClicked(b)},c(function(){var a=document.querySelector("#cgPromptInput");a&&(a.select&&a.select(),a.focus&&a.focus())},100)}]),angular.module("cgPrompt").run(["$templateCache",function(a){"use strict";a.put("angular-prompt.html",'<div>\n    <div class="modal-header">\n        <button type="button" class="close pull-right" ng-click="$dismiss()" aria-hidden="true">Ã—</button>\n        <h4 class="modal-title">{{options.title}}</h4>\n    </div>\n    <div class="modal-body">\n\n        <p ng-if="options.message">\n            {{options.message}}\n        </p>\n\n        <form id="cgPromptForm" name="cgPromptForm" ng-if="options.input" ng-submit="submit()">\n            <div class="form-group" ng-class="{\'has-error\':cgPromptForm.$invalid && changed}">\n                <label for="cgPromptInput">{{options.label}}</label>\n                <input id="cgPromptInput" type="text" class="form-control"  placeholder="{{options.label}}" ng-model="input.name" required ng-change="changed=true" ng-if="!options.values || options.values.length === 0"/ autofocus="autofocus">\n                <div class="input-group" ng-if="options.values">\n                    <input id="cgPromptInput" type="text" class="form-control" placeholder="{{options.label}}" ng-model="input.name" required ng-change="changed=true" autofocus="autofocus"/>\n\n                    <div class="input-group-btn" dropdown>\n                        <button type="button" class="btn btn-default dropdown-toggle" dropdown-toggle data-toggle="dropdown"><span class="caret"></span></button>\n                        <ul class="dropdown-menu pull-right">\n                            <li ng-repeat="value in options.values"><a href="" ng-click="input.name = value">{{value}}</a></li>\n                        </ul>\n                    </div>\n                </div>\n            </div>\n         </form>\n\n    </div>\n    <div class="modal-footer">\n        <button ng-repeat="button in options.buttons track by button.label" class="btn btn-default {{button.class}}" ng-class="{\'btn-primary\':button.primary}" ng-click="buttonClicked(button)">{{button.label}}</button>\n    </div>\n</div>')}]),function(a,b,c){"use strict";b.module("spotify",[]).provider("Spotify",function(){var c={};c.clientId=null,c.redirectUri=null,c.scope=null,c.authToken=null,this.setClientId=function(a){return c.clientId=a,c.clientId},this.getClientId=function(){return c.clientId},this.setAuthToken=function(a){return c.authToken=a,c.authToken},this.setRedirectUri=function(a){return c.redirectUri=a,c.redirectUri},this.getRedirectUri=function(){return c.redirectUri},this.setScope=function(a){return c.scope=a,c.scope};var d={};d.toQueryString=function(a){var c=[];return b.forEach(a,function(a,b){this.push(encodeURIComponent(b)+"="+encodeURIComponent(a))},c),c.join("&")},c.apiBase="https://api.spotify.com/v1",this.$get=["$q","$http","$window",function(e,f,g){function h(){this.clientId=c.clientId,this.redirectUri=c.redirectUri,this.apiBase=c.apiBase,this.scope=c.scope,this.authToken=c.authToken,this.toQueryString=d.toQueryString}function i(b,c,d,e){var f=a.open(b,c,d),g=a.setInterval(function(){try{f&&!f.closed||(a.clearInterval(g),e(f))}catch(a){}},1e3);return f}return h.prototype={api:function(a,b,c,d,g){var h=e.defer();return f({url:this.apiBase+a,method:b||"GET",params:c,data:d,headers:g,withCredentials:!1}).then(function(a){h.resolve(a)}).catch(function(a){h.reject(a)}),h.promise},_auth:function(a){var b={Authorization:"Bearer "+this.authToken};return a&&(b["Content-Type"]="application/json"),b},getAlbum:function(a){return a=-1===a.indexOf("spotify:")?a:a.split(":")[2],this.api("/albums/"+a,"GET",null,null,this._auth())},getAlbums:function(a){return a=b.isString(a)?a.split(","):a,b.forEach(a,function(b,c){a[c]=b.indexOf("spotify:")>-1?b.split(":")[2]:b}),this.api("/albums","GET",{ids:a?a.toString():""},null,this._auth())},getAlbumTracks:function(a,b){return a=-1===a.indexOf("spotify:")?a:a.split(":")[2],this.api("/albums/"+a+"/tracks","GET",b,null,this._auth())},getArtist:function(a){return a=-1===a.indexOf("spotify:")?a:a.split(":")[2],this.api("/artists/"+a,"GET",null,null,this._auth())},getArtists:function(a){return a=b.isString(a)?a.split(","):a,b.forEach(a,function(b,c){a[c]=b.indexOf("spotify:")>-1?b.split(":")[2]:b}),this.api("/artists/","GET",{ids:a?a.toString():""},null,this._auth())},getArtistAlbums:function(a,b){return a=-1===a.indexOf("spotify:")?a:a.split(":")[2],this.api("/artists/"+a+"/albums","GET",b,null,this._auth())},getArtistTopTracks:function(a,b){return a=-1===a.indexOf("spotify:")?a:a.split(":")[2],this.api("/artists/"+a+"/top-tracks","GET",{country:b},null,this._auth())},getRelatedArtists:function(a){return a=-1===a.indexOf("spotify:")?a:a.split(":")[2],this.api("/artists/"+a+"/related-artists","GET",null,null,this._auth())},getFeaturedPlaylists:function(a){return this.api("/browse/featured-playlists","GET",a,null,this._auth())},getNewReleases:function(a){return this.api("/browse/new-releases","GET",a,null,this._auth())},getCategories:function(a){return this.api("/browse/categories","GET",a,null,this._auth())},getCategory:function(a,b){return this.api("/browse/categories/"+a,"GET",b,null,this._auth())},getCategoryPlaylists:function(a,b){return this.api("/browse/categories/"+a+"/playlists","GET",b,null,this._auth())},getRecommendations:function(a){return this.api("/recommendations","GET",a,null,this._auth())},getAvailableGenreSeeds:function(){return this.api("/recommendations/available-genre-seeds","GET",null,null,this._auth())},following:function(a,b){return b=b||{},b.type=a,this.api("/me/following","GET",b,null,this._auth())},follow:function(a,b){return this.api("/me/following","PUT",{type:a,ids:b},null,this._auth())},unfollow:function(a,b){return this.api("/me/following","DELETE",{
type:a,ids:b},null,this._auth())},userFollowingContains:function(a,b){return this.api("/me/following/contains","GET",{type:a,ids:b},null,this._auth())},followPlaylist:function(a,b,c){return this.api("/users/"+a+"/playlists/"+b+"/followers","PUT",null,{public:c||null},this._auth(!0))},unfollowPlaylist:function(a,b){return this.api("/users/"+a+"/playlists/"+b+"/followers","DELETE",null,null,this._auth())},playlistFollowingContains:function(a,b,c){return this.api("/users/"+a+"/playlists/"+b+"/followers/contains","GET",{ids:c.toString()},null,this._auth())},getSavedUserTracks:function(a){return this.api("/me/tracks","GET",a,null,this._auth())},userTracksContains:function(a){return a=b.isString(a)?a.split(","):a,b.forEach(a,function(b,c){a[c]=b.indexOf("spotify:")>-1?b.split(":")[2]:b}),this.api("/me/tracks/contains","GET",{ids:a.toString()},null,this._auth())},saveUserTracks:function(a){return a=b.isString(a)?a.split(","):a,b.forEach(a,function(b,c){a[c]=b.indexOf("spotify:")>-1?b.split(":")[2]:b}),this.api("/me/tracks","PUT",{ids:a.toString()},null,this._auth())},removeUserTracks:function(a){return a=b.isString(a)?a.split(","):a,b.forEach(a,function(b,c){a[c]=b.indexOf("spotify:")>-1?b.split(":")[2]:b}),this.api("/me/tracks","DELETE",{ids:a.toString()},null,this._auth(!0))},saveUserAlbums:function(a){return a=b.isString(a)?a.split(","):a,b.forEach(a,function(b,c){a[c]=b.indexOf("spotify:")>-1?b.split(":")[2]:b}),this.api("/me/albums","PUT",{ids:a.toString()},null,this._auth())},getSavedUserAlbums:function(a){return this.api("/me/albums","GET",a,null,this._auth())},removeUserAlbums:function(a){return a=b.isString(a)?a.split(","):a,b.forEach(a,function(b,c){a[c]=b.indexOf("spotify:")>-1?b.split(":")[2]:b}),this.api("/me/albums","DELETE",{ids:a.toString()},null,this._auth(!0))},userAlbumsContains:function(a){return a=b.isString(a)?a.split(","):a,b.forEach(a,function(b,c){a[c]=b.indexOf("spotify:")>-1?b.split(":")[2]:b}),this.api("/me/albums/contains","GET",{ids:a.toString()},null,this._auth())},getUserTopArtists:function(a){return a=a||{},this.api("/me/top/artists","GET",a,null,this._auth())},getUserTopTracks:function(a){return a=a||{},this.api("/me/top/tracks","GET",a,null,this._auth())},getUserPlaylists:function(a,b){return this.api("/users/"+a+"/playlists","GET",b,null,this._auth())},getPlaylist:function(a,b,c){return this.api("/users/"+a+"/playlists/"+b,"GET",c,null,this._auth())},getPlaylistTracks:function(a,b,c){return this.api("/users/"+a+"/playlists/"+b+"/tracks","GET",c,null,this._auth())},createPlaylist:function(a,b){return this.api("/users/"+a+"/playlists","POST",null,b,this._auth(!0))},addPlaylistTracks:function(a,c,d,e){return d=b.isArray(d)?d:d.split(","),b.forEach(d,function(a,b){d[b]=-1===a.indexOf("spotify:")?"spotify:track:"+a:a}),this.api("/users/"+a+"/playlists/"+c+"/tracks","POST",{uris:d.toString(),position:e?e.position:null},null,this._auth(!0))},removePlaylistTracks:function(a,c,d){d=b.isArray(d)?d:d.split(",");var e;return b.forEach(d,function(a,b){e=d[b],d[b]={uri:-1===e.indexOf("spotify:")?"spotify:track:"+e:e}}),this.api("/users/"+a+"/playlists/"+c+"/tracks","DELETE",null,{tracks:d},this._auth(!0))},reorderPlaylistTracks:function(a,b,c){return this.api("/users/"+a+"/playlists/"+b+"/tracks","PUT",null,c,this._auth(!0))},replacePlaylistTracks:function(a,c,d){d=b.isArray(d)?d:d.split(",");var e;return b.forEach(d,function(a,b){e=d[b],d[b]=-1===e.indexOf("spotify:")?"spotify:track:"+e:e}),this.api("/users/"+a+"/playlists/"+c+"/tracks","PUT",{uris:d.toString()},null,this._auth(!0))},updatePlaylistDetails:function(a,b,c){return this.api("/users/"+a+"/playlists/"+b,"PUT",null,c,this._auth(!0))},getUser:function(a){return this.api("/users/"+a,"GET",null,null,this._auth())},getCurrentUser:function(){return this.api("/me","GET",null,null,this._auth())},search:function(a,b,c){return c=c||{},c.q=a,c.type=b,this.api("/search","GET",c,null,this._auth())},getTrack:function(a){return a=-1===a.indexOf("spotify:")?a:a.split(":")[2],this.api("/tracks/"+a,"GET",null,null,this._auth())},getTracks:function(a){return a=b.isString(a)?a.split(","):a,b.forEach(a,function(b,c){a[c]=b.indexOf("spotify:")>-1?b.split(":")[2]:b}),this.api("/tracks/","GET",{ids:a?a.toString():""},null,this._auth())},getTrackAudioFeatures:function(a){return a=-1===a.indexOf("spotify:")?a:a.split(":")[2],this.api("/audio-features/"+a,"GET",null,null,this._auth())},getTracksAudioFeatures:function(a){return a=b.isString(a)?a.split(","):a,b.forEach(a,function(b,c){a[c]=b.indexOf("spotify:")>-1?b.split(":")[2]:b}),this.api("/audio-features/","GET",{ids:a?a.toString():""},null,this._auth())},setAuthToken:function(a){return this.authToken=a,this.authToken},login:function(){function a(d){"spotify-token"===d.key&&(m&&m.close(),l=!0,c.setAuthToken(d.newValue),g.removeEventListener("storage",a,!1),b.resolve(d.newValue))}var b=e.defer(),c=this,d=400,f=500,h=screen.width/2-d/2,j=screen.height/2-f/2,k={client_id:this.clientId,redirect_uri:this.redirectUri,scope:this.scope||"",response_type:"token"},l=!1,m=i("https://accounts.spotify.com/authorize?"+this.toQueryString(k),"Spotify","menubar=no,location=no,resizable=yes,scrollbars=yes,status=no,width="+d+",height="+f+",top="+j+",left="+h,function(){l||b.reject()});return g.addEventListener("storage",a,!1),b.promise}},new h}]})}(window,angular),function(a){if("object"==typeof exports)module.exports=a();else if("function"==typeof define&&define.amd)define(a);else{var b;"undefined"!=typeof window?b=window:"undefined"!=typeof global?b=global:"undefined"!=typeof self&&(b=self),b.Mopidy=a()}}(function(){var a;return function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);throw new Error("Cannot find module '"+g+"'")}var j=c[g]={exports:{}};b[g][0].call(j.exports,function(a){var c=b[g][1][a];return e(c||a)},j,j.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){b.exports={Client:window.WebSocket}},{}],2:[function(b,c,d){("function"==typeof a&&a.amd&&function(b){a("bane",b)}||"object"==typeof c&&function(a){c.exports=a()}||function(a){this.bane=a()})(function(){"use strict";function a(a,b,c){var d,e=c.length;if(e>0)for(d=0;d<e;++d)c[d](a,b);else setTimeout(function(){throw b.message=a+" listener threw error: "+b.message,b},0)}function b(a){if("function"!=typeof a)throw new TypeError("Listener is not function");return a}function c(a){return a.supervisors||(a.supervisors=[]),a.supervisors}function d(a,b){return a.listeners||(a.listeners={}),b&&!a.listeners[b]&&(a.listeners[b]=[]),b?a.listeners[b]:a.listeners}function e(a){return a.errbacks||(a.errbacks=[]),a.errbacks}function f(f){function h(b,c,d){try{c.listener.apply(c.thisp||f,d)}catch(c){a(b,c,e(f))}}return f=f||{},f.on=function(a,e,f){if("function"==typeof a)return c(this).push({listener:a,thisp:e});d(this,a).push({listener:b(e),thisp:f})},f.off=function(a,b){var f,g,h,i;if(!a){f=c(this),f.splice(0,f.length),g=d(this);for(h in g)g.hasOwnProperty(h)&&(f=d(this,h),f.splice(0,f.length));return f=e(this),void f.splice(0,f.length)}if("function"==typeof a?(f=c(this),b=a):f=d(this,a),!b)return void f.splice(0,f.length);for(h=0,i=f.length;h<i;++h)if(f[h].listener===b)return void f.splice(h,1)},f.once=function(a,b,c){var d=function(){f.off(a,d),b.apply(this,arguments)};f.on(a,d,c)},f.bind=function(a,b){var c,d,e;if(b)for(d=0,e=b.length;d<e;++d){if("function"!=typeof a[b[d]])throw new Error("No such method "+b[d]);this.on(b[d],a[b[d]],a)}else for(c in a)"function"==typeof a[c]&&this.on(c,a[c],a);return a},f.emit=function(a){var b,e,f=c(this),i=g.call(arguments);for(b=0,e=f.length;b<e;++b)h(a,f[b],i);for(f=d(this,a).slice(),i=g.call(arguments,1),b=0,e=f.length;b<e;++b)h(a,f[b],i)},f.errback=function(a){this.errbacks||(this.errbacks=[]),this.errbacks.push(b(a))},f}var g=Array.prototype.slice;return{createEventEmitter:f,aggregate:function(a){var b=f();return a.forEach(function(a){a.on(function(a,c){b.emit(a,c)})}),b}}})},{}],3:[function(a,b,c){function d(){}var e=b.exports={};e.nextTick=function(){var a="undefined"!=typeof window&&window.setImmediate,b="undefined"!=typeof window&&window.postMessage&&window.addEventListener;if(a)return function(a){return window.setImmediate(a)};if(b){var c=[];return window.addEventListener("message",function(a){var b=a.source;if((b===window||null===b)&&"process-tick"===a.data&&(a.stopPropagation(),c.length>0)){c.shift()()}},!0),function(a){c.push(a),window.postMessage("process-tick","*")}}return function(a){setTimeout(a,0)}}(),e.title="browser",e.browser=!0,e.env={},e.argv=[],e.on=d,e.addListener=d,e.once=d,e.off=d,e.removeListener=d,e.removeAllListeners=d,e.emit=d,e.binding=function(a){throw new Error("process.binding is not supported")},e.cwd=function(){return"/"},e.chdir=function(a){throw new Error("process.chdir is not supported")}},{}],4:[function(b,c,d){!function(a){"use strict";a(function(a){return a("./makePromise")({scheduler:new(a("./Scheduler"))(a("./env").asap)})})}("function"==typeof a&&a.amd?a:function(a){c.exports=a(b)})},{"./Scheduler":5,"./env":17,"./makePromise":19}],5:[function(b,c,d){!function(a){"use strict";a(function(){function a(a){this._async=a,this._running=!1,this._queue=this,this._queueLen=0,this._afterQueue={},this._afterQueueLen=0;var b=this;this.drain=function(){b._drain()}}return a.prototype.enqueue=function(a){this._queue[this._queueLen++]=a,this.run()},a.prototype.afterQueue=function(a){this._afterQueue[this._afterQueueLen++]=a,this.run()},a.prototype.run=function(){this._running||(this._running=!0,this._async(this.drain))},a.prototype._drain=function(){for(var a=0;a<this._queueLen;++a)this._queue[a].run(),this._queue[a]=void 0;for(this._queueLen=0,this._running=!1,a=0;a<this._afterQueueLen;++a)this._afterQueue[a].run(),this._afterQueue[a]=void 0;this._afterQueueLen=0},a})}("function"==typeof a&&a.amd?a:function(a){c.exports=a()})},{}],6:[function(b,c,d){!function(a){"use strict";a(function(){function a(b){Error.call(this),this.message=b,this.name=a.name,"function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,a)}return a.prototype=Object.create(Error.prototype),a.prototype.constructor=a,a})}("function"==typeof a&&a.amd?a:function(a){c.exports=a()})},{}],7:[function(b,c,d){!function(a){"use strict";a(function(){function a(a,c){function d(b,d,f){var g=a._defer(),h=f.length;return e({f:b,thisArg:d,args:f,params:new Array(h),i:h-1,call:c},g._handler),g}function e(b,d){if(b.i<0)return c(b.f,b.thisArg,b.params,d);a._handler(b.args[b.i]).fold(f,b,void 0,d)}function f(a,b,c){a.params[a.i]=b,a.i-=1,e(a,c)}return arguments.length<2&&(c=b),d}function b(a,b,c,d){try{d.resolve(a.apply(b,c))}catch(a){d.reject(a)}}return a.tryCatchResolve=b,a})}("function"==typeof a&&a.amd?a:function(a){c.exports=a()})},{}],8:[function(b,c,d){!function(a){"use strict";a(function(a){var b=a("../state"),c=a("../apply");return function(a){function d(b){function c(a){k=null,this.resolve(a)}function d(a){this.resolved||(k.push(a),0==--j&&this.reject(k))}for(var e,f,g=a._defer(),h=g._handler,i=b.length>>>0,j=i,k=[],l=0;l<i;++l)if(void 0!==(f=b[l])||l in b){if(e=a._handler(f),e.state()>0){h.become(e),a._visitRemaining(b,l,e);break}e.visit(h,c,d)}else--j;return 0===j&&h.reject(new RangeError("any(): array must not be empty")),g}function e(b,c){function d(a){this.resolved||(k.push(a),0==--n&&(l=null,this.resolve(k)))}function e(a){this.resolved||(l.push(a),0==--f&&(k=null,this.reject(l)))}var f,g,h,i=a._defer(),j=i._handler,k=[],l=[],m=b.length>>>0,n=0;for(h=0;h<m;++h)(void 0!==(g=b[h])||h in b)&&++n;for(c=Math.max(c,0),f=n-c+1,n=Math.min(c,n),c>n?j.reject(new RangeError("some(): array must contain at least "+c+" item(s), but had "+n)):0===n&&j.resolve(k),h=0;h<m;++h)(void 0!==(g=b[h])||h in b)&&a._handler(g).visit(j,d,e,j.notify);return i}function f(b,c){return a._traverse(c,b)}function g(b,c){var d=s.call(b);return a._traverse(c,d).then(function(a){return h(d,a)})}function h(b,c){for(var d=c.length,e=new Array(d),f=0,g=0;f<d;++f)c[f]&&(e[g++]=a._handler(b[f]).value);return e.length=g,e}function i(a){return p(a.map(j))}function j(c){var d=a._handler(c);return 0===d.state()?o(c).then(b.fulfilled,b.rejected):(d._unreport(),b.inspect(d))}function k(a,b){return arguments.length>2?q.call(a,m(b),arguments[2]):q.call(a,m(b))}function l(a,b){return arguments.length>2?r.call(a,m(b),arguments[2]):r.call(a,m(b))}function m(a){return function(b,c,d){return n(a,void 0,[b,c,d])}}var n=c(a),o=a.resolve,p=a.all,q=Array.prototype.reduce,r=Array.prototype.reduceRight,s=Array.prototype.slice;return a.any=d,a.some=e,a.settle=i,a.map=f,a.filter=g,a.reduce=k,a.reduceRight=l,a.prototype.spread=function(a){return this.then(p).then(function(b){return a.apply(this,b)})},a}})}("function"==typeof a&&a.amd?a:function(a){c.exports=a(b)})},{"../apply":7,"../state":20}],9:[function(b,c,d){!function(a){"use strict";a(function(){function a(){throw new TypeError("catch predicate must be a function")}function b(a,b){return c(b)?a instanceof b:b(a)}function c(a){return a===Error||null!=a&&a.prototype instanceof Error}function d(a){return("object"==typeof a||"function"==typeof a)&&null!==a}function e(a){return a}return function(c){function f(a,c){return function(d){return b(d,c)?a.call(this,d):j(d)}}function g(a,b,c,e){var f=a.call(b);return d(f)?h(f,c,e):c(e)}function h(a,b,c){return i(a).then(function(){return b(c)})}var i=c.resolve,j=c.reject,k=c.prototype.catch;return c.prototype.done=function(a,b){this._handler.visit(this._handler.receiver,a,b)},c.prototype.catch=c.prototype.otherwise=function(b){return arguments.length<2?k.call(this,b):"function"!=typeof b?this.ensure(a):k.call(this,f(arguments[1],b))},c.prototype.finally=c.prototype.ensure=function(a){return"function"!=typeof a?this:this.then(function(b){return g(a,this,e,b)},function(b){return g(a,this,j,b)})},c.prototype.else=c.prototype.orElse=function(a){return this.then(void 0,function(){return a})},c.prototype.yield=function(a){return this.then(function(){return a})},c.prototype.tap=function(a){return this.then(a).yield(this)},c}})}("function"==typeof a&&a.amd?a:function(a){c.exports=a()})},{}],10:[function(b,c,d){!function(a){"use strict";a(function(){return function(a){return a.prototype.fold=function(b,c){var d=this._beget();return this._handler.fold(function(c,d,e){a._handler(c).fold(function(a,c,d){d.resolve(b.call(this,c,a))},d,this,e)},c,d._handler.receiver,d._handler),d},a}})}("function"==typeof a&&a.amd?a:function(a){c.exports=a()})},{}],11:[function(b,c,d){!function(a){"use strict";a(function(a){var b=a("../state").inspect;return function(a){return a.prototype.inspect=function(){return b(a._handler(this))},a}})}("function"==typeof a&&a.amd?a:function(a){c.exports=a(b)})},{"../state":20}],12:[function(b,c,d){!function(a){"use strict";a(function(){return function(a){function b(a,b,d,e){return c(function(b){return[b,a(b)]},b,d,e)}function c(a,b,e,f){function g(f,g){return d(e(f)).then(function(){return c(a,b,e,g)})}return d(f).then(function(c){return d(b(c)).then(function(b){return b?c:d(a(c)).spread(g)})})}var d=a.resolve;return a.iterate=b,a.unfold=c,a}})}("function"==typeof a&&a.amd?a:function(a){c.exports=a()})},{}],13:[function(b,c,d){!function(a){"use strict";a(function(){return function(a){return a.prototype.progress=function(a){return this.then(void 0,void 0,a)},a}})}("function"==typeof a&&a.amd?a:function(a){c.exports=a()})},{}],14:[function(b,c,d){!function(a){"use strict";a(function(a){function b(a,b,d,e){return c.setTimer(function(){a(d,e,b)},b)}var c=a("../env"),d=a("../TimeoutError");return function(a){function e(a,c,d){b(f,a,c,d)}function f(a,b){b.resolve(a)}function g(a,b,c){var e=void 0===a?new d("timed out after "+c+"ms"):a;b.reject(e)}return a.prototype.delay=function(a){var b=this._beget();return this._handler.fold(e,a,void 0,b._handler),b},a.prototype.timeout=function(a,d){var e=this._beget(),f=e._handler,h=b(g,a,d,e._handler);return this._handler.visit(f,function(a){c.clearTimer(h),this.resolve(a)},function(a){c.clearTimer(h),this.reject(a)},f.notify),e},a}})}("function"==typeof a&&a.amd?a:function(a){c.exports=a(b)})},{"../TimeoutError":6,"../env":17}],15:[function(b,c,d){!function(a){"use strict";a(function(a){function b(a){throw a}function c(){}var d=a("../env").setTimer,e=a("../format");return function(a){function f(a){a.handled||(n.push(a),k("Potentially unhandled rejection ["+a.id+"] "+e.formatError(a.value)))}function g(a){var b=n.indexOf(a);b>=0&&(n.splice(b,1),l("Handled previous rejection ["+a.id+"] "+e.formatObject(a.value)))}function h(a,b){m.push(a,b),null===o&&(o=d(i,0))}function i(){for(o=null;m.length>0;)m.shift()(m.shift())}var j,k=c,l=c;"undefined"!=typeof console&&(j=console,k=void 0!==j.error?function(a){j.error(a)}:function(a){j.log(a)},l=void 0!==j.info?function(a){j.info(a)}:function(a){j.log(a)}),a.onPotentiallyUnhandledRejection=function(a){h(f,a)},a.onPotentiallyUnhandledRejectionHandled=function(a){h(g,a)},a.onFatalRejection=function(a){h(b,a.value)};var m=[],n=[],o=null;return a}})}("function"==typeof a&&a.amd?a:function(a){c.exports=a(b)})},{"../env":17,"../format":18}],16:[function(b,c,d){!function(a){"use strict";a(function(){return function(a){return a.prototype.with=a.prototype.withThis=function(a){var b=this._beget(),c=b._handler;return c.receiver=a,this._handler.chain(c,a),b},a}})}("function"==typeof a&&a.amd?a:function(a){c.exports=a()})},{}],17:[function(b,c,d){(function(d){!function(a){"use strict";a(function(a){function b(){return void 0!==d&&null!==d&&"function"==typeof d.nextTick}function c(){return"function"==typeof MutationObserver&&MutationObserver||"function"==typeof WebKitMutationObserver&&WebKitMutationObserver}function e(a){function b(){var a=c;c=void 0,a()}var c,d=document.createTextNode("");new a(b).observe(d,{characterData:!0});var e=0;return function(a){c=a,d.data=e^=1}}var f,g="undefined"!=typeof setTimeout&&setTimeout,h=function(a,b){return setTimeout(a,b)},i=function(a){return clearTimeout(a)},j=function(a){return g(a,0)};if(b())j=function(a){return d.nextTick(a)};else if(f=c())j=e(f);else if(!g){var k=a,l=k("vertx");h=function(a,b){return l.setTimer(b,a)},i=l.cancelTimer,j=l.runOnLoop||l.runOnContext}return{setTimer:h,clearTimer:i,asap:j}})}("function"==typeof a&&a.amd?a:function(a){c.exports=a(b)})}).call(this,b("FWaASH"))},{FWaASH:3}],18:[function(b,c,d){!function(a){"use strict";a(function(){function a(a){var c="object"==typeof a&&null!==a&&a.stack?a.stack:b(a);return a instanceof Error?c:c+" (WARNING: non-Error used)"}function b(a){var b=String(a);return"[object Object]"===b&&"undefined"!=typeof JSON&&(b=c(a,b)),b}function c(a,b){try{return JSON.stringify(a)}catch(a){return b}}return{formatError:a,formatObject:b,tryStringify:c}})}("function"==typeof a&&a.amd?a:function(a){c.exports=a()})},{}],19:[function(b,c,d){(function(b){!function(a){"use strict";a(function(){return function(a){function c(a,b){this._handler=a===u?b:d(a)}function d(a){function b(a){e.resolve(a)}function c(a){e.reject(a)}function d(a){e.notify(a)}var e=new w;try{a(b,c,d)}catch(a){c(a)}return e}function e(a){return J(a)?a:new c(u,new x(r(a)))}function f(a){return new c(u,new x(new A(a)))}function g(){return aa}function h(){return new c(u,new w)}function i(a,b){return new b(u,new w(a.receiver,a.join().context))}function j(a){return l(T,null,a)}function k(a,b){return l(O,a,b)}function l(a,b,d){function e(c,e,g){g.resolved||m(d,f,c,a(b,e,c),g)}function f(a,b,c){k[a]=b,0==--j&&c.become(new z(k))}for(var g,h="function"==typeof b?e:f,i=new w,j=d.length>>>0,k=new Array(j),l=0;l<d.length&&!i.resolved;++l)g=d[l],void 0!==g||l in d?m(d,h,l,g,i):--j;return 0===j&&i.become(new z(k)),new c(u,i)}function m(a,b,c,d,e){if(K(d)){var f=s(d),g=f.state();0===g?f.fold(b,c,void 0,e):g>0?b(c,f.value,e):(e.become(f),n(a,c+1,f))}else b(c,d,e)}function n(a,b,c){for(var d=b;d<a.length;++d)o(r(a[d]),c)}function o(a,b){if(a!==b){var c=a.state();0===c?a.visit(a,void 0,a._unreport):c<0&&a._unreport()}}function p(a){return"object"!=typeof a||null===a?f(new TypeError("non-iterable passed to race()")):0===a.length?g():1===a.length?e(a[0]):q(a)}function q(a){var b,d,e,f=new w;for(b=0;b<a.length;++b)if(void 0!==(d=a[b])||b in a){if(e=r(d),0!==e.state()){f.become(e),n(a,b+1,e);break}e.visit(f,f.resolve,f.reject)}return new c(u,f)}function r(a){return J(a)?a._handler.join():K(a)?t(a):new z(a)}function s(a){return J(a)?a._handler.join():t(a)}function t(a){try{var b=a.then;return"function"==typeof b?new y(b,a):new z(a)}catch(a){return new A(a)}}function u(){}function v(){}function w(a,b){c.createContext(this,b),this.consumers=void 0,this.receiver=a,this.handler=void 0,this.resolved=!1}function x(a){this.handler=a}function y(a,b){w.call(this),W.enqueue(new G(a,b,this))}function z(a){c.createContext(this),this.value=a}function A(a){c.createContext(this),this.id=++$,this.value=a,this.handled=!1,this.reported=!1,this._report()}function B(a,b){this.rejection=a,this.context=b}function C(a){this.rejection=a}function D(){return new A(new TypeError("Promise cycle"))}function E(a,b){this.continuation=a,this.handler=b}function F(a,b){this.handler=b,this.value=a}function G(a,b,c){this._then=a,this.thenable=b,this.resolver=c}function H(a,b,c,d,e){try{a.call(b,c,d,e)}catch(a){d(a)}}function I(a,b,c,d){this.f=a,this.z=b,this.c=c,this.to=d,this.resolver=Z,this.receiver=this}function J(a){return a instanceof c}function K(a){return("object"==typeof a||"function"==typeof a)&&null!==a}function L(a,b,d,e){if("function"!=typeof a)return e.become(b);c.enterContext(b),P(a,b.value,d,e),c.exitContext()}function M(a,b,d,e,f){if("function"!=typeof a)return f.become(d);c.enterContext(d),Q(a,b,d.value,e,f),c.exitContext()}function N(a,b,d,e,f){if("function"!=typeof a)return f.notify(b);c.enterContext(d),R(a,b,e,f),c.exitContext()}function O(a,b,c){try{return a(b,c)}catch(a){return f(a)}}function P(a,b,c,d){try{d.become(r(a.call(c,b)))}catch(a){d.become(new A(a))}}function Q(a,b,c,d,e){try{a.call(d,b,c,e)}catch(a){e.become(new A(a))}}function R(a,b,c,d){try{d.notify(a.call(c,b))}catch(a){d.notify(a)}}function S(a,b){b.prototype=Y(a.prototype),b.prototype.constructor=b}function T(a,b){return b}function U(){}function V(){return void 0!==b&&null!==b&&"function"==typeof b.emit?function(a,c){return"unhandledRejection"===a?b.emit(a,c.value,c):b.emit(a,c)}:"undefined"!=typeof self&&"function"==typeof CustomEvent?function(a,b,c){var d=!1;try{d=new c("unhandledRejection")instanceof c}catch(a){}return d?function(a,d){var e=new c(a,{detail:{reason:d.value,key:d},bubbles:!1,cancelable:!0});return!b.dispatchEvent(e)}:a}(U,self,CustomEvent):U}var W=a.scheduler,X=V(),Y=Object.create||function(a){function b(){}return b.prototype=a,new b};c.resolve=e,c.reject=f,c.never=g,c._defer=h,c._handler=r,c.prototype.then=function(a,b,c){var d=this._handler,e=d.join().state();if("function"!=typeof a&&e>0||"function"!=typeof b&&e<0)return new this.constructor(u,d);var f=this._beget(),g=f._handler;return d.chain(g,d.receiver,a,b,c),f},c.prototype.catch=function(a){return this.then(void 0,a)},c.prototype._beget=function(){return i(this._handler,this.constructor)},c.all=j,c.race=p,c._traverse=k,c._visitRemaining=n,u.prototype.when=u.prototype.become=u.prototype.notify=u.prototype.fail=u.prototype._unreport=u.prototype._report=U,u.prototype._state=0,u.prototype.state=function(){return this._state},u.prototype.join=function(){for(var a=this;void 0!==a.handler;)a=a.handler;return a},u.prototype.chain=function(a,b,c,d,e){this.when({resolver:a,receiver:b,fulfilled:c,rejected:d,progress:e})},u.prototype.visit=function(a,b,c,d){this.chain(Z,a,b,c,d)},u.prototype.fold=function(a,b,c,d){this.when(new I(a,b,c,d))},S(u,v),v.prototype.become=function(a){a.fail()};var Z=new v;S(u,w),w.prototype._state=0,w.prototype.resolve=function(a){this.become(r(a))},w.prototype.reject=function(a){this.resolved||this.become(new A(a))},w.prototype.join=function(){if(!this.resolved)return this;for(var a=this;void 0!==a.handler;)if((a=a.handler)===this)return this.handler=D();return a},w.prototype.run=function(){var a=this.consumers,b=this.handler;this.handler=this.handler.join(),this.consumers=void 0;for(var c=0;c<a.length;++c)b.when(a[c])},w.prototype.become=function(a){this.resolved||(this.resolved=!0,this.handler=a,void 0!==this.consumers&&W.enqueue(this),void 0!==this.context&&a._report(this.context))},w.prototype.when=function(a){this.resolved?W.enqueue(new E(a,this.handler)):void 0===this.consumers?this.consumers=[a]:this.consumers.push(a)},w.prototype.notify=function(a){this.resolved||W.enqueue(new F(a,this))},w.prototype.fail=function(a){var b=void 0===a?this.context:a;this.resolved&&this.handler.join().fail(b)},w.prototype._report=function(a){this.resolved&&this.handler.join()._report(a)},w.prototype._unreport=function(){this.resolved&&this.handler.join()._unreport()},S(u,x),x.prototype.when=function(a){W.enqueue(new E(a,this))},x.prototype._report=function(a){this.join()._report(a)},x.prototype._unreport=function(){this.join()._unreport()},S(w,y),S(u,z),z.prototype._state=1,z.prototype.fold=function(a,b,c,d){M(a,b,this,c,d)},z.prototype.when=function(a){L(a.fulfilled,this,a.receiver,a.resolver)};var $=0;S(u,A),A.prototype._state=-1,A.prototype.fold=function(a,b,c,d){d.become(this)},A.prototype.when=function(a){"function"==typeof a.rejected&&this._unreport(),L(a.rejected,this,a.receiver,a.resolver)},A.prototype._report=function(a){W.afterQueue(new B(this,a))},A.prototype._unreport=function(){this.handled||(this.handled=!0,W.afterQueue(new C(this)))},A.prototype.fail=function(a){this.reported=!0,X("unhandledRejection",this),c.onFatalRejection(this,void 0===a?this.context:a)},B.prototype.run=function(){this.rejection.handled||this.rejection.reported||(this.rejection.reported=!0,X("unhandledRejection",this.rejection)||c.onPotentiallyUnhandledRejection(this.rejection,this.context))},C.prototype.run=function(){this.rejection.reported&&(X("rejectionHandled",this.rejection)||c.onPotentiallyUnhandledRejectionHandled(this.rejection))},c.createContext=c.enterContext=c.exitContext=c.onPotentiallyUnhandledRejection=c.onPotentiallyUnhandledRejectionHandled=c.onFatalRejection=U;var _=new u,aa=new c(u,_);return E.prototype.run=function(){this.handler.join().when(this.continuation)},F.prototype.run=function(){var a=this.handler.consumers;if(void 0!==a)for(var b,c=0;c<a.length;++c)b=a[c],N(b.progress,this.value,this.handler,b.receiver,b.resolver)},G.prototype.run=function(){function a(a){d.resolve(a)}function b(a){d.reject(a)}function c(a){d.notify(a)}var d=this.resolver;H(this._then,this.thenable,a,b,c)},I.prototype.fulfilled=function(a){this.f.call(this.c,this.z,a,this.to)},I.prototype.rejected=function(a){this.to.reject(a)},I.prototype.progress=function(a){this.to.notify(a)},c}})}("function"==typeof a&&a.amd?a:function(a){c.exports=a()})}).call(this,b("FWaASH"))},{FWaASH:3}],20:[function(b,c,d){!function(a){"use strict";a(function(){function a(){return{state:"pending"}}function b(a){return{state:"rejected",reason:a}}function c(a){return{state:"fulfilled",value:a}}function d(d){var e=d.state();return 0===e?a():e>0?c(d.value):b(d.value)}return{pending:a,fulfilled:c,rejected:b,inspect:d}})}("function"==typeof a&&a.amd?a:function(a){c.exports=a()})},{}],21:[function(b,c,d){!function(a){"use strict";a(function(a){function b(a,b,c,d){var e=x.resolve(a);return arguments.length<2?e:e.then(b,c,d)}function c(a){return new x(a)}function d(a){return function(){for(var b=0,c=arguments.length,d=new Array(c);b<c;++b)d[b]=arguments[b];return y(a,this,d)}}function e(a){for(var b=0,c=arguments.length-1,d=new Array(c);b<c;++b)d[b]=arguments[b+1];return y(a,this,d)}function f(){return new g}function g(){function a(a){d._handler.resolve(a)}function b(a){d._handler.reject(a)}function c(a){d._handler.notify(a)}var d=x._defer();this.promise=d,this.resolve=a,this.reject=b,this.notify=c,this.resolver={resolve:a,reject:b,notify:c}}function h(a){return a&&"function"==typeof a.then}function i(){return x.all(arguments)}function j(a){return b(a,x.all)}function k(a){return b(a,x.settle)}function l(a,c){return b(a,function(a){return x.map(a,c)})}function m(a,c){return b(a,function(a){return x.filter(a,c)})}var n=a("./lib/decorators/timed"),o=a("./lib/decorators/array"),p=a("./lib/decorators/flow"),q=a("./lib/decorators/fold"),r=a("./lib/decorators/inspect"),s=a("./lib/decorators/iterate"),t=a("./lib/decorators/progress"),u=a("./lib/decorators/with"),v=a("./lib/decorators/unhandledRejection"),w=a("./lib/TimeoutError"),x=[o,p,q,s,t,r,u,n,v].reduce(function(a,b){return b(a)},a("./lib/Promise")),y=a("./lib/apply")(x);return b.promise=c,b.resolve=x.resolve,b.reject=x.reject,b.lift=d,b.try=e,b.attempt=e,b.iterate=x.iterate,b.unfold=x.unfold,b.join=i,b.all=j,b.settle=k,b.any=d(x.any),b.some=d(x.some),b.race=d(x.race),b.map=l,b.filter=m,b.reduce=d(x.reduce),b.reduceRight=d(x.reduceRight),b.isPromiseLike=h,b.Promise=x,b.defer=f,b.TimeoutError=w,b})}("function"==typeof a&&a.amd?a:function(a){c.exports=a(b)})},{"./lib/Promise":4,"./lib/TimeoutError":6,"./lib/apply":7,"./lib/decorators/array":8,"./lib/decorators/flow":9,"./lib/decorators/fold":10,"./lib/decorators/inspect":11,"./lib/decorators/iterate":12,"./lib/decorators/progress":13,"./lib/decorators/timed":14,"./lib/decorators/unhandledRejection":15,"./lib/decorators/with":16}],22:[function(a,b,c){function d(a){if(!(this instanceof d))return new d(a);this._console=this._getConsole(a||{}),this._settings=this._configure(a||{}),this._backoffDelay=this._settings.backoffDelayMin,this._pendingRequests={},this._webSocket=null,e.createEventEmitter(this),this._delegateEvents(),this._settings.autoConnect&&this.connect()}var e=a("bane"),f=a("../lib/websocket/"),g=a("when");d.ConnectionError=function(a){this.name="ConnectionError",this.message=a},d.ConnectionError.prototype=Object.create(Error.prototype),d.ConnectionError.prototype.constructor=d.ConnectionError,d.ServerError=function(a){this.name="ServerError",this.message=a},d.ServerError.prototype=Object.create(Error.prototype),d.ServerError.prototype.constructor=d.ServerError,d.WebSocket=f.Client,d.when=g,d.prototype._getConsole=function(a){if(void 0!==a.console)return a.console;var b="undefined"!=typeof console&&console||{};return b.log=b.log||function(){},b.warn=b.warn||function(){},b.error=b.error||function(){},b},d.prototype._configure=function(a){var b="undefined"!=typeof document&&"https:"===document.location.protocol?"wss://":"ws://",c="undefined"!=typeof document&&document.location.host||"localhost";return a.webSocketUrl=a.webSocketUrl||b+c+"/mopidy/ws",!1!==a.autoConnect&&(a.autoConnect=!0),a.backoffDelayMin=a.backoffDelayMin||1e3,a.backoffDelayMax=a.backoffDelayMax||64e3,void 0===a.callingConvention&&this._console.warn("Mopidy.js is using the default calling convention. The default will change in the future. You should explicitly specify which calling convention you use."),a.callingConvention=a.callingConvention||"by-position-only",a},d.prototype._delegateEvents=function(){this.off("websocket:close"),this.off("websocket:error"),this.off("websocket:incomingMessage"),this.off("websocket:open"),this.off("state:offline"),this.on("websocket:close",this._cleanup),this.on("websocket:error",this._handleWebSocketError),this.on("websocket:incomingMessage",this._handleMessage),this.on("websocket:open",this._resetBackoffDelay),this.on("websocket:open",this._getApiSpec),this.on("state:offline",this._reconnect)},d.prototype.connect=function(){if(this._webSocket){if(this._webSocket.readyState===d.WebSocket.OPEN)return;this._webSocket.close()}this._webSocket=this._settings.webSocket||new d.WebSocket(this._settings.webSocketUrl),this._webSocket.onclose=function(a){this.emit("websocket:close",a)}.bind(this),this._webSocket.onerror=function(a){this.emit("websocket:error",a)}.bind(this),this._webSocket.onopen=function(){
this.emit("websocket:open")}.bind(this),this._webSocket.onmessage=function(a){this.emit("websocket:incomingMessage",a)}.bind(this)},d.prototype._cleanup=function(a){Object.keys(this._pendingRequests).forEach(function(b){var c=this._pendingRequests[b];delete this._pendingRequests[b];var e=new d.ConnectionError("WebSocket closed");e.closeEvent=a,c.reject(e)}.bind(this)),this.emit("state:offline")},d.prototype._reconnect=function(){this.emit("reconnectionPending",{timeToAttempt:this._backoffDelay}),setTimeout(function(){this.emit("reconnecting"),this.connect()}.bind(this),this._backoffDelay),this._backoffDelay=2*this._backoffDelay,this._backoffDelay>this._settings.backoffDelayMax&&(this._backoffDelay=this._settings.backoffDelayMax)},d.prototype._resetBackoffDelay=function(){this._backoffDelay=this._settings.backoffDelayMin},d.prototype.close=function(){this.off("state:offline",this._reconnect),this._webSocket.close()},d.prototype._handleWebSocketError=function(a){this._console.warn("WebSocket error:",a.stack||a)},d.prototype._send=function(a){switch(this._webSocket.readyState){case d.WebSocket.CONNECTING:return g.reject(new d.ConnectionError("WebSocket is still connecting"));case d.WebSocket.CLOSING:return g.reject(new d.ConnectionError("WebSocket is closing"));case d.WebSocket.CLOSED:return g.reject(new d.ConnectionError("WebSocket is closed"));default:var b=g.defer();return a.jsonrpc="2.0",a.id=this._nextRequestId(),this._pendingRequests[a.id]=b.resolver,this._webSocket.send(JSON.stringify(a)),this.emit("websocket:outgoingMessage",a),b.promise}},d.prototype._nextRequestId=function(){var a=-1;return function(){return a+=1}}(),d.prototype._handleMessage=function(a){try{var b=JSON.parse(a.data);b.hasOwnProperty("id")?this._handleResponse(b):b.hasOwnProperty("event")?this._handleEvent(b):this._console.warn("Unknown message type received. Message was: "+a.data)}catch(b){if(!(b instanceof SyntaxError))throw b;this._console.warn("WebSocket message parsing failed. Message was: "+a.data)}},d.prototype._handleResponse=function(a){if(!this._pendingRequests.hasOwnProperty(a.id))return void this._console.warn("Unexpected response received. Message was:",a);var b,c=this._pendingRequests[a.id];delete this._pendingRequests[a.id],a.hasOwnProperty("result")?c.resolve(a.result):a.hasOwnProperty("error")?(b=new d.ServerError(a.error.message),b.code=a.error.code,b.data=a.error.data,c.reject(b),this._console.warn("Server returned error:",a.error)):(b=new Error("Response without 'result' or 'error' received"),b.data={response:a},c.reject(b),this._console.warn("Response without 'result' or 'error' received. Message was:",a))},d.prototype._handleEvent=function(a){var b=a.event,c=a;delete c.event,this.emit("event:"+this._snakeToCamel(b),c)},d.prototype._getApiSpec=function(){return this._send({method:"core.describe"}).then(this._createApi.bind(this)).catch(this._handleWebSocketError)},d.prototype._createApi=function(a){var b="by-position-or-by-name"===this._settings.callingConvention,c=function(a){return function(){var c={method:a};return 0===arguments.length?this._send(c):b?arguments.length>1?g.reject(new Error("Expected zero arguments, a single array, or a single object.")):Array.isArray(arguments[0])||arguments[0]===Object(arguments[0])?(c.params=arguments[0],this._send(c)):g.reject(new TypeError("Expected an array or an object.")):(c.params=Array.prototype.slice.call(arguments),this._send(c))}.bind(this)}.bind(this),d=function(a){var b=a.split(".");return b.length>=1&&"core"===b[0]&&(b=b.slice(1)),b},e=function(a){var b=this;return a.forEach(function(a){a=this._snakeToCamel(a),b[a]=b[a]||{},b=b[a]}.bind(this)),b}.bind(this),f=function(b){var f=d(b),g=this._snakeToCamel(f.slice(-1)[0]),h=e(f.slice(0,-1));h[g]=c(b),h[g].description=a[b].description,h[g].params=a[b].params}.bind(this);Object.keys(a).forEach(f),this.emit("state:online")},d.prototype._snakeToCamel=function(a){return a.replace(/(_[a-z])/g,function(a){return a.toUpperCase().replace("_","")})},b.exports=d},{"../lib/websocket/":1,bane:2,when:21}]},{},[22])(22)});
//# sourceMappingURL=mopidy-mopify-1.7.0.js.map